Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 487902F8A60
	for <lists+linux-kernel@lfdr.de>; Sat, 16 Jan 2021 02:25:43 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728735AbhAPBZW (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 15 Jan 2021 20:25:22 -0500
Received: from mout.gmx.net ([212.227.15.19]:43693 "EHLO mout.gmx.net"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726151AbhAPBZR (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 15 Jan 2021 20:25:17 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=gmx.net;
        s=badeba3b8450; t=1610760218;
        bh=tq8QTJr7FVAXyroHGXtKshh6wNZD9AmK0U3KQjT18TU=;
        h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
        b=VgBnWxITeHD5Z57wIu5MXk8e6jbXnVRZP5ghO5L32k9l1U+QR08v6ruPp4EmgX+WL
         NT2d2RRMazqlcBrNqcZbyUdYoaQYyM/dVb4Vr2qgrpcw24OA+cuPpWZSJS6cGsjOdB
         rUepKvw9G+x/hTuvGR5l4ozfLx+2K+5wKXK+bM/Y=
X-UI-Sender-Class: 01bb95c1-4bf8-414a-932a-4f6e2808ef9c
Received: from Venus.fritz.box ([78.42.220.31]) by mail.gmx.com (mrgmx004
 [212.227.17.190]) with ESMTPSA (Nemesis) id 1M4axg-1l18oR3cMo-001iFL; Sat, 16
 Jan 2021 02:23:37 +0100
From:   Lino Sanfilippo <LinoSanfilippo@gmx.de>
To:     peterhuewe@gmx.de, jarkko@kernel.org
Cc:     jgg@ziepe.ca, stefanb@linux.vnet.ibm.com,
        linux-integrity@vger.kernel.org, linux-kernel@vger.kernel.org,
        LinoSanfilippo@gmx.de, p.rosenberger@kunbus.com,
        Lino Sanfilippo <l.sanfilippo@kunbus.com>
Subject: [PATCH 2/4] tpm: fix reference counting for struct tpm_chip
Date:   Sat, 16 Jan 2021 02:22:39 +0100
Message-Id: <1610760161-21982-3-git-send-email-LinoSanfilippo@gmx.de>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1610760161-21982-1-git-send-email-LinoSanfilippo@gmx.de>
References: <1610760161-21982-1-git-send-email-LinoSanfilippo@gmx.de>
MIME-Version: 1.0
Content-Transfer-Encoding: base64
X-Provags-ID: V03:K1:G6YcRh6v/Z6d8dLSkqTxXX86jQMGH75jC4Fl1XEEAEoXAC8GvCI
 doHDpkxhYhTw38FQQTuy54VH6sn4+47tO9IqtbIUm3FiTVpLV63GWgAOvX1XY8cbw08G34c
 ZQnODQ/0gMoxP6K3jk28fxApiTCn88UqZm4ywWy+UPJZPu75kWuEOa+GB7EmClsrkVyHfB5
 J/s2KAivpzrBAutzEbsSQ==
X-Spam-Flag: NO
X-UI-Out-Filterresults: notjunk:1;V03:K0:IoeNB7ZY4t0=:R2ZgnRWp63yb7mADHsGrQn
 Wj955TD8pHyrdxOT/uCP7roq43GKCod0w015eaWLoTlOLAdCOT6gCBku6ZGoapf1+x1R/M5Ov
 WaG/pzk0TJwd59RD191ineo6rA+eBzOTua4ILKAMCxAT0zRfvwXl34Y++Fbiurx0XT6+BzVVW
 GXaBw9IskqnQzQEsmsiGZWYPtxGOzZw4+6tTykYI7mntQY0g4I7Smrqty2OANk314M/YPy560
 jxT4t7SD9zB27HPBqhqoMF8eTDgcm3zpHrTJ6qCzd6l1YaElBLIBnPHlsuvoQtHS/3x5JvF3j
 8z8fSBR01UnZtTAa8Eb3t2XA82q/ztNEGRwV5RbD+0nhp0tx4klUnc8NULYhS87Hf6zefvPP/
 wJY5+xLq7mLTIHh1LXvqPgcal2bUabo8yg9mntnrSso3UsoLEXQmuXon7tPto6Pdw39DzMIwn
 2zP3DzvCgJ2Vp6sGYzCQPYK+Ehrmse9qczbkGbmF/cshN9NYlMC9mKGTs8mgJ05Tgd0jKJ01D
 CnSTHt1Xbt2ig/XGkKzaq2xRkvLxIymnTfq+/Muli5f0rlRMlSDUCjCgOwptPUNHBo9+jhy55
 2+CMPOmGtfCsKQkOoUv5Rz3on8pil+gwv4zkUy+S2t5az42xzN36nC4Lmpsz6khJcJNw+c7yQ
 2/fLsqWMlmazYoqEzKEeazg2IaL9Sr4OG1lZ5IBx4xoU62ME6XicqwiwjToM7Y3mxK4KDSTDX
 f8/OUOyAjyRuchR7R47zBrCFkYyLhrCbLwaYxpKuCwV2UJa5lmjtpfdWSWJR7GJbfyRq4RwiE
 luuJsXjmr4XECNlazFK1OLq8yl3N85LA7Qe3kBQq+IBQeotrTWWE53KJJ/13nNvxanPo8AGR2
 HgiMJ0lAmMARNc+CM01w==
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

RnJvbTogTGlubyBTYW5maWxpcHBvIDxsLnNhbmZpbGlwcG9Aa3VuYnVzLmNvbT4KCkNvbW1pdCA4
OTc5YjAyYWFmMWQgKCJ0cG06IEZpeCByZWZlcmVuY2UgY291bnQgdG8gbWFpbiBkZXZpY2UiKSB0
cmllZCB0bwpmaXggYSByZWZlcmVuY2UgY291bnQgaXNzdWUgd2hpY2ggcHJldmVudGVkIHRoZSB0
cG1fY2hpcCBzdHJ1Y3R1cmUgZnJvbQpiZWluZyBmcmVlZCBpbiBjYXNlIHRoYXQgbm8gVFBNMiB3
YXMgdXNlZC4gVGhlIGZpeCB3YXMgdG8gb25seSBnZXQgYW4gZXh0cmEKcmVmZXJlbmNlIGZvciBj
aGlwLT5kZXYgaW4gY2FzZSBvZiBUUE0yIHdoaWNoIGlzIGluZGljYXRlZCBieSB0aGUKVFBNX0NI
SVBfRkxBR19UUE0yIGZsYWcuClVuZm9ydHVuYXRlbHkgdGhpcyBmbGFnIGlzIG5ldmVyIHNldCwg
YW5kIHRodXMgdGhlIGV4dHJhIHJlZmVyZW5jZSBpcyBub3QKdGFrZW4gZXZlbiBpbiB0aGUgVFBN
MiBjYXNlLiBUaGlzIHJlc3VsdHMgaW4gYSByZWZjb3VudCB1bmRlcmZsb3cgaW4gY2FzZQp0aGF0
IHRoZSBkZXZpY2UgZmlsZSAvZGV2L3RwbXJtKiBpcyB1c2VkIHRvIHdyaXRlIGRhdGEgYWZ0ZXIg
dGhlIHRwbV9jaGlwCmhhcyBiZWVuIHVucmVnaXN0ZXJlZCAoZS5nIGlmIHRoZSAvZGV2L3RwbXJt
KiBmaWxlIGhhcyBiZWVuIG9wZW5lZCBiZWZvcmUKYW5kIG5vdCB5ZXQgY2xvc2VkIGF0IHRoZSB0
aW1lIHRoZSBjaGlwIHdhcyB1bnJlZ2lzdGVyZWQuKQoKQWxzbyB0aGUgZXJyb3IgcGF0aCAobGFi
ZWwgIm91dCIpIGluIHRwbV9jaGlwX2FsbG9jKCkgcmVzdWx0cyBpbiBzdWNoIGFuCnVuZGVyZmxv
dywgc2luY2UgdGhlIGRldiByZWZlcmVuY2UgaXMgcHV0IHR3aWNlIChvbmUgdGltZSBkaXJlY3Rs
eSBhbmQgdGhlCnNlY29uZCB0aW1lIGJ5IHRoZSBjYWxsIG9mIHRwbV9kZXZzX3JlbGVhc2UoKSBk
dWUgdG8gdGhlIHB1dCBvZgpjaGlwLT5kZXZzKS4KCkZpeCB0aGUgZGVzY3JpYmVkIGlzc3VlcyBi
eSB0YWtpbmcgdGhlIGV4dHJhIHJlZmVyZW5jZSB1bmNvbmRpdGlvbmFsbHkgYW5kCmluc3RhbGxp
bmcgYW4gYWRkaXRpb25hbCByZXNvdXJjZSBtYW5hZ2VtZW50IGFjdGlvbiBoYW5kbGVyIHdoaWNo
IHB1dHMKY2hpcC0+ZGV2cy4gUmVsZWFzaW5nIGNoaXAtPmRldnMgZXZlbnR1YWxseSByZXN1bHRz
IGluIHRoZSBjYWxsIG9mCnRwbV9kZXZzX3JlbGVhc2UoKSB3aGljaCB0aGVuIHJlbGVhc2VzIHRo
ZSBleHRyYSByZWZlcmVuY2UgdG8gY2hpcC0+ZGV2LgoKU2luY2Ugd2Ugbm93IGFjdHVhbGx5IHRh
a2UgdGhhdCBleHRyYSByZWZlcmVuY2UsIGFkanVzdCB1c2VycyBvZgp0cG1fY2hpcF9hbGxvYygp
IGxpa2UgVlRQTSBwcm94eSBhbmQgRlRQTSB0ZWUgdG8gcmVsZWFzZSBpdCBpbmRpcmVjdGx5IGJ5
CnB1dHRpbmcgdGhlIHJlZmVyZW5jZSBvZiBjaGlwLT5kZXZzLgoKRml4ZXM6IDg5NzliMDJhYWYx
ZCAoInRwbTogRml4IHJlZmVyZW5jZSBjb3VudCB0byBtYWluIGRldmljZSIpClNpZ25lZC1vZmYt
Ynk6IExpbm8gU2FuZmlsaXBwbyA8bC5zYW5maWxpcHBvQGt1bmJ1cy5jb20+Ci0tLQogZHJpdmVy
cy9jaGFyL3RwbS90cG0tY2hpcC5jICAgICAgIHwgMTEgKysrKysrKysrLS0KIGRyaXZlcnMvY2hh
ci90cG0vdHBtX2Z0cG1fdGVlLmMgICB8ICAyICsrCiBkcml2ZXJzL2NoYXIvdHBtL3RwbV92dHBt
X3Byb3h5LmMgfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDEyIGluc2VydGlvbnMoKyksIDIgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL3RwbS90cG0tY2hpcC5jIGIvZHJp
dmVycy9jaGFyL3RwbS90cG0tY2hpcC5jCmluZGV4IGUyNDJkMmUuLjU5NjgyNGMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvY2hhci90cG0vdHBtLWNoaXAuYworKysgYi9kcml2ZXJzL2NoYXIvdHBtL3Rw
bS1jaGlwLmMKQEAgLTM2MCw4ICszNjAsNyBAQCBzdHJ1Y3QgdHBtX2NoaXAgKnRwbV9jaGlwX2Fs
bG9jKHN0cnVjdCBkZXZpY2UgKnBkZXYsCiAJICogd2hpbGUgY2RldnMgaXMgaW4gdXNlLiAgVGhl
IGNvcnJlc3BvbmRpbmcgcHV0CiAJICogaXMgaW4gdGhlIHRwbV9kZXZzX3JlbGVhc2UgKFRQTTIg
b25seSkKIAkgKi8KLQlpZiAoY2hpcC0+ZmxhZ3MgJiBUUE1fQ0hJUF9GTEFHX1RQTTIpCi0JCWdl
dF9kZXZpY2UoJmNoaXAtPmRldik7CisJZ2V0X2RldmljZSgmY2hpcC0+ZGV2KTsKIAogCWlmIChj
aGlwLT5kZXZfbnVtID09IDApCiAJCWNoaXAtPmRldi5kZXZ0ID0gTUtERVYoTUlTQ19NQUpPUiwg
VFBNX01JTk9SKTsKQEAgLTQyNSwxMiArNDI0LDIwIEBAIHN0cnVjdCB0cG1fY2hpcCAqdHBtbV9j
aGlwX2FsbG9jKHN0cnVjdCBkZXZpY2UgKnBkZXYsCiAJaWYgKHJjKQogCQlnb3RvIHB1dF9kZXY7
CiAKKwlyYyA9IGRldm1fYWRkX2FjdGlvbl9vcl9yZXNldChwZGV2LAorCQkJCSAgICAgICh2b2lk
ICgqKSh2b2lkICopKSBwdXRfZGV2aWNlLAorCQkJCSAgICAgICZjaGlwLT5kZXZzKTsKKwlpZiAo
cmMpCisJCWdvdG8gcHV0X2RldnM7CisKIAlkZXZfc2V0X2RydmRhdGEocGRldiwgY2hpcCk7CiAK
IAlyZXR1cm4gY2hpcDsKIAogcHV0X2RldjoKIAlwdXRfZGV2aWNlKCZjaGlwLT5kZXYpOworcHV0
X2RldnM6CisJcHV0X2RldmljZSgmY2hpcC0+ZGV2cyk7CiAJcmV0dXJuIEVSUl9QVFIocmMpOwog
fQogRVhQT1JUX1NZTUJPTF9HUEwodHBtbV9jaGlwX2FsbG9jKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvY2hhci90cG0vdHBtX2Z0cG1fdGVlLmMgYi9kcml2ZXJzL2NoYXIvdHBtL3RwbV9mdHBtX3Rl
ZS5jCmluZGV4IDJjY2RmOGEuLjgyODU4YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvY2hhci90cG0v
dHBtX2Z0cG1fdGVlLmMKKysrIGIvZHJpdmVycy9jaGFyL3RwbS90cG1fZnRwbV90ZWUuYwpAQCAt
Mjg2LDYgKzI4Niw3IEBAIHN0YXRpYyBpbnQgZnRwbV90ZWVfcHJvYmUoc3RydWN0IGRldmljZSAq
ZGV2KQogCiBvdXRfY2hpcDoKIAlwdXRfZGV2aWNlKCZwdnRfZGF0YS0+Y2hpcC0+ZGV2KTsKKwlw
dXRfZGV2aWNlKCZwdnRfZGF0YS0+Y2hpcC0+ZGV2cyk7CiBvdXRfY2hpcF9hbGxvYzoKIAl0ZWVf
c2htX2ZyZWUocHZ0X2RhdGEtPnNobSk7CiBvdXRfc2htX2FsbG9jOgpAQCAtMzE4LDYgKzMxOSw3
IEBAIHN0YXRpYyBpbnQgZnRwbV90ZWVfcmVtb3ZlKHN0cnVjdCBkZXZpY2UgKmRldikKIAl0cG1f
Y2hpcF91bnJlZ2lzdGVyKHB2dF9kYXRhLT5jaGlwKTsKIAogCS8qIGZyZWVzIGNoaXAgKi8KKwlw
dXRfZGV2aWNlKCZwdnRfZGF0YS0+Y2hpcC0+ZGV2cyk7CiAJcHV0X2RldmljZSgmcHZ0X2RhdGEt
PmNoaXAtPmRldik7CiAKIAkvKiBGcmVlIHRoZSBzaGFyZWQgbWVtb3J5IHBvb2wgKi8KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvY2hhci90cG0vdHBtX3Z0cG1fcHJveHkuYyBiL2RyaXZlcnMvY2hhci90
cG0vdHBtX3Z0cG1fcHJveHkuYwppbmRleCA5MWM3NzJlMy4uOTdiNjBmOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9jaGFyL3RwbS90cG1fdnRwbV9wcm94eS5jCisrKyBiL2RyaXZlcnMvY2hhci90cG0v
dHBtX3Z0cG1fcHJveHkuYwpAQCAtNTIwLDYgKzUyMCw3IEBAIHN0YXRpYyBzdHJ1Y3QgcHJveHlf
ZGV2ICp2dHBtX3Byb3h5X2NyZWF0ZV9wcm94eV9kZXYodm9pZCkKICAqLwogc3RhdGljIGlubGlu
ZSB2b2lkIHZ0cG1fcHJveHlfZGVsZXRlX3Byb3h5X2RldihzdHJ1Y3QgcHJveHlfZGV2ICpwcm94
eV9kZXYpCiB7CisJcHV0X2RldmljZSgmcHJveHlfZGV2LT5jaGlwLT5kZXZzKTsKIAlwdXRfZGV2
aWNlKCZwcm94eV9kZXYtPmNoaXAtPmRldik7IC8qIGZyZWVzIGNoaXAgKi8KIAlrZnJlZShwcm94
eV9kZXYpOwogfQotLSAKMi43LjQKCg==
