Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 5D8AD2E0210
	for <lists+linux-kernel@lfdr.de>; Mon, 21 Dec 2020 22:31:05 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725961AbgLUVas (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Mon, 21 Dec 2020 16:30:48 -0500
Received: from szxga08-in.huawei.com ([45.249.212.255]:2341 "EHLO
        szxga08-in.huawei.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725791AbgLUVas (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 21 Dec 2020 16:30:48 -0500
Received: from DGGEMM404-HUB.china.huawei.com (unknown [172.30.72.54])
        by szxga08-in.huawei.com (SkyGuard) with ESMTP id 4D0CJg134Jz13VGd;
        Tue, 22 Dec 2020 05:28:51 +0800 (CST)
Received: from dggemi759-chm.china.huawei.com (10.1.198.145) by
 DGGEMM404-HUB.china.huawei.com (10.3.20.212) with Microsoft SMTP Server (TLS)
 id 14.3.498.0; Tue, 22 Dec 2020 05:25:40 +0800
Received: from dggemi761-chm.china.huawei.com (10.1.198.147) by
 dggemi759-chm.china.huawei.com (10.1.198.145) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.2106.2; Tue, 22 Dec 2020 05:25:41 +0800
Received: from dggemi761-chm.china.huawei.com ([10.9.49.202]) by
 dggemi761-chm.china.huawei.com ([10.9.49.202]) with mapi id 15.01.2106.002;
 Tue, 22 Dec 2020 05:25:40 +0800
From:   "Song Bao Hua (Barry Song)" <song.bao.hua@hisilicon.com>
To:     Shakeel Butt <shakeelb@google.com>
CC:     Vitaly Wool <vitaly.wool@konsulko.com>,
        Minchan Kim <minchan@kernel.org>,
        Mike Galbraith <efault@gmx.de>,
        LKML <linux-kernel@vger.kernel.org>,
        linux-mm <linux-mm@kvack.org>,
        Sebastian Andrzej Siewior <bigeasy@linutronix.de>,
        NitinGupta <ngupta@vflare.org>,
        Sergey Senozhatsky <sergey.senozhatsky.work@gmail.com>,
        Andrew Morton <akpm@linux-foundation.org>
Subject: RE: [PATCH] zsmalloc: do not use bit_spin_lock
Thread-Topic: [PATCH] zsmalloc: do not use bit_spin_lock
Thread-Index: AQHW1mZAeBjE5clI7UKUuMSOCQsyuqoBSTyAgAAghwCAAAhXgIAAhndA//+NyICAAIW5IA==
Date:   Mon, 21 Dec 2020 21:25:40 +0000
Message-ID: <8cc0e01fd03245a4994f2e0f54b264fa@hisilicon.com>
References: <18669bd607ae9efbf4e00e36532c7aa167d0fa12.camel@gmx.de>
 <20201220002228.38697-1-vitaly.wool@konsulko.com>
 <X+DaMSJE22nUC0tl@google.com>
 <CAM4kBBKnW6K-mbPno4SpvhUBiykP4zeFm_CNzssDkReURbuU7w@mail.gmail.com>
 <CALvZod69OtXkdOJPzuY5XfXz_ro0V7OmqW4OY9B_emqwroxW4w@mail.gmail.com>
 <e5cd8a0a5df84081a11359ede6e746bc@hisilicon.com>
 <CALvZod7EZnEWb_65FjSNdx+-S_4pLHyS5rYiU-D3hFLRMXS6Lw@mail.gmail.com>
In-Reply-To: <CALvZod7EZnEWb_65FjSNdx+-S_4pLHyS5rYiU-D3hFLRMXS6Lw@mail.gmail.com>
Accept-Language: en-GB, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.126.200.103]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-CFilter-Loop: Reflected
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

DQoNCj4gLS0tLS1PcmlnaW5hbCBNZXNzYWdlLS0tLS0NCj4gRnJvbTogU2hha2VlbCBCdXR0IFtt
YWlsdG86c2hha2VlbGJAZ29vZ2xlLmNvbV0NCj4gU2VudDogVHVlc2RheSwgRGVjZW1iZXIgMjIs
IDIwMjAgMTA6MDMgQU0NCj4gVG86IFNvbmcgQmFvIEh1YSAoQmFycnkgU29uZykgPHNvbmcuYmFv
Lmh1YUBoaXNpbGljb24uY29tPg0KPiBDYzogVml0YWx5IFdvb2wgPHZpdGFseS53b29sQGtvbnN1
bGtvLmNvbT47IE1pbmNoYW4gS2ltIDxtaW5jaGFuQGtlcm5lbC5vcmc+Ow0KPiBNaWtlIEdhbGJy
YWl0aCA8ZWZhdWx0QGdteC5kZT47IExLTUwgPGxpbnV4LWtlcm5lbEB2Z2VyLmtlcm5lbC5vcmc+
OyBsaW51eC1tbQ0KPiA8bGludXgtbW1Aa3ZhY2sub3JnPjsgU2ViYXN0aWFuIEFuZHJ6ZWogU2ll
d2lvciA8YmlnZWFzeUBsaW51dHJvbml4LmRlPjsNCj4gTml0aW5HdXB0YSA8bmd1cHRhQHZmbGFy
ZS5vcmc+OyBTZXJnZXkgU2Vub3poYXRza3kNCj4gPHNlcmdleS5zZW5vemhhdHNreS53b3JrQGdt
YWlsLmNvbT47IEFuZHJldyBNb3J0b24NCj4gPGFrcG1AbGludXgtZm91bmRhdGlvbi5vcmc+DQo+
IFN1YmplY3Q6IFJlOiBbUEFUQ0hdIHpzbWFsbG9jOiBkbyBub3QgdXNlIGJpdF9zcGluX2xvY2sN
Cj4gDQo+IE9uIE1vbiwgRGVjIDIxLCAyMDIwIGF0IDEyOjA2IFBNIFNvbmcgQmFvIEh1YSAoQmFy
cnkgU29uZykNCj4gPHNvbmcuYmFvLmh1YUBoaXNpbGljb24uY29tPiB3cm90ZToNCj4gPg0KPiA+
DQo+ID4NCj4gPiA+IC0tLS0tT3JpZ2luYWwgTWVzc2FnZS0tLS0tDQo+ID4gPiBGcm9tOiBTaGFr
ZWVsIEJ1dHQgW21haWx0bzpzaGFrZWVsYkBnb29nbGUuY29tXQ0KPiA+ID4gU2VudDogVHVlc2Rh
eSwgRGVjZW1iZXIgMjIsIDIwMjAgODo1MCBBTQ0KPiA+ID4gVG86IFZpdGFseSBXb29sIDx2aXRh
bHkud29vbEBrb25zdWxrby5jb20+DQo+ID4gPiBDYzogTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2Vy
bmVsLm9yZz47IE1pa2UgR2FsYnJhaXRoIDxlZmF1bHRAZ214LmRlPjsgTEtNTA0KPiA+ID4gPGxp
bnV4LWtlcm5lbEB2Z2VyLmtlcm5lbC5vcmc+OyBsaW51eC1tbSA8bGludXgtbW1Aa3ZhY2sub3Jn
PjsgU29uZyBCYW8NCj4gSHVhDQo+ID4gPiAoQmFycnkgU29uZykgPHNvbmcuYmFvLmh1YUBoaXNp
bGljb24uY29tPjsgU2ViYXN0aWFuIEFuZHJ6ZWogU2lld2lvcg0KPiA+ID4gPGJpZ2Vhc3lAbGlu
dXRyb25peC5kZT47IE5pdGluR3VwdGEgPG5ndXB0YUB2ZmxhcmUub3JnPjsgU2VyZ2V5DQo+IFNl
bm96aGF0c2t5DQo+ID4gPiA8c2VyZ2V5LnNlbm96aGF0c2t5LndvcmtAZ21haWwuY29tPjsgQW5k
cmV3IE1vcnRvbg0KPiA+ID4gPGFrcG1AbGludXgtZm91bmRhdGlvbi5vcmc+DQo+ID4gPiBTdWJq
ZWN0OiBSZTogW1BBVENIXSB6c21hbGxvYzogZG8gbm90IHVzZSBiaXRfc3Bpbl9sb2NrDQo+ID4g
Pg0KPiA+ID4gT24gTW9uLCBEZWMgMjEsIDIwMjAgYXQgMTE6MjAgQU0gVml0YWx5IFdvb2wgPHZp
dGFseS53b29sQGtvbnN1bGtvLmNvbT4NCj4gd3JvdGU6DQo+ID4gPiA+DQo+ID4gPiA+IE9uIE1v
biwgRGVjIDIxLCAyMDIwIGF0IDY6MjQgUE0gTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9y
Zz4gd3JvdGU6DQo+ID4gPiA+ID4NCj4gPiA+ID4gPiBPbiBTdW4sIERlYyAyMCwgMjAyMCBhdCAw
MjoyMjoyOEFNICswMjAwLCBWaXRhbHkgV29vbCB3cm90ZToNCj4gPiA+ID4gPiA+IHpzbWFsbG9j
IHRha2VzIGJpdCBzcGlubG9jayBpbiBpdHMgX21hcCgpIGNhbGxiYWNrIGFuZCByZWxlYXNlcyBp
dA0KPiA+ID4gPiA+ID4gb25seSBpbiB1bm1hcCgpIHdoaWNoIGlzIHVuc2FmZSBhbmQgbGVhZHMg
dG8genN3YXAgY29tcGxhaW5pbmcNCj4gPiA+ID4gPiA+IGFib3V0IHNjaGVkdWxpbmcgaW4gYXRv
bWljIGNvbnRleHQuDQo+ID4gPiA+ID4gPg0KPiA+ID4gPiA+ID4gVG8gZml4IHRoYXQgYW5kIHRv
IGltcHJvdmUgUlQgcHJvcGVydGllcyBvZiB6c21hbGxvYywgcmVtb3ZlIHRoYXQNCj4gPiA+ID4g
PiA+IGJpdCBzcGlubG9jayBjb21wbGV0ZWx5IGFuZCB1c2UgYSBiaXQgZmxhZyBpbnN0ZWFkLg0K
PiA+ID4gPiA+DQo+ID4gPiA+ID4gSSBkb24ndCB3YW50IHRvIHVzZSBzdWNoIG9wZW4gY29kZSBm
b3IgdGhlIGxvY2suDQo+ID4gPiA+ID4NCj4gPiA+ID4gPiBJIHNlZSBmcm9tIE1pa2UncyBwYXRj
aCwgcmVjZW50IHpzd2FwIGNoYW5nZSBpbnRyb2R1Y2VkIHRoZSBsb2NrZGVwDQo+ID4gPiA+ID4g
c3BsYXQgYnVnIGFuZCB5b3Ugd2FudCB0byBpbXByb3ZlIHpzbWFsbG9jIHRvIGZpeCB0aGUgenN3
YXAgYnVnIGFuZA0KPiA+ID4gPiA+IGludHJvZHVjZSB0aGlzIHBhdGNoIHdpdGggYWxsb3dpbmcg
cHJlZW1wdGlvbiBlbmFibGluZy4NCj4gPiA+ID4NCj4gPiA+ID4gVGhpcyB1bmRlcnN0YW5kaW5n
IGlzIHVwc2lkZSBkb3duLiBUaGUgY29kZSBpbiB6c3dhcCB5b3UgYXJlIHJlZmVycmluZw0KPiA+
ID4gPiB0byBpcyBub3QgYnVnZ3kuICBZb3UgbWF5IGNsYWltIHRoYXQgaXQgaXMgc3Vib3B0aW1h
bCBidXQgdGhlcmUgaXMNCj4gPiA+ID4gbm90aGluZyB3cm9uZyBpbiB0YWtpbmcgYSBtdXRleC4N
Cj4gPiA+ID4NCj4gPiA+DQo+ID4gPiBJcyB0aGlzIHN1Ym9wdGltYWwgZm9yIGFsbCBvciBqdXN0
IHRoZSBoYXJkd2FyZSBhY2NlbGVyYXRvcnM/IFNvcnJ5LCBJDQo+ID4gPiBhbSBub3QgdmVyeSBm
YW1pbGlhciB3aXRoIHRoZSBjcnlwdG8gQVBJLiBJZiBJIHNlbGVjdCBsem8gb3IgbHo0IGFzIGEN
Cj4gPiA+IHpzd2FwIGNvbXByZXNzb3Igd2lsbCB0aGUgW2RlXWNvbXByZXNzaW9uIGJlIGFzeW5j
IG9yIHN5bmM/DQo+ID4NCj4gPiBSaWdodCBub3csIGluIGNyeXB0byBzdWJzeXN0ZW0sIG5ldyBk
cml2ZXJzIGFyZSByZXF1aXJlZCB0byB3cml0ZSBiYXNlZCBvbg0KPiA+IGFzeW5jIEFQSXMuIFRo
ZSBvbGQgc3luYyBBUEkgY2FuJ3Qgd29yayBpbiBuZXcgYWNjZWxlcmF0b3IgZHJpdmVycyBhcyB0
aGV5DQo+ID4gYXJlIG5vdCBzdXBwb3J0ZWQgYXQgYWxsLg0KPiA+DQo+ID4gT2xkIGRyaXZlcnMg
YXJlIHVzZWQgdG8gc3luYywgYnV0IHRoZXkndmUgZ290IGFzeW5jIHdyYXBwZXJzIHRvIHN1cHBv
cnQgYXN5bmMNCj4gPiBBUElzLiBFZy4NCj4gPiBjcnlwdG86IGFjb21wIC0gYWRkIHN1cHBvcnQg
Zm9yIGx6NCB2aWEgc2NvbXANCj4gPg0KPiBodHRwczovL2dpdC5rZXJuZWwub3JnL3B1Yi9zY20v
bGludXgva2VybmVsL2dpdC90b3J2YWxkcy9saW51eC5naXQvY29tbWl0Lw0KPiBjcnlwdG8vbHo0
LmM/aWQ9OGNkOTMzMGUwYTYxNWM5MzEwMzdkNGRlZjk4YjVjZTBkNTQwZjA4ZA0KPiA+DQo+ID4g
Y3J5cHRvOiBhY29tcCAtIGFkZCBzdXBwb3J0IGZvciBsem8gdmlhIHNjb21wDQo+ID4NCj4gaHR0
cHM6Ly9naXQua2VybmVsLm9yZy9wdWIvc2NtL2xpbnV4L2tlcm5lbC9naXQvdG9ydmFsZHMvbGlu
dXguZ2l0L2NvbW1pdC8NCj4gY3J5cHRvL2x6by5jP2lkPWFjOWQyYzRiMzllMDIyZDJjNjE0ODZi
ZmMzM2I3MzBjZmQwMjg5OGUNCj4gPg0KPiA+IHNvIHRoZXkgYXJlIHN1cHBvcnRpbmcgYXN5bmMg
QVBJcyBidXQgdGhleSBhcmUgc3RpbGwgd29ya2luZyBpbiBzeW5jIG1vZGUNCj4gYXMNCj4gPiB0
aG9zZSBvbGQgZHJpdmVycyBkb24ndCBzbGVlcC4NCj4gPg0KPiANCj4gR29vZCB0byBrbm93IHRo
YXQgdGhvc2UgYXJlIHN5bmMgYmVjYXVzZSBJIHdhbnQgdGhlbSB0byBiZSBzeW5jLg0KPiBQbGVh
c2Ugbm90ZSB0aGF0IHpzd2FwIGlzIGEgY2FjaGUgaW4gZnJvbnQgb2YgYSByZWFsIHN3YXAgYW5k
IHRoZSBsb2FkDQo+IG9wZXJhdGlvbiBpcyBsYXRlbmN5IHNlbnNpdGl2ZSBhcyBpdCBjb21lcyBp
biB0aGUgcGFnZSBmYXVsdCBwYXRoIGFuZA0KPiBkaXJlY3RseSBpbXBhY3RzIHRoZSBhcHBsaWNh
dGlvbnMuIEkgZG91YnQgZGVjb21wcmVzc2luZyBzeW5jaHJvbm91c2x5DQo+IGEgNGsgcGFnZSBv
biBhIGNwdSB3aWxsIGJlIGNvc3RsaWVyIHRoYW4gYXN5bmNocm9ub3VzbHkgZGVjb21wcmVzc2lu
Zw0KPiB0aGUgc2FtZSBwYWdlIGZyb20gaGFyZHdhcmUgYWNjZWxlcmF0b3JzLg0KDQpJZiB5b3Ug
cmVhZCB0aGUgb2xkIHBhcGVyOg0KaHR0cHM6Ly93d3cuaWJtLmNvbS9zdXBwb3J0L3BhZ2VzL25l
dy1saW51eC16c3dhcC1jb21wcmVzc2lvbi1mdW5jdGlvbmFsaXR5DQpCZWNhdXNlIHRoZSBoYXJk
d2FyZSBhY2NlbGVyYXRvciBzcGVlZHMgdXAgY29tcHJlc3Npb24sIGxvb2tpbmcgYXQgdGhlIHpz
d2FwDQptZXRyaWNzIHdlIG9ic2VydmVkIHRoYXQgdGhlcmUgd2VyZSBtb3JlIHN0b3JlIGFuZCBs
b2FkIHJlcXVlc3RzIGluIGEgZ2l2ZW4NCmFtb3VudCBvZiB0aW1lLCB3aGljaCBmaWxsZWQgdXAg
dGhlIHpzd2FwIHBvb2wgZmFzdGVyIHRoYW4gYSBzb2Z0d2FyZQ0KY29tcHJlc3Npb24gcnVuLiBC
ZWNhdXNlIG9mIHRoaXMgYmVoYXZpb3IsIHdlIHNldCB0aGUgbWF4X3Bvb2xfcGVyY2VudA0KcGFy
YW1ldGVyIHRvIDMwIGZvciB0aGUgaGFyZHdhcmUgY29tcHJlc3Npb24gcnVucyAtIHRoaXMgbWVh
bnMgdGhhdCB6c3dhcA0KY2FuIHVzZSB1cCB0byAzMCUgb2YgdGhlIDEwR0Igb2YgdG90YWwgbWVt
b3J5Lg0KDQpTbyB1c2luZyBoYXJkd2FyZSBhY2NlbGVyYXRvcnMsIHdlIGdldCBhIGNoYW5jZSB0
byBzcGVlZCB1cCBjb21wcmVzc2lvbg0Kd2hpbGUgZGVjcmVhc2luZyBjcHUgdXRpbGl6YXRpb24u
DQoNCkJUVywgSWYgaXQgaXMgbm90IGVhc3kgdG8gY2hhbmdlIHpzbWFsbG9jLCBvbmUgcXVpY2sg
d29ya2Fyb3VuZCB3ZSBtaWdodCBkbw0KaW4genN3YXAgaXMgYWRkaW5nIHRoZSBiZWxvdyBhZnRl
ciBhcHBseWluZyBNaWtlJ3Mgb3JpZ2luYWwgcGF0Y2g6DQoNCmlmKGluX2F0b21pYygpKSAvKiBm
b3IgenNtYWxsb2MgKi8NCgl3aGlsZSghdHJ5X3dhaXRfZm9yX2NvbXBsZXRpb24oJnJlcS0+ZG9u
ZSk7DQplbHNlIC8qIGZvciB6YnVkLCB6M2ZvbGQgKi8NCgljcnlwdG9fd2FpdF9yZXEoLi4uLik7
DQoNCmNyeXB0b193YWl0X3JlcSgpIGlzIGFjdHVhbGx5IGRvaW5nIHdhaXRfZm9yX2NvbXBsZXRp
b24oKToNCnN0YXRpYyBpbmxpbmUgaW50IGNyeXB0b193YWl0X3JlcShpbnQgZXJyLCBzdHJ1Y3Qg
Y3J5cHRvX3dhaXQgKndhaXQpDQp7DQoJc3dpdGNoIChlcnIpIHsNCgljYXNlIC1FSU5QUk9HUkVT
UzoNCgljYXNlIC1FQlVTWToNCgkJd2FpdF9mb3JfY29tcGxldGlvbigmd2FpdC0+Y29tcGxldGlv
bik7DQoJCXJlaW5pdF9jb21wbGV0aW9uKCZ3YWl0LT5jb21wbGV0aW9uKTsNCgkJZXJyID0gd2Fp
dC0+ZXJyOw0KCQlicmVhazsNCgl9DQoNCglyZXR1cm4gZXJyOw0KfQ0KDQpUaGFua3MNCkJhcnJ5
DQo=
