Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 5969A28D6E1
	for <lists+linux-kernel@lfdr.de>; Wed, 14 Oct 2020 01:13:25 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2388079AbgJMXNY (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 13 Oct 2020 19:13:24 -0400
Received: from mail-02.mail-europe.com ([51.89.119.103]:43556 "EHLO
        mail-02.mail-europe.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1729752AbgJMXNX (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 13 Oct 2020 19:13:23 -0400
Date:   Tue, 13 Oct 2020 23:13:17 +0000
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=protonmail.com;
        s=protonmail; t=1602630800;
        bh=316PuDETxATxjxWhDADgUuY40wkYN3jWT5Cw8aCXx+I=;
        h=Date:To:From:Cc:Reply-To:Subject:In-Reply-To:References:From;
        b=GEGtJpq2Se3J1C7OF8Ia7e4gPEBBr13hO70dBfF7/sLMcNbNlX1j8hSNIEgtBjukd
         fcql2T5Wf5on0zapGwUiutBsaK/Qm8KyQLBuAGiaM7oSNwqmXlCWQNgbddrGO+f8QO
         nwChsZf/ZP2dYObJJ3y62VR66cNR6PrS3kSXw6gk=
To:     Jonathan Corbet <corbet@lwn.net>,
        Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
From:   =?utf-8?Q?N=C3=ADcolas_F=2E_R=2E_A=2E_Prado?= 
        <nfraprado@protonmail.com>
Cc:     linux-doc@vger.kernel.org, linux-kernel@vger.kernel.org,
        lkcamp@lists.libreplanetbr.org, andrealmeid@collabora.com
Reply-To: =?utf-8?Q?N=C3=ADcolas_F=2E_R=2E_A=2E_Prado?= 
          <nfraprado@protonmail.com>
Subject: [PATCH v2 2/5] docs: automarkup.py: Fix regexes to solve sphinx 3 warnings
Message-ID: <20201013231218.2750109-3-nfraprado@protonmail.com>
In-Reply-To: <20201013231218.2750109-1-nfraprado@protonmail.com>
References: <20201013231218.2750109-1-nfraprado@protonmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable
X-Spam-Status: No, score=-1.2 required=10.0 tests=ALL_TRUSTED,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,FREEMAIL_FROM shortcircuit=no
        autolearn=disabled version=3.4.4
X-Spam-Checker-Version: SpamAssassin 3.4.4 (2020-01-24) on
        mailout.protonmail.ch
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

With the transition to Sphinx 3, new warnings were generated by
automarkup, exposing bugs in the regexes.

The warnings were caused by the expressions matching words in the
translated versions of the documentation, since any unicode character
was matched.

Fix the regular expression by making the C regexes use ASCII and
ensuring the expressions only match the beginning of words.

Signed-off-by: N=C3=ADcolas F. R. A. Prado <nfraprado@protonmail.com>
---
 Documentation/sphinx/automarkup.py | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/Documentation/sphinx/automarkup.py b/Documentation/sphinx/auto=
markup.py
index db13fb15cedc..43dd9025fc77 100644
--- a/Documentation/sphinx/automarkup.py
+++ b/Documentation/sphinx/automarkup.py
@@ -22,12 +22,13 @@ from itertools import chain
 # :c:func: block (i.e. ":c:func:`mmap()`s" flakes out), so the last
 # bit tries to restrict matches to things that won't create trouble.
 #
-RE_function =3D re.compile(r'(([\w_][\w\d_]+)\(\))')
+RE_function =3D re.compile(r'\b(([a-zA-Z_]\w+)\(\))', flags=3Dre.ASCII)
=20
 #
 # Sphinx 2 uses the same :c:type role for struct, union, enum and typedef
 #
-RE_generic_type =3D re.compile(r'(struct|union|enum|typedef)\s+([\w_][\w\d=
_]+)')
+RE_generic_type =3D re.compile(r'\b(struct|union|enum|typedef)\s+([a-zA-Z_=
]\w+)',
+                             flags=3Dre.ASCII)
=20
 #
 # Sphinx 3 uses a different C role for each one of struct, union, enum and
@@ -42,7 +43,7 @@ RE_typedef =3D re.compile(r'\b(typedef)\s+([a-zA-Z_]\w+)'=
, flags=3Dre.ASCII)
 # Detects a reference to a documentation page of the form Documentation/..=
. with
 # an optional extension
 #
-RE_doc =3D re.compile(r'Documentation(/[\w\-_/]+)(\.\w+)*')
+RE_doc =3D re.compile(r'\bDocumentation(/[\w\-_/]+)(\.\w+)*')
=20
 #
 # Many places in the docs refer to common system calls.  It is
--=20
2.28.0


