Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 5577C21E811
	for <lists+linux-kernel@lfdr.de>; Tue, 14 Jul 2020 08:25:12 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725997AbgGNGZG (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 14 Jul 2020 02:25:06 -0400
Received: from mail-eopbgr1320087.outbound.protection.outlook.com ([40.107.132.87]:53349
        "EHLO APC01-PU1-obe.outbound.protection.outlook.com"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1725876AbgGNGZF (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 14 Jul 2020 02:25:05 -0400
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=hdsCOM0+7UNISfyqnVq2NAZd9iJT9iGPa0y7aXoI6mVondIF8LJboM0fOQ/fJzEKgiT+DgEaOzC1vieotrIpoNTLg1SSkujvq8AlRv5kyDUlLgCHGFQ6aef6+msVXQO54o32wnPF0Ub+UJS1/CJ2qdasqHUBrQioMem07osSj7/d8XyyumDUdEMGOGFyPJZtKuh/EbeY8sOHQvVoEqaVhI9ZSFuR3chfIjeO3VQ4OqnjKOrW/3w6A8ONKvheI/CH7+WcRNIa5d82PikiUy/g0mCxRTy8kWRURfJtMe3j03mP/CS2a1/9JJSxIeq0IbwYOHHQ7hiEcihBkreLLef/Fg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com;
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=rKmK85f+88gVb83Pd72qjmx61plmWa8QYuw62wV6p+w=;
 b=NpoSlGSZNRz4QeOKYdJWIEHBEh4AhTjfCE3uVJ2kNUWZ1NNGvlrNOFZnl4TfdRDRUA5xSp6qZ7W4wzr57UZAhuK915KcUQkiMYsdbc1ghcvxzhQAyJXddY46dNw/7bW/LSKLEWPgBAoJ0OnFi9NktFOYwjQaiIs0rH/BzLJGOpW3KR2stn4DbIq7DfrOVEiU1JSTVvEHBweX2Vya4/ktm2KGvGbuD9qn7Khx+R2RI6UqOlxppf3LCAcYg0ZeGeT7GMsppLWAsEa0thDbRzpNOqkZyrgoRrJ8hDG8oBOQURHDW3kLhVt7Nh7cQyQt1oz+yNcU5C1ohj1he883xtSsBg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=moxa.com; dmarc=pass action=none header.from=moxa.com;
 dkim=pass header.d=moxa.com; arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=moxa.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=rKmK85f+88gVb83Pd72qjmx61plmWa8QYuw62wV6p+w=;
 b=QU11Z2n07ypgrtVV1h8t+YCZc+7F/jSu1+IuOj/j85+FvNLEhDrWN6vG0UPKXisCUksMhO42uGE5nem6zvvYvZA9IOtG/dzD4IjHJhyzuZmYf8qzyfTiqeypNqf2yjhMicA9rGI1CZUMkRWazLmYowOjU15mLuZwsmV1HaoTtCA=
Received: from HK2PR01MB3281.apcprd01.prod.exchangelabs.com
 (2603:1096:202:22::12) by HKAPR01MB3588.apcprd01.prod.exchangelabs.com
 (2603:1096:203:c5::8) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3174.21; Tue, 14 Jul
 2020 06:24:42 +0000
Received: from HK2PR01MB3281.apcprd01.prod.exchangelabs.com
 ([fe80::dce:9650:6c58:8b77]) by HK2PR01MB3281.apcprd01.prod.exchangelabs.com
 ([fe80::dce:9650:6c58:8b77%4]) with mapi id 15.20.3174.025; Tue, 14 Jul 2020
 06:24:42 +0000
From:   =?big5?B?Sm9obnNvbiBDSCBDaGVuICizr6xMvrEp?= 
        <JohnsonCH.Chen@moxa.com>
To:     Jiri Slaby <jirislaby@gmail.com>,
        Greg Kroah-Hartman <gregkh@linuxfoundation.org>
CC:     "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
        "linux-serial@vger.kernel.org" <linux-serial@vger.kernel.org>
Subject: [PATCH] tty: Add MOXA NPort Real TTY Driver
Thread-Topic: [PATCH] tty: Add MOXA NPort Real TTY Driver
Thread-Index: AQHWWaW+EbrUHbhx60a/vOExcWbf4w==
Date:   Tue, 14 Jul 2020 06:24:42 +0000
Message-ID: <HK2PR01MB328134FB2EF5F9D1E381BDA3FA610@HK2PR01MB3281.apcprd01.prod.exchangelabs.com>
Accept-Language: zh-TW, en-US
Content-Language: zh-TW
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
authentication-results: gmail.com; dkim=none (message not signed)
 header.d=none;gmail.com; dmarc=none action=none header.from=moxa.com;
x-originating-ip: [123.51.145.16]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 0adc46f5-9bb0-4b28-e342-08d827be9818
x-ms-traffictypediagnostic: HKAPR01MB3588:
x-microsoft-antispam-prvs: <HKAPR01MB3588DC0B69AF2730A38CBCDCFA610@HKAPR01MB3588.apcprd01.prod.exchangelabs.com>
x-ms-oob-tlc-oobclassifiers: OLM:6790;
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: e1lU1MELoemNKe01eQEpmNeiWjlO8ZhmvWvxNQrfl9Qiz5etL6E1q5JTlYynR3WI65BEbf5gcoksQLXkiUMYCSpgp3LhJl/EdX/BZZxDaBEzA3lhJisj0RsVZyIy1P3XIGhJsF+2fpb3TkdjUu/594R9pbtczcwtLLPcyV7JVNWnbstqJulN8kK6rklz7WOk/wPhUTGBaYbKcKDt1FnKIkyVrF99X1EvOb8gT2THRDTCe348rKj0Mm6aAvIiPQJhrT+xBYUE3279EslvyHiqdiNOt8QQy3CrQStVJWC0P7/180OpNFfHVHzcrRC0l1cSibycZZNabOZUJLp9SzIzYQ==
x-forefront-antispam-report: CIP:255.255.255.255;CTRY:;LANG:en;SCL:1;SRV:;IPV:NLI;SFV:NSPM;H:HK2PR01MB3281.apcprd01.prod.exchangelabs.com;PTR:;CAT:NONE;SFTY:;SFS:(4636009)(136003)(39850400004)(376002)(366004)(346002)(396003)(66446008)(2906002)(30864003)(110136005)(83380400001)(66556008)(54906003)(5660300002)(316002)(64756008)(66476007)(478600001)(66946007)(76116006)(86362001)(52536014)(4326008)(8676002)(8936002)(26005)(186003)(85182001)(6506007)(55016002)(9686003)(33656002)(7696005)(71200400001)(559001)(579004);DIR:OUT;SFP:1101;
x-ms-exchange-antispam-messagedata: swt2Lq6DcQhEOrpvXx7B6dxzEurcPy4I6+VYTCZb1j2964y8k+mi0kG1HSd3aeLJiXavaOC9ciy0ppBZVYGwxLfnXU20/zShHdIFMqZxr+Vk1V++S2NzqRmXwE2ytjqdHGy0QL/UGh+nEaOc3VMXY0bc5iiH0qsmJ2wQEg0xjEHiNaaSR2JVCIgT+m0CdgSnWNu7JAsxvRvofMpJFSwtOJRkUO70iBlSdGiY/tvrMifyG/x34I7t6/r9jRUnWSkctEBw9fn4NWjnY0QuBMovsPlKpjvpmpu24WC/N0vf5LMVvEy7jT6ehXDKVbCtSDGzJMf7dRjwcg6RCFDt7fZKFATpJS9KP3R0RaJzbKu7GGMCdz9z8bzIZ//fLujcdrNYgH94O7Y2d+sV1swzOW7h/ZAPXwEOum5mBd+4+xzib9TUPrKXTbGMmSTZN44wzba/OK6Vwu5RyHwK1IagvSqwShAc2RwbRW+9jMe4UBOEG6M=
x-ms-exchange-transport-forked: True
Content-Type: text/plain; charset="big5"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-OriginatorOrg: moxa.com
X-MS-Exchange-CrossTenant-AuthAs: Internal
X-MS-Exchange-CrossTenant-AuthSource: HK2PR01MB3281.apcprd01.prod.exchangelabs.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 0adc46f5-9bb0-4b28-e342-08d827be9818
X-MS-Exchange-CrossTenant-originalarrivaltime: 14 Jul 2020 06:24:42.0353
 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 5571c7d4-286b-47f6-9dd5-0aa688773c8e
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: i5QM/19slcoAPFqZ44cs+jkLEVP46RgHSas01vNifiYf5Hpj02HV4p+nhVpA8FeMcKUaN5WZtVMAa/bmukejAg==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: HKAPR01MB3588
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

VGhpcyBkcml2ZXIgc3VwcG9ydHMgdHR5IGZ1bmN0aW9ucyBmb3IgYWxsIG9mIE1PWEEncyBOUG9y
dCBzZXJpZXMKd2l0aCB2NS4wLiBVc2luZyB0aGlzIGRyaXZlciwgaG9zdCBwYXJ0IGNhbiB1c2Ug
dHR5IHRvIGNvbm5lY3QgTlBvcnQKZGV2aWNlIHNlcnZlciBieSBldGhlcm5ldC4KClRoZSBmb2xs
b3dpbmcgTW94YSBwcm9kdWN0cyBhcmUgc3VwcG9ydGVkOgoqIENOMjYwMCBTZXJpZXMKKiBDTjI1
MDAgU2VyaWVzCiogTlBvcnQgREUgU2VyaWVzCiogTlBvcnQgNTAwMEEtTTEyIFNlcmllcwoqIE5Q
b3J0IDUxMDAgU2VyaWVzCiogTlBvcnQgNTIwMCBTZXJpZXMKKiBOUG9ydCA1NDAwIFNlcmllcwoq
IE5Qb3J0IDU2MDAgRGVza3RvcCBTZXJpZXMKKiBOUG9ydCA1NjAwIFJhY2ttb3VudCBTZXJpZXMK
KiBOUG9ydCBXaXJlbGVzcyBTZXJpZXMKKiBOUG9ydCBJQTUwMDAgU2VyaWVzCiogTlBvcnQgNjAw
MCBTZXJpZXMKKiBOUG9ydCBTODAwMCBTZXJpZXMKKiBOUG9ydCBTODQ1NUkgU2VyaWVzCiogTlBv
cnQgUzkwMDAgU2VyaWVzCiogTkUtNDEwMCBTZXJpZXMKKiBNaWlOZVBvcnQgU2VyaWVzCgpTaWdu
ZWQtb2ZmLWJ5OiBKb2huc29uIENoZW4gPGpvaG5zb25jaC5jaGVuQG1veGEuY29tPgpTaWduZWQt
b2ZmLWJ5OiBKYXNvbiBDaGVuIDxqYXNvbi5jaGVuQG1veGEuY29tPgpTaWduZWQtb2ZmLWJ5OiBE
YW5ueSBMaW4gPGRhbm55LmxpbkBtb3hhLmNvbT4KU2lnbmVkLW9mZi1ieTogVmljdG9yIFl1IDx2
aWN0b3IueXVAbW94YS5jb20+Ci0tLQogZHJpdmVycy90dHkvS2NvbmZpZyAgIHwgICAxMSArCiBk
cml2ZXJzL3R0eS9NYWtlZmlsZSAgfCAgICAxICsKIGRyaXZlcnMvdHR5L25wcmVhbDIuYyB8IDMw
NDIgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvdHR5
L25wcmVhbDIuaCB8ICAxNDAgKysKIDQgZmlsZXMgY2hhbmdlZCwgMzE5NCBpbnNlcnRpb25zKCsp
CiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy90dHkvbnByZWFsMi5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy90dHkvbnByZWFsMi5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy90dHkvS2Nv
bmZpZyBiL2RyaXZlcnMvdHR5L0tjb25maWcKaW5kZXggOTNmZDk4NGViMmY1Li43OWI1NDUyNjli
NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdHR5L0tjb25maWcKKysrIGIvZHJpdmVycy90dHkvS2Nv
bmZpZwpAQCAtMjU5LDYgKzI1OSwxNyBAQCBjb25maWcgTU9YQV9TTUFSVElPCiAJICBUaGlzIGRy
aXZlciBjYW4gYWxzbyBiZSBidWlsdCBhcyBhIG1vZHVsZS4gVGhlIG1vZHVsZSB3aWxsIGJlIGNh
bGxlZAogCSAgbXhzZXIuIElmIHlvdSB3YW50IHRvIGRvIHRoYXQsIHNheSBNIGhlcmUuCiAKK2Nv
bmZpZyBNT1hBX05QT1JUX1JFQUxfVFRZCisJdHJpc3RhdGUgIk1veGEgTlBvcnQgUmVhbCBUVFkg
c3VwcG9ydCB2NS4wIgorCWhlbHAKKwkgIFNheSBZIGhlcmUgaWYgeW91IGhhdmUgYSBNb3hhIE5Q
b3J0IHNlcmlhbCBkZXZpY2Ugc2VydmVyLgorCisJICBUaGUgcHVycG9zZSBvZiB0aGlzIGRyaXZl
ciBpcyB0byBtYXAgTlBvcnQgc2VyaWFsIHBvcnQgdG8gaG9zdCB0dHkKKwkgIHBvcnQuIFVzaW5n
IHRoaXMgZHJpdmVyLCB5b3UgY2FuIHVzZSBOUG9ydCBzZXJpYWwgcG9ydCBhcyBsb2NhbCB0dHkg
cG9ydC4KKworCSAgVGhpcyBkcml2ZXIgY2FuIGFsc28gYmUgYnVpbHQgYXMgYSBtb2R1bGUuIFRo
ZSBtb2R1bGUgd2lsbCBiZSBjYWxsZWQKKwkgIG5wcmVhbDIgYnkgc2V0dGluZyBNLgorCiBjb25m
aWcgU1lOQ0xJTksKIAl0cmlzdGF0ZSAiTWljcm9nYXRlIFN5bmNMaW5rIGNhcmQgc3VwcG9ydCIK
IAlkZXBlbmRzIG9uIFNFUklBTF9OT05TVEFOREFSRCAmJiBQQ0kgJiYgSVNBX0RNQV9BUEkKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvdHR5L01ha2VmaWxlIGIvZHJpdmVycy90dHkvTWFrZWZpbGUKaW5k
ZXggMDIwYjFjZDkyOTRmLi42ZDA3OTg1ZDY5NjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdHR5L01h
a2VmaWxlCisrKyBiL2RyaXZlcnMvdHR5L01ha2VmaWxlCkBAIC0yNCw2ICsyNCw3IEBAIG9iai0k
KENPTkZJR19DWUNMQURFUykJCSs9IGN5Y2xhZGVzLm8KIG9iai0kKENPTkZJR19JU0kpCQkrPSBp
c2ljb20ubwogb2JqLSQoQ09ORklHX01PWEFfSU5URUxMSU8pCSs9IG1veGEubwogb2JqLSQoQ09O
RklHX01PWEFfU01BUlRJTykJKz0gbXhzZXIubworb2JqLSQoQ09ORklHX01PWEFfTlBPUlRfUkVB
TF9UVFkpICs9IG5wcmVhbDIubwogb2JqLSQoQ09ORklHX05PWk9NSSkJCSs9IG5vem9taS5vCiBv
YmotJChDT05GSUdfTlVMTF9UVFkpCSAgICAgICAgKz0gdHR5bnVsbC5vCiBvYmotJChDT05GSUdf
Uk9DS0VUUE9SVCkJKz0gcm9ja2V0Lm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvdHR5L25wcmVhbDIu
YyBiL2RyaXZlcnMvdHR5L25wcmVhbDIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAw
MDAwMDAwMDAuLjY1Yzc3MzQyMDc1NQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvdHR5L25w
cmVhbDIuYwpAQCAtMCwwICsxLDMwNDIgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wKworLyoKKyAqIG5wcmVhbDIuYyAgLS0gTU9YQSBOUG9ydCBTZXJ2ZXIgZmFtaWx5IFJl
YWwgVFRZIGRyaXZlci4KKyAqCisgKiBDb3B5cmlnaHQgKGMpIDE5OTktMjAyMCAgTW94YSBUZWNo
bm9sb2dpZXMgKHN1cHBvcnRAbW94YS5jb20pCisgKgorICogU3VwcG9ydHMgdGhlIGZvbGxvd2lu
ZyBNb3hhIFByb2R1Y3Q6CisgKiBDTjI2MDAgU2VyaWVzCisgKiBDTjI1MDAgU2VyaWVzCisgKiBO
UG9ydCBERSBTZXJpZXMKKyAqIE5Qb3J0IDUwMDBBLU0xMiBTZXJpZXMKKyAqIE5Qb3J0IDUxMDAg
U2VyaWVzCisgKiBOUG9ydCA1MjAwIFNlcmllcworICogTlBvcnQgNTQwMCBTZXJpZXMKKyAqIE5Q
b3J0IDU2MDAgRGVza3RvcCBTZXJpZXMKKyAqIE5Qb3J0IDU2MDAgUmFja21vdW50IFNlcmllcwor
ICogTlBvcnQgV2lyZWxlc3MgU2VyaWVzCisgKiBOUG9ydCBJQTUwMDAgU2VyaWVzCisgKiBOUG9y
dCA2MDAwIFNlcmllcworICogTlBvcnQgUzgwMDAgU2VyaWVzCisgKiBOUG9ydCBTODQ1NUkgU2Vy
aWVzCisgKiBOUG9ydCBTOTAwMCBTZXJpZXMKKyAqIE5FLTQxMDAgU2VyaWVzCisgKiBNaWlOZVBv
cnQgU2VyaWVzCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGlu
dXgvZXJybm8uaD4KKyNpbmNsdWRlIDxsaW51eC9mY250bC5oPgorI2luY2x1ZGUgPGxpbnV4L3Zl
cnNpb24uaD4KKyNpbmNsdWRlIDxsaW51eC9pbml0Lmg+CisjaW5jbHVkZSA8bGludXgvaW9wb3J0
Lmg+CisjaW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgvbWFqb3Iu
aD4KKyNpbmNsdWRlIDxsaW51eC9tbS5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3B0cmFjZS5oPgorI2luY2x1ZGUgPGxpbnV4L3BvbGwuaD4KKyNpbmNsdWRl
IDxsaW51eC9wcm9jX2ZzLmg+CisjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgorI2luY2x1ZGUg
PGxpbnV4L3NlcmlhbC5oPgorI2luY2x1ZGUgPGxpbnV4L3NlcmlhbF9yZWcuaD4KKyNpbmNsdWRl
IDxsaW51eC9zbGFiLmg+CisjaW5jbHVkZSA8bGludXgvc3RyaW5nLmg+CisjaW5jbHVkZSA8bGlu
dXgvc2lnbmFsLmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KKyNpbmNsdWRlIDxsaW51eC90
dHkuaD4KKyNpbmNsdWRlIDxsaW51eC90dHlfZmxpcC5oPgorI2luY2x1ZGUgPGxpbnV4L3RpbWVy
Lmg+CisjaW5jbHVkZSAibnByZWFsMi5oIgorCitzdGF0aWMgaW50IHR0eW1ham9yID0gTlBSRUFM
TUFKT1I7CitzdGF0aWMgaW50IHZlcmJvc2UgPSAxOworCitNT0RVTEVfQVVUSE9SKCI8c3VwcG9y
dEBtb3hhLmNvbT4iKTsKK01PRFVMRV9ERVNDUklQVElPTigiTU9YQSBBc3luYy9OUG9ydCBTZXJ2
ZXIgRmFtaWx5IFJlYWwgVFRZIERyaXZlciIpOworbW9kdWxlX3BhcmFtKHR0eW1ham9yLCBpbnQs
IDApOworbW9kdWxlX3BhcmFtKHZlcmJvc2UsIGludCwgMDY0NCk7CitNT0RVTEVfVkVSU0lPTihO
UFJFQUxfVkVSU0lPTik7CitNT0RVTEVfTElDRU5TRSgiR1BMIik7CisKK3N0cnVjdCBzZXJ2ZXJf
c2V0dGluZ19zdHJ1Y3QgeworCWludDMyX3Qgc2VydmVyX3R5cGU7CisJaW50MzJfdCBkaXNhYmxl
X2ZpZm87Cit9OworCitzdHJ1Y3QgbnByZWFsX3N0cnVjdCB7CisJc3RydWN0IHR0eV9wb3J0IHR0
eVBvcnQ7CisJc3RydWN0IHdvcmtfc3RydWN0IHRxdWV1ZTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
cHJvY2Vzc19mbGlwX3RxdWV1ZTsKKwlzdHJ1Y3Qga3Rlcm1pb3Mgbm9ybWFsX3Rlcm1pb3M7CisJ
c3RydWN0IGt0ZXJtaW9zIGNhbGxvdXRfdGVybWlvczsKKwkvKiBrZXJuZWwgY291bnRlcnMgZm9y
IHRoZSA0IGlucHV0IGludGVycnVwdHMgKi8KKwlzdHJ1Y3QgYXN5bmNfaWNvdW50IGljb3VudDsK
KwlzdHJ1Y3Qgc2VtYXBob3JlIHJ4X3NlbWFwaG9yZTsKKwlzdHJ1Y3QgbmRfc3RydWN0ICpuZXRf
bm9kZTsKKwlzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5OworCXN0cnVjdCBwaWQgKnNlc3Npb247CisJ
c3RydWN0IHBpZCAqcGdycDsKKwl3YWl0X3F1ZXVlX2hlYWRfdCBvcGVuX3dhaXQ7CisJd2FpdF9x
dWV1ZV9oZWFkX3QgY2xvc2Vfd2FpdDsKKwl3YWl0X3F1ZXVlX2hlYWRfdCBkZWx0YV9tc3Jfd2Fp
dDsKKwl1bnNpZ25lZCBsb25nIGJhdWRfYmFzZTsKKwl1bnNpZ25lZCBsb25nIGV2ZW50OworCXVu
c2lnbmVkIHNob3J0IGNsb3Npbmdfd2FpdDsKKwlpbnQgcG9ydDsKKwlpbnQgZmxhZ3M7CisJaW50
IHR5cGU7ICAvKiBVQVJUIHR5cGUgKi8KKwlpbnQgeG1pdF9maWZvX3NpemU7CisJaW50IGN1c3Rv
bV9kaXZpc29yOworCWludCB4X2NoYXI7IC8qIHhvbi94b2ZmIGNoYXJhY3RlciAqLworCWludCBj
bG9zZV9kZWxheTsKKwlpbnQgbW9kZW1fY29udHJvbDsgLyogTW9kZW0gY29udHJvbCByZWdpc3Rl
ciAqLworCWludCBtb2RlbV9zdGF0dXM7ICAvKiBMaW5lIHN0YXR1cyAqLworCWludCBjb3VudDsg
LyogIyBvZiBmZCBvbiBkZXZpY2UgKi8KKwlpbnQgeG1pdF9oZWFkOworCWludCB4bWl0X3RhaWw7
CisJaW50IHhtaXRfY250OworCXVuc2lnbmVkIGNoYXIgKnhtaXRfYnVmOworCisJLyoKKwkgKiBX
ZSB1c2Ugc3Bpbl9sb2NrX2lycXNhdmUgaW5zdGVhZCBvZiBzZW1hcGhvbnJlIGhlcmUuCisJICog
UmVhc29uOiBXaGVuIHdlIHVzZSBwcHBkIHRvIGRpYWxvdXQgdmlhIFJlYWwgVFRZIGRyaXZlciwK
KwkgKiBzb21lIGRyaXZlciBmdW5jdGlvbnMsIHN1Y2ggYXMgbnByZWFsX3dyaXRlKCksIHdvdWxk
IGJlCisJICogaW52b2tlZCB1bmRlciBpbnRlcnJwdXRlIG1vZGUgd2hpY2ggY2F1c2VzIHdhcm5p
bmcgaW4KKwkgKiBkb3duL3VwIHR4X3NlbWFwaG9yZS4KKwkgKi8KKwlzcGlubG9ja190IHR4X2xv
Y2s7Cit9OworCitzdHJ1Y3QgbmRfc3RydWN0IHsKKwlzdHJ1Y3Qgc2VtYXBob3JlIGNtZF9zZW1h
cGhvcmU7CisJc3RydWN0IHByb2NfZGlyX2VudHJ5ICpub2RlX2VudHJ5OworCXN0cnVjdCBucHJl
YWxfc3RydWN0ICp0dHlfbm9kZTsKKwlzdHJ1Y3Qgc2VtYXBob3JlIHNlbWFwaG9yZTsKKwl3YWl0
X3F1ZXVlX2hlYWRfdCBpbml0aWFsaXplX3dhaXQ7CisJd2FpdF9xdWV1ZV9oZWFkX3Qgc2VsZWN0
X2luX3dhaXQ7CisJd2FpdF9xdWV1ZV9oZWFkX3Qgc2VsZWN0X291dF93YWl0OworCXdhaXRfcXVl
dWVfaGVhZF90IHNlbGVjdF9leF93YWl0OworCXdhaXRfcXVldWVfaGVhZF90IGNtZF9yc3Bfd2Fp
dDsKKwlpbnQzMl90IHNlcnZlcl90eXBlOworCWludCBkb19zZXNzaW9uX3JlY292ZXJ5X2xlbjsK
KwlpbnQgY21kX3JzcF9mbGFnOworCWludCB0eF9yZWFkeTsKKwlpbnQgcnhfcmVhZHk7CisJaW50
IGNtZF9yZWFkeTsKKwlpbnQgd2FpdF9vcXVldWVfcmVzcG9uc2VkOworCWludCBvcXVldWU7CisJ
aW50IHJzcF9sZW5ndGg7CisJdW5zaWduZWQgbG9uZyBmbGFnOworCXVuc2lnbmVkIGNoYXIgY21k
X2J1ZmZlcls4NF07CisJdW5zaWduZWQgY2hhciByc3BfYnVmZmVyWzg0XTsKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgcHJvY19vcHMgbnByZWFsX25ldF9mb3BzOworc3RhdGljIGNvbnN0IHN0
cnVjdCB0dHlfb3BlcmF0aW9ucyBtcHZhcl9vcHM7CitzdGF0aWMgc3RydWN0IHByb2NfZGlyX2Vu
dHJ5ICpucHZhcl9wcm9jX3Jvb3Q7CitzdGF0aWMgc3RydWN0IHR0eV9kcml2ZXIgKm5wdmFyX3Nk
cml2ZXI7CitzdGF0aWMgc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKm5wdmFyX3RhYmxlOworc3RhdGlj
IHN0cnVjdCBuZF9zdHJ1Y3QgKm5wdmFyX25ldF9ub2RlczsKKworc3RhdGljIHZvaWQgbnByZWFs
X2RvX3NvZnRpbnQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBucHJlYWxf
c3RydWN0ICppbmZvID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBucHJlYWxfc3RydWN0LCB0
cXVldWUpOworCXN0cnVjdCB0dHlfc3RydWN0ICp0dHk7CisKKwlpZiAoIWluZm8pCisJCXJldHVy
bjsKKworCXR0eSA9IGluZm8tPnR0eTsKKwlpZiAodHR5KSB7CisJCWlmICh0ZXN0X2FuZF9jbGVh
cl9iaXQoTlBSRUFMX0VWRU5UX1RYTE9XLCAmaW5mby0+ZXZlbnQpKSB7CisJCQlpZiAoKHR0eS0+
ZmxhZ3MgJiAoMSA8PCBUVFlfRE9fV1JJVEVfV0FLRVVQKSkgJiYKKwkJCQl0dHktPmxkaXNjLT5v
cHMtPndyaXRlX3dha2V1cCkKKwkJCQkodHR5LT5sZGlzYy0+b3BzLT53cml0ZV93YWtldXApKHR0
eSk7CisJCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJnR0eS0+d3JpdGVfd2FpdCk7CisJCX0KKwor
CQlpZiAodGVzdF9hbmRfY2xlYXJfYml0KE5QUkVBTF9FVkVOVF9IQU5HVVAsICZpbmZvLT5ldmVu
dCkpIHsKKwkJCS8qIERvIGl0IHdoZW4gZW50ZXJpbmcgbnByZWFsX2hhbmd1cCgpICovCisJCQl0
dHlfaGFuZ3VwKHR0eSk7CisJCX0KKwl9Cit9CisKKy8qKgorICogbnByZWFsX2ZsdXNoX3RvX2xk
aXNjKCkgLSBSZWFkIGRhdGEgZnJvbSB0dHkgZGV2aWNlIHRvIGxpbmUgZGlzY2lwbGluZQorICog
QHR0eTogcG9pbnRlciBmb3Igc3RydWN0IHR0eV9zdHJ1Y3QKKyAqIEBmaWxwOiBwb2ludGVyIGZv
ciBzdHJ1Y3QgZmlsZQorICoKKyAqIFRoaXMgcm91dGluZSBpcyBjYWxsZWQgb3V0IG9mIHRoZSBz
b2Z0d2FyZSBpbnRlcnJ1cHQgdG8gZmx1c2ggZGF0YQorICogZnJvbSB0aGUgZmxpcCBidWZmZXIg
dG8gdGhlIGxpbmUgZGlzY2lwbGluZS4KKyAqCisgKi8KKworc3RhdGljIHZvaWQgbnByZWFsX2Zs
dXNoX3RvX2xkaXNjKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgbnByZWFs
X3N0cnVjdCAqaW5mbyA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgbnByZWFsX3N0cnVjdCwg
cHJvY2Vzc19mbGlwX3RxdWV1ZSk7CisJc3RydWN0IHR0eV9zdHJ1Y3QgKnR0eTsKKwlzdHJ1Y3Qg
dHR5X3BvcnQgKnBvcnQ7CisKKwlpZiAoaW5mbyA9PSBOVUxMKQorCQlyZXR1cm47CisKKwl0dHkg
PSBpbmZvLT50dHk7CisJaWYgKHR0eSA9PSBOVUxMKQorCQlyZXR1cm47CisKKwlwb3J0ID0gdHR5
LT5wb3J0OworCXR0eV9mbGlwX2J1ZmZlcl9wdXNoKHBvcnQpOworfQorCitzdGF0aWMgaW5saW5l
IHZvaWQgbnByZWFsX2NoZWNrX21vZGVtX3N0YXR1cyhzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5m
bywgaW50IHN0YXR1cykKK3sKKwlpbnQgaXNfZGNkX2NoYW5nZWQgPSAwOworCisJaWYgKChpbmZv
LT5tb2RlbV9zdGF0dXMgJiBVQVJUX01TUl9EU1IpICE9IChzdGF0dXMgJiBVQVJUX01TUl9EU1Ip
KQorCQlpbmZvLT5pY291bnQuZHNyKys7CisJaWYgKChpbmZvLT5tb2RlbV9zdGF0dXMgJiBVQVJU
X01TUl9EQ0QpICE9IChzdGF0dXMgJiBVQVJUX01TUl9EQ0QpKSB7CisJCWluZm8tPmljb3VudC5k
Y2QrKzsKKwkJaXNfZGNkX2NoYW5nZWQgPSAxOworCX0KKworCWlmICgoaW5mby0+bW9kZW1fc3Rh
dHVzICYgVUFSVF9NU1JfQ1RTKSAhPSAoc3RhdHVzICYgVUFSVF9NU1JfQ1RTKSkKKwkJaW5mby0+
aWNvdW50LmN0cysrOworCisJaW5mby0+bW9kZW1fc3RhdHVzID0gc3RhdHVzOworCXdha2VfdXBf
aW50ZXJydXB0aWJsZSgmaW5mby0+ZGVsdGFfbXNyX3dhaXQpOworCisJaWYgKChpbmZvLT5mbGFn
cyAmIEFTWU5DX0NIRUNLX0NEKSAmJiAoaXNfZGNkX2NoYW5nZWQpKSB7CisJCWlmIChzdGF0dXMg
JiBVQVJUX01TUl9EQ0QpIHsKKwkJCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmaW5mby0+b3Blbl93
YWl0KTsKKwkJfSBlbHNlIHsKKwkJCXNldF9iaXQoTlBSRUFMX0VWRU5UX0hBTkdVUCwgJmluZm8t
PmV2ZW50KTsKKwkJCXNjaGVkdWxlX3dvcmsoJmluZm8tPnRxdWV1ZSk7CisJCX0KKwl9Cit9CisK
K3N0YXRpYyBpbnQgbnByZWFsX3dhaXRfYW5kX3NldF9jb21tYW5kKHN0cnVjdCBuZF9zdHJ1Y3Qg
Km5kLCBjaGFyIGNvbW1hbmRfc2V0LCBjaGFyIGNvbW1hbmQpCit7CisJdW5zaWduZWQgbG9uZyBl
dDsKKworCWlmICgoY29tbWFuZF9zZXQgIT0gTlBSRUFMX0xPQ0FMX0NPTU1BTkRfU0VUKSAmJgor
CQkoKG5kLT5mbGFnICYgTlBSRUFMX05FVF9ET19TRVNTSU9OX1JFQ09WRVJZKSB8fAorCQkobmQt
PmZsYWcgJiBOUFJFQUxfTkVUX05PREVfRElTQ09OTkVDVEVEKSkpIHsKKworCQlpZiAobmQtPmZs
YWcgJiBOUFJFQUxfTkVUX0RPX1NFU1NJT05fUkVDT1ZFUlkpCisJCQlyZXR1cm4gLUVBR0FJTjsK
KworCQlyZXR1cm4gLUVJTzsKKwl9CisKKwlkb3duKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJbmQt
PmNtZF9yc3BfZmxhZyA9IDA7CisJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKworCWV0ID0gamlm
ZmllcyArIE5QUkVBTF9DTURfVElNRU9VVDsKKwl3aGlsZSAoMSkgeworCQlkb3duKCZuZC0+Y21k
X3NlbWFwaG9yZSk7CisJCWlmICghKG5kLT5jbWRfYnVmZmVyWzBdID09IDAgfHwgKChqaWZmaWVz
IC0gZXQgPj0gMCkgfHwKKwkJCXNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKSkpIHsKKwkJCXVwKCZu
ZC0+Y21kX3NlbWFwaG9yZSk7CisJCQljdXJyZW50LT5zdGF0ZSA9IFRBU0tfSU5URVJSVVBUSUJM
RTsKKwkJCXNjaGVkdWxlX3RpbWVvdXQoMSk7CisJCX0gZWxzZSB7CisJCQluZC0+Y21kX2J1ZmZl
clswXSA9IGNvbW1hbmRfc2V0OworCQkJbmQtPmNtZF9idWZmZXJbMV0gPSBjb21tYW5kOworCQkJ
dXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJCXJldHVybiAwOworCQl9CisJfQorfQorCitzdGF0
aWMgaW50IG5wcmVhbF93YWl0X2NvbW1hbmRfY29tcGxldGVkKHN0cnVjdCBuZF9zdHJ1Y3QgKm5k
LCBjaGFyIGNvbW1hbmRfc2V0LCBjaGFyIGNvbW1hbmQsCisJCQkJCQlsb25nIHRpbWVvdXQsIGNo
YXIgKnJzcF9idWYsIGludCAqcnNwX2xlbikKK3sKKwlsb25nIHN0ID0gMCwgdG1wID0gMDsKKwor
CWlmICgoY29tbWFuZF9zZXQgIT0gTlBSRUFMX0xPQ0FMX0NPTU1BTkRfU0VUKSAmJgorCQkoKG5k
LT5mbGFnICYgTlBSRUFMX05FVF9ET19TRVNTSU9OX1JFQ09WRVJZKSB8fAorCQkobmQtPmZsYWcg
JiBOUFJFQUxfTkVUX05PREVfRElTQ09OTkVDVEVEKSkpIHsKKworCQlpZiAobmQtPmZsYWcgJiBO
UFJFQUxfTkVUX0RPX1NFU1NJT05fUkVDT1ZFUlkpCisJCQlyZXR1cm4gLUVBR0FJTjsKKwkJZWxz
ZQorCQkJcmV0dXJuIC1FSU87CisJfQorCisJaWYgKCpyc3BfbGVuIDw9IDApCisJCXJldHVybiAt
RUlPOworCisJd2hpbGUgKDEpIHsKKwkJZG93bigmbmQtPmNtZF9zZW1hcGhvcmUpOworCisJCWlm
ICgobmQtPnJzcF9sZW5ndGgpICYmIChuZC0+cnNwX2J1ZmZlclswXSA9PSBjb21tYW5kX3NldCkg
JiYKKwkJCQkJKG5kLT5yc3BfYnVmZmVyWzFdID09IGNvbW1hbmQpKSB7CisJCQlpZiAobmQtPnJz
cF9sZW5ndGggPiAqcnNwX2xlbikKKwkJCQlyZXR1cm4gLTE7CisKKwkJCSpyc3BfbGVuID0gbmQt
PnJzcF9sZW5ndGg7CisJCQltZW1jcHkocnNwX2J1ZiwgbmQtPnJzcF9idWZmZXIsICpyc3BfbGVu
KTsKKwkJCW5kLT5yc3BfbGVuZ3RoID0gMDsKKwkJCXVwKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJ
CQlyZXR1cm4gMDsKKworCQl9IGVsc2UgaWYgKHRpbWVvdXQgPiAwKSB7CisJCQl1cCgmbmQtPmNt
ZF9zZW1hcGhvcmUpOworCQkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQorCQkJCXJldHVy
biAtRUlPOworCisJCQlzdCA9IGppZmZpZXM7CisJCQlpZiAod2FpdF9ldmVudF9pbnRlcnJ1cHRp
YmxlX3RpbWVvdXQobmQtPmNtZF9yc3Bfd2FpdCwKKwkJCQkJCQluZC0+Y21kX3JzcF9mbGFnID09
IDEsIHRpbWVvdXQpICE9IDApIHsKKwkJCQlkb3duKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJCQkJ
bmQtPmNtZF9yc3BfZmxhZyA9IDA7CisJCQkJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJCX0K
KworCQkJdG1wID0gYWJzKChsb25nKWppZmZpZXMgLSAobG9uZylzdCk7CisKKwkJCWlmICh0bXAg
Pj0gdGltZW91dCkKKwkJCQl0aW1lb3V0ID0gMDsKKwkJCWVsc2UKKwkJCQl0aW1lb3V0IC09IHRt
cDsKKwkJfSBlbHNlIHsKKwkJCXVwKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJCQlyZXR1cm4gLUVU
SU1FOworCQl9CisJfQorfQorCitzdGF0aWMgaW50IG5wcmVhbF9zZXRfdW51c2VkX2NvbW1hbmRf
ZG9uZShzdHJ1Y3QgbmRfc3RydWN0ICpuZCwgY2hhciAqcnNwX2J1ZiwgaW50ICpyc3BfbGVuKQor
eworCW5wcmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBSRUFMX0xPQ0FMX0NPTU1BTkRf
U0VULCBMT0NBTF9DTURfVFRZX1VOVVNFRCk7CisJbmQtPmNtZF9idWZmZXJbMl0gPSAwOworCW5k
LT5jbWRfcmVhZHkgPSAxOworCXNtcF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVl
dWVfYWN0aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1
c2Ugc21wX21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0
X2V4X3dhaXQpKQorCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJm5kLT5zZWxlY3RfZXhfd2FpdCk7
CisKKwlyZXR1cm4gbnByZWFsX3dhaXRfY29tbWFuZF9jb21wbGV0ZWQobmQsIE5QUkVBTF9MT0NB
TF9DT01NQU5EX1NFVCwgTE9DQUxfQ01EX1RUWV9VTlVTRUQsCisJCQkJCQlOUFJFQUxfQ01EX1RJ
TUVPVVQsIHJzcF9idWYsIHJzcF9sZW4pOworfQorCitzdGF0aWMgaW50IG5wcmVhbF9zZXRfdXNl
ZF9jb21tYW5kX2RvbmUoc3RydWN0IG5kX3N0cnVjdCAqbmQsIGNoYXIgKnJzcF9idWYsIGludCAq
cnNwX2xlbikKK3sKKwluZC0+Y21kX2J1ZmZlclswXSA9IDA7CisJbnByZWFsX3dhaXRfYW5kX3Nl
dF9jb21tYW5kKG5kLCBOUFJFQUxfTE9DQUxfQ09NTUFORF9TRVQsIExPQ0FMX0NNRF9UVFlfVVNF
RCk7CisJbmQtPmNtZF9idWZmZXJbMl0gPSAwOworCW5kLT5jbWRfcmVhZHkgPSAxOworCXNtcF9t
YigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVfYWN0aXZlKCkgKi8KKwkvKiB1c2Vk
IHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21wX21iKCkgaXMgdXNlZCAqLwor
CWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0X2V4X3dhaXQpKQorCQl3YWtlX3VwX2lu
dGVycnVwdGlibGUoJm5kLT5zZWxlY3RfZXhfd2FpdCk7CisKKwlyZXR1cm4gbnByZWFsX3dhaXRf
Y29tbWFuZF9jb21wbGV0ZWQobmQsIE5QUkVBTF9MT0NBTF9DT01NQU5EX1NFVCwgTE9DQUxfQ01E
X1RUWV9VU0VELAorCQkJCQkJTlBSRUFMX0NNRF9USU1FT1VULCByc3BfYnVmLCByc3BfbGVuKTsK
K30KKworc3RhdGljIGludCBucHJlYWxfc2V0X3R4X2ZpZm9fY29tbWFuZF9kb25lKHN0cnVjdCBu
cHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3QgbmRfc3RydWN0ICpuZCwKKwkJCQkJCQkJY2hhciAq
cnNwX2J1ZiwgaW50ICpyc3BfbGVuKQoreworCWludCByZXQ7CisKKwlyZXQgPSBucHJlYWxfd2Fp
dF9hbmRfc2V0X2NvbW1hbmQobmQsIE5QUkVBTF9BU1BQX0NPTU1BTkRfU0VULCBBU1BQX0NNRF9U
WF9GSUZPKTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCW5kLT5jbWRfYnVmZmVy
WzJdID0gMTsKKwluZC0+Y21kX2J1ZmZlclszXSA9IGluZm8tPnhtaXRfZmlmb19zaXplOworCW5k
LT5jbWRfcmVhZHkgPSAxOworCXNtcF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVl
dWVfYWN0aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1
c2Ugc21wX21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0
X2V4X3dhaXQpKQorCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJm5kLT5zZWxlY3RfZXhfd2FpdCk7
CisKKwkqcnNwX2xlbiA9IFJTUF9CVUZGRVJfU0laRTsKKwlyZXQgPSBucHJlYWxfd2FpdF9jb21t
YW5kX2NvbXBsZXRlZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQsIEFTUFBfQ01EX1RYX0ZJ
Rk8sCisJCQkJCQlOUFJFQUxfQ01EX1RJTUVPVVQsIHJzcF9idWYsIHJzcF9sZW4pOworCWlmIChy
ZXQpCisJCXJldHVybiAtRUlPOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbnByZWFs
X3NldF9wb3J0X2NvbW1hbmRfZG9uZShzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywgc3RydWN0
IG5kX3N0cnVjdCAqbmQsCisJCQkJCXN0cnVjdCBrdGVybWlvcyAqdGVybWlvLCBjaGFyICpyc3Bf
YnVmLCBpbnQgKnJzcF9sZW4sCisJCQkJCWludDMyX3QgbW9kZSwgaW50MzJfdCBiYXVkLCBpbnQg
YmF1ZEluZGV4KQoreworCWludCByZXQ7CisKKwlyZXQgPSBucHJlYWxfd2FpdF9hbmRfc2V0X2Nv
bW1hbmQobmQsIE5QUkVBTF9BU1BQX0NPTU1BTkRfU0VULCBBU1BQX0NNRF9QT1JUX0lOSVQpOwor
CWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJbmQtPmNtZF9idWZmZXJbMl0gPSA4Owor
CW5kLT5jbWRfYnVmZmVyWzNdID0gYmF1ZEluZGV4OworCW5kLT5jbWRfYnVmZmVyWzRdID0gbW9k
ZTsKKworCWlmIChpbmZvLT5tb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfRFRSKQorCQluZC0+Y21k
X2J1ZmZlcls1XSA9IDE7CisJZWxzZQorCQluZC0+Y21kX2J1ZmZlcls1XSA9IDA7CisKKwlpZiAo
aW5mby0+bW9kZW1fY29udHJvbCAmIFVBUlRfTUNSX1JUUykKKwkJbmQtPmNtZF9idWZmZXJbNl0g
PSAxOworCWVsc2UKKwkJbmQtPmNtZF9idWZmZXJbNl0gPSAwOworCisJaWYgKHRlcm1pby0+Y19j
ZmxhZyAmIENSVFNDVFMpIHsKKwkJbmQtPmNtZF9idWZmZXJbN10gPSAxOworCQluZC0+Y21kX2J1
ZmZlcls4XSA9IDE7CisJfSBlbHNlIHsKKwkJbmQtPmNtZF9idWZmZXJbN10gPSAwOworCQluZC0+
Y21kX2J1ZmZlcls4XSA9IDA7CisJfQorCisJaWYgKHRlcm1pby0+Y19pZmxhZyAmIElYT04pCisJ
CW5kLT5jbWRfYnVmZmVyWzldID0gMTsKKwllbHNlCisJCW5kLT5jbWRfYnVmZmVyWzldID0gMDsK
KworCWlmICh0ZXJtaW8tPmNfaWZsYWcgJiBJWE9GRikKKwkJbmQtPmNtZF9idWZmZXJbMTBdID0g
MTsKKwllbHNlCisJCW5kLT5jbWRfYnVmZmVyWzEwXSA9IDA7CisKKwluZC0+Y21kX3JlYWR5ID0g
MTsKKwlzbXBfbWIoKTsgLyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICov
CisJLyogdXNlZCB3YWl0cXVldWVfYWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlz
IHVzZWQgKi8KKwlpZiAod2FpdHF1ZXVlX2FjdGl2ZSgmbmQtPnNlbGVjdF9leF93YWl0KSkKKwkJ
d2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZuZC0+c2VsZWN0X2V4X3dhaXQpOworCisJcmV0ID0gbnBy
ZWFsX3dhaXRfY29tbWFuZF9jb21wbGV0ZWQobmQsIE5QUkVBTF9BU1BQX0NPTU1BTkRfU0VULCBB
U1BQX0NNRF9QT1JUX0lOSVQsCisJCQkJCU5QUkVBTF9DTURfVElNRU9VVCwgcnNwX2J1ZiwgcnNw
X2xlbik7CisJaWYgKHJldCkKKwkJcmV0dXJuIC1FSU87CisKKwlpZiAoKCpyc3BfbGVuICE9IDYp
IHx8IChyc3BfYnVmWzJdICE9IDMpKQorCQlyZXR1cm4gLUVJTzsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IG5wcmVhbF9zZXRfYmF1ZF9jb21tYW5kX2RvbmUoc3RydWN0IG5wcmVhbF9z
dHJ1Y3QgKmluZm8sIHN0cnVjdCBuZF9zdHJ1Y3QgKm5kLAorCQkJCQkJY2hhciAqcnNwX2J1Ziwg
aW50ICpyc3BfbGVuLCBpbnQgYmF1ZCkKK3sKKwlpbnQgcmV0OworCisJcmV0ID0gbnByZWFsX3dh
aXRfYW5kX3NldF9jb21tYW5kKG5kLCBOUFJFQUxfQVNQUF9DT01NQU5EX1NFVCwgQVNQUF9DTURf
U0VUQkFVRCk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlpZiAoKChpbmZvLT5m
bGFncyAmIEFTWU5DX1NQRF9NQVNLKSA9PSBBU1lOQ19TUERfQ1VTVCkgJiYgaW5mby0+Y3VzdG9t
X2Rpdmlzb3IpCisJCWJhdWQgPSBpbmZvLT5iYXVkX2Jhc2UgLyBpbmZvLT5jdXN0b21fZGl2aXNv
cjsKKworCW5kLT5jbWRfYnVmZmVyWzJdID0gNDsKKwltZW1jcHkoJm5kLT5jbWRfYnVmZmVyWzNd
LCAmYmF1ZCwgNCk7CisJbmQtPmNtZF9yZWFkeSA9IDE7CisJc21wX21iKCk7IC8qIHVzZSBzbXBf
bWIoKSB3aXRoIHdhaXRxdWV1ZV9hY3RpdmUoKSAqLworCS8qIHVzZWQgd2FpdHF1ZXVlX2FjdGl2
ZSgpIGlzIHNhZmUgYmVjYXVzZSBzbXBfbWIoKSBpcyB1c2VkICovCisJaWYgKHdhaXRxdWV1ZV9h
Y3RpdmUoJm5kLT5zZWxlY3RfZXhfd2FpdCkpCisJCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmbmQt
PnNlbGVjdF9leF93YWl0KTsKKworCSpyc3BfbGVuID0gUlNQX0JVRkZFUl9TSVpFOworCXJldCA9
IG5wcmVhbF93YWl0X2NvbW1hbmRfY29tcGxldGVkKG5kLCBOUFJFQUxfQVNQUF9DT01NQU5EX1NF
VCwgQVNQUF9DTURfU0VUQkFVRCwKKwkJCQkJTlBSRUFMX0NNRF9USU1FT1VULCByc3BfYnVmLCBy
c3BfbGVuKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gLUVJTzsKKworCWlmICgoKnJzcF9sZW4gIT0g
NCkgfHwgKHJzcF9idWZbMl0gIT0gJ08nKSB8fCAocnNwX2J1ZlszXSAhPSAnSycpKQorCQlyZXR1
cm4gLUVJTzsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IG5wcmVhbF9zZXRfeG9ueG9m
Zl9jb21tYW5kX2RvbmUoc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8sIHN0cnVjdCBrdGVybWlv
cyAqdGVybWlvLAorCQkJCQkJc3RydWN0IG5kX3N0cnVjdCAqbmQsIGNoYXIgKnJzcF9idWYsIGlu
dCAqcnNwX2xlbikKK3sKKwlpbnQgcmV0OworCisJcmV0ID0gbnByZWFsX3dhaXRfYW5kX3NldF9j
b21tYW5kKG5kLCBOUFJFQUxfQVNQUF9DT01NQU5EX1NFVCwgQVNQUF9DTURfWE9OWE9GRik7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCW5kLT5jbWRfYnVmZmVyWzJdID0gMjsKKwluZC0+
Y21kX2J1ZmZlclszXSA9IHRlcm1pby0+Y19jY1tWU1RBUlRdOworCW5kLT5jbWRfYnVmZmVyWzRd
ID0gdGVybWlvLT5jX2NjW1ZTVE9QXTsKKwluZC0+Y21kX3JlYWR5ID0gMTsKKwlzbXBfbWIoKTsg
LyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICovCisJLyogdXNlZCB3YWl0
cXVldWVfYWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlzIHVzZWQgKi8KKwlpZiAo
d2FpdHF1ZXVlX2FjdGl2ZSgmbmQtPnNlbGVjdF9leF93YWl0KSkKKwkJd2FrZV91cF9pbnRlcnJ1
cHRpYmxlKCZuZC0+c2VsZWN0X2V4X3dhaXQpOworCisJcmV0ID0gbnByZWFsX3dhaXRfY29tbWFu
ZF9jb21wbGV0ZWQobmQsIE5QUkVBTF9BU1BQX0NPTU1BTkRfU0VULCBBU1BQX0NNRF9YT05YT0ZG
LAorCQkJCQkJTlBSRUFMX0NNRF9USU1FT1VULCByc3BfYnVmLCByc3BfbGVuKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gLUVJTzsKKworCWlmICgoKnJzcF9sZW4gIT0gNCkgfHwgKHJzcF9idWZbMl0g
IT0gJ08nKSB8fCAocnNwX2J1ZlszXSAhPSAnSycpKQorCQlyZXR1cm4gLUVJTzsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IG5wcmVhbF9zZXRfZ2VuZXJpY19jb21tYW5kX2RvbmUoc3Ry
dWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8sIGludCBjbWQpCit7CisJc3RydWN0IG5kX3N0cnVjdCAq
bmQ7CisJY2hhciByc3BfYnVmZmVyW1JTUF9CVUZGRVJfU0laRV07CisJaW50IHJzcF9sZW5ndGgg
PSBSU1BfQlVGRkVSX1NJWkU7CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJ
CXJldHVybiAtRUlPOworCisJaWYgKG5wcmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBS
RUFMX0FTUFBfQ09NTUFORF9TRVQsIGNtZCkgPCAwKQorCQlyZXR1cm4gLUVJTzsKKworCW5kLT5j
bWRfYnVmZmVyWzJdID0gMDsKKwluZC0+Y21kX3JlYWR5ID0gMTsKKwlzbXBfbWIoKTsgLyogdXNl
IHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICovCisJLyogdXNlZCB3YWl0cXVldWVf
YWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlzIHVzZWQgKi8KKwlpZiAod2FpdHF1
ZXVlX2FjdGl2ZSgmbmQtPnNlbGVjdF9leF93YWl0KSkKKwkJd2FrZV91cF9pbnRlcnJ1cHRpYmxl
KCZuZC0+c2VsZWN0X2V4X3dhaXQpOworCWlmIChucHJlYWxfd2FpdF9jb21tYW5kX2NvbXBsZXRl
ZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQsIGNtZCwgTlBSRUFMX0NNRF9USU1FT1VULAor
CQkJCQkJcnNwX2J1ZmZlciwgJnJzcF9sZW5ndGgpKQorCQlyZXR1cm4gLUVJTzsKKworCWlmICgo
cnNwX2xlbmd0aCAhPSA0KSB8fCAocnNwX2J1ZmZlclsyXSAhPSAnTycpIHx8IChyc3BfYnVmZmVy
WzNdICE9ICdLJykpCisJCXJldHVybiAtRUlPOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2
b2lkIG5wcmVhbF9kaXNjb25uZWN0KHN0cnVjdCBuZF9zdHJ1Y3QgKm5kLCBjaGFyICpidWYsIGlu
dCAqc2l6ZSkKK3sKKwlpbnQgaSA9IDA7CisKKwluZC0+Y21kX2J1ZmZlclswXSA9IDA7CisJZm9y
IChpID0gMDsgaSA8IDI7IGkrKykgeworCQlpZiAobnByZWFsX3NldF91bnVzZWRfY29tbWFuZF9k
b25lKG5kLCBidWYsIHNpemUpID09IDApCisJCQlicmVhazsKKwl9Cit9CisKK3N0YXRpYyBpbnQg
bnByZWFsX2xpbmVjdHJsKHN0cnVjdCBuZF9zdHJ1Y3QgKm5kLCBpbnQgbW9kZW1fY29udHJvbCkK
K3sKKwljaGFyIHJzcF9idWZmZXJbUlNQX0JVRkZFUl9TSVpFXTsKKwlpbnQgcnNwX2xlbmd0aCA9
IFJTUF9CVUZGRVJfU0laRTsKKworCWlmICghbmQpCisJCXJldHVybiAtRUlPOworCisJaWYgKG5w
cmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQsIEFT
UFBfQ01EX0xJTkVDVFJMKSA8IDApCisJCXJldHVybiAtRUlPOworCisJbmQtPmNtZF9idWZmZXJb
Ml0gPSAyOworCWlmIChtb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfRFRSKQorCQluZC0+Y21kX2J1
ZmZlclszXSA9IDE7CisJZWxzZQorCQluZC0+Y21kX2J1ZmZlclszXSA9IDA7CisKKwlpZiAobW9k
ZW1fY29udHJvbCAmIFVBUlRfTUNSX1JUUykKKwkJbmQtPmNtZF9idWZmZXJbNF0gPSAxOworCWVs
c2UKKwkJbmQtPmNtZF9idWZmZXJbNF0gPSAwOworCisJbmQtPmNtZF9yZWFkeSA9IDE7CisJc21w
X21iKCk7IC8qIHVzZSBzbXBfbWIoKSB3aXRoIHdhaXRxdWV1ZV9hY3RpdmUoKSAqLworCS8qIHVz
ZWQgd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIHNhZmUgYmVjYXVzZSBzbXBfbWIoKSBpcyB1c2VkICov
CisJaWYgKHdhaXRxdWV1ZV9hY3RpdmUoJm5kLT5zZWxlY3RfZXhfd2FpdCkpCisJCXdha2VfdXBf
aW50ZXJydXB0aWJsZSgmbmQtPnNlbGVjdF9leF93YWl0KTsKKworCWlmIChucHJlYWxfd2FpdF9j
b21tYW5kX2NvbXBsZXRlZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQsIEFTUFBfQ01EX0xJ
TkVDVFJMLAorCQkJCQlOUFJFQUxfQ01EX1RJTUVPVVQsIHJzcF9idWZmZXIsICZyc3BfbGVuZ3Ro
KSkKKwkJcmV0dXJuIC1FSU87CisKKwlpZiAoKHJzcF9sZW5ndGggIT0gNCkgfHwgKHJzcF9idWZm
ZXJbMl0gIT0gJ08nKSB8fCAocnNwX2J1ZmZlclszXSAhPSAnSycpKQorCQlyZXR1cm4gLUVJTzsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBucHJlYWxfZmx1c2hfYnVmZmVyKHN0cnVj
dCB0dHlfc3RydWN0ICp0dHkpCit7CisJc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8gPSAoc3Ry
dWN0IG5wcmVhbF9zdHJ1Y3QgKil0dHktPmRyaXZlcl9kYXRhOworCXN0cnVjdCBuZF9zdHJ1Y3Qg
Km5kOworCWNoYXIgcnNwX2J1ZmZlcltSU1BfQlVGRkVSX1NJWkVdOworCWludCByc3BfbGVuZ3Ro
ID0gUlNQX0JVRkZFUl9TSVpFOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlpZiAoIWluZm8p
CisJCXJldHVybjsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZpbmZvLT50eF9sb2NrLCBmbGFncyk7
CisJaW5mby0+eG1pdF90YWlsID0gMDsKKwlpbmZvLT54bWl0X2hlYWQgPSAwOworCWluZm8tPnht
aXRfY250ID0gMDsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpbmZvLT50eF9sb2NrLCBmbGFn
cyk7CisJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZ0dHktPndyaXRlX3dhaXQpOworCisJaWYgKCh0
dHktPmZsYWdzICYgKDEgPDwgVFRZX0RPX1dSSVRFX1dBS0VVUCkpICYmIHR0eS0+bGRpc2MtPm9w
cy0+d3JpdGVfd2FrZXVwKQorCQkodHR5LT5sZGlzYy0+b3BzLT53cml0ZV93YWtldXApKHR0eSk7
CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJCXJldHVybjsKKworCW5kLT50
eF9yZWFkeSA9IDA7CisJaWYgKG5wcmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBSRUFM
X0FTUFBfQ09NTUFORF9TRVQsIEFTUFBfQ01EX0ZMVVNIKSA8IDApCisJCXJldHVybjsKKworCW5k
LT5jbWRfYnVmZmVyWzJdID0gMTsKKwluZC0+Y21kX2J1ZmZlclszXSA9IEFTUFBfRkxVU0hfQUxM
X0JVRkZFUjsKKwluZC0+Y21kX3JlYWR5ID0gMTsKKwlzbXBfbWIoKTsgLyogdXNlIHNtcF9tYigp
IHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICovCisJLyogdXNlZCB3YWl0cXVldWVfYWN0aXZlKCkg
aXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlzIHVzZWQgKi8KKwlpZiAod2FpdHF1ZXVlX2FjdGl2
ZSgmbmQtPnNlbGVjdF9leF93YWl0KSkKKwkJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZuZC0+c2Vs
ZWN0X2V4X3dhaXQpOworCisJbnByZWFsX3dhaXRfY29tbWFuZF9jb21wbGV0ZWQobmQsIE5QUkVB
TF9BU1BQX0NPTU1BTkRfU0VULCBBU1BQX0NNRF9GTFVTSCwKKwkJCQkJTlBSRUFMX0NNRF9USU1F
T1VULCByc3BfYnVmZmVyLCAmcnNwX2xlbmd0aCk7Cit9CisKK3N0YXRpYyBsb25nIG5wcmVhbF93
YWl0X29xdWV1ZShzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywgbG9uZyB0aW1lb3V0KQorewor
CXN0cnVjdCBuZF9zdHJ1Y3QgKm5kOworCWxvbmcgc3QgPSAwLCB0bXAgPSAwOworCXVpbnQzMl90
IHRvdXQ7CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJCXJldHVybiAtRUlP
OworCisJaWYgKG5wcmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBSRUFMX0FTUFBfQ09N
TUFORF9TRVQsIEFTUFBfQ01EX1dBSVRfT1FVRVVFKSA8IDApCisJCXJldHVybiAtRUlPOworCisJ
aWYgKHRpbWVvdXQgPCBIWiAvIDEwKQorCQl0aW1lb3V0ID0gSFogLyAxMDsKKworCXN0ID0gamlm
ZmllczsKKworCWlmICh0aW1lb3V0ICE9IE1BWF9TQ0hFRFVMRV9USU1FT1VUKQorCQl0b3V0ID0g
KHVpbnQzMl90KXRpbWVvdXQ7CisJZWxzZQorCQl0b3V0ID0gMHg3RkZGRkZGRjsKKworCW5kLT5j
bWRfYnVmZmVyWzJdID0gNDsKKwltZW1jcHkoJm5kLT5jbWRfYnVmZmVyWzNdLCAodm9pZCAqKSZ0
b3V0LCA0KTsKKwluZC0+d2FpdF9vcXVldWVfcmVzcG9uc2VkID0gMDsKKwluZC0+Y21kX3JlYWR5
ID0gMTsKKwlzbXBfbWIoKTsgLyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgp
ICovCisJLyogdXNlZCB3YWl0cXVldWVfYWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigp
IGlzIHVzZWQgKi8KKwlpZiAod2FpdHF1ZXVlX2FjdGl2ZSgmbmQtPnNlbGVjdF9leF93YWl0KSkK
KwkJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZuZC0+c2VsZWN0X2V4X3dhaXQpOworCisJd2hpbGUg
KG5kLT5jbWRfcmVhZHkgPT0gMSkgeworCQlpZiAod2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlX3Rp
bWVvdXQobmQtPmNtZF9yc3Bfd2FpdCwgbmQtPmNtZF9yc3BfZmxhZyA9PSAxLAorCQkJCQkJCXRp
bWVvdXQpICE9IDApIHsKKwkJCWRvd24oJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJCW5kLT5jbWRf
cnNwX2ZsYWcgPSAwOworCQkJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJfSBlbHNlIHsKKwkJ
CXJldHVybiAtRUlPOworCQl9CisJfQorCisJbmQtPmNtZF9idWZmZXJbMF0gPSAwOworCWRvIHsK
KwkJaWYgKG5kLT53YWl0X29xdWV1ZV9yZXNwb25zZWQgPT0gMCkgeworCQkJaWYgKHdhaXRfZXZl
bnRfaW50ZXJydXB0aWJsZV90aW1lb3V0KG5kLT5jbWRfcnNwX3dhaXQsCisJCQkJCQkJbmQtPmNt
ZF9yc3BfZmxhZyA9PSAxLCB0aW1lb3V0KSkgeworCQkJCWRvd24oJm5kLT5jbWRfc2VtYXBob3Jl
KTsKKwkJCQluZC0+Y21kX3JzcF9mbGFnID0gMDsKKwkJCQl1cCgmbmQtPmNtZF9zZW1hcGhvcmUp
OworCQkJfQorCisJCQl0bXAgPSBhYnMoKGxvbmcpamlmZmllcyAtIChsb25nKXN0KTsKKwkJCWlm
ICh0bXAgPj0gdGltZW91dCkKKwkJCQl0aW1lb3V0ID0gMDsKKwkJCWVsc2UKKwkJCQl0aW1lb3V0
IC09IHRtcDsKKwkJfSBlbHNlIHsKKwkJCXJldHVybiBuZC0+b3F1ZXVlOworCQl9CisJfSB3aGls
ZSAodGltZW91dCA+IDApOworCisJcmV0dXJuIC1FSU87Cit9CisKK3N0YXRpYyBpbnQzMl90IG5w
cmVhbF9wb3J0X2luaXRfbW9kZShzdHJ1Y3Qga3Rlcm1pb3MgKnRlcm1pbykKK3sKKwlpbnQzMl90
IG1vZGU7CisKKwltb2RlID0gdGVybWlvLT5jX2NmbGFnICYgQ1NJWkU7CisKKwlzd2l0Y2ggKG1v
ZGUpIHsKKwljYXNlIENTNToKKwkJbW9kZSA9IEFTUFBfSU9DVExfQklUUzU7CisJCWJyZWFrOwor
CisJY2FzZSBDUzY6CisJCW1vZGUgPSBBU1BQX0lPQ1RMX0JJVFM2OworCQlicmVhazsKKworCWNh
c2UgQ1M3OgorCQltb2RlID0gQVNQUF9JT0NUTF9CSVRTNzsKKwkJYnJlYWs7CisKKwljYXNlIENT
ODoKKwkJbW9kZSA9IEFTUFBfSU9DVExfQklUUzg7CisJCWJyZWFrOworCX0KKworCWlmICh0ZXJt
aW8tPmNfY2ZsYWcgJiBDU1RPUEIpCisJCW1vZGUgfD0gQVNQUF9JT0NUTF9TVE9QMjsKKwllbHNl
CisJCW1vZGUgfD0gQVNQUF9JT0NUTF9TVE9QMTsKKworCWlmICh0ZXJtaW8tPmNfY2ZsYWcgJiBQ
QVJFTkIpIHsKKyNpZmRlZiBDTVNQQVIKKwkJaWYgKHRlcm1pby0+Y19jZmxhZyAmIENNU1BBUikg
eworCQkJaWYgKHRlcm1pby0+Y19jZmxhZyAmIFBBUk9ERCkKKwkJCQltb2RlIHw9IEFTUFBfSU9D
VExfTUFSSzsKKwkJCWVsc2UKKwkJCQltb2RlIHw9IEFTUFBfSU9DVExfU1BBQ0U7CisJCX0KKyNl
bmRpZgorCQlpZiAodGVybWlvLT5jX2NmbGFnICYgUEFST0REKQorCQkJbW9kZSB8PSBBU1BQX0lP
Q1RMX09ERDsKKwkJZWxzZQorCQkJbW9kZSB8PSBBU1BQX0lPQ1RMX0VWRU47CisJfSBlbHNlIHsK
KwkJbW9kZSB8PSBBU1BQX0lPQ1RMX05PTkU7CisJfQorCisJcmV0dXJuIG1vZGU7Cit9CisKK3N0
YXRpYyB2b2lkIG5wcmVhbF9wb3J0X2luaXRfYmF1ZChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5m
bywgc3RydWN0IGt0ZXJtaW9zICp0ZXJtaW8sCisJCQkJc3RydWN0IGt0ZXJtaW9zICpvbGRfdGVy
bWlvcywgaW50MzJfdCAqYmF1ZF9yZXQsIGludCAqaW5kZXhfcmV0KQoreworCWludCBiYXVkSW5k
ZXg7CisJaW50MzJfdCBiYXVkOworCisJc3dpdGNoICh0ZXJtaW8tPmNfY2ZsYWcgJiAoQ0JBVUQg
fCBDQkFVREVYKSkgeworCWNhc2UgQjkyMTYwMDoKKwkJYmF1ZCA9IDkyMTYwMEw7CisJCWJhdWRJ
bmRleCA9IEFTUFBfSU9DVExfQjkyMTYwMDsKKwkJYnJlYWs7CisKKwljYXNlIEI0NjA4MDA6CisJ
CWJhdWQgPSA0NjA4MDA7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjQ2MDgwMDsKKwkJYnJl
YWs7CisKKwljYXNlIEIyMzA0MDA6CisJCWJhdWQgPSAyMzA0MDBMOworCQliYXVkSW5kZXggPSBB
U1BQX0lPQ1RMX0IyMzA0MDA7CisJCWJyZWFrOworCisJY2FzZSBCMTE1MjAwOgorCQliYXVkID0g
MTE1MjAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CMTE1MjAwOworCQlicmVhazsKKwor
CWNhc2UgQjU3NjAwOgorCQliYXVkID0gNTc2MDBMOworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RM
X0I1NzYwMDsKKwkJYnJlYWs7CisKKwljYXNlIEIzODQwMDoKKwkJYmF1ZCA9IDM4NDAwTDsKKwkJ
YmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CMzg0MDA7CisKKwkJaWYgKChpbmZvLT5mbGFncyAmIEFT
WU5DX1NQRF9NQVNLKSA9PSBBU1lOQ19TUERfSEkpIHsKKwkJCWJhdWQgPSA1NzYwMEw7CisJCQli
YXVkSW5kZXggPSBBU1BQX0lPQ1RMX0I1NzYwMDsKKwkJfQorCisJCWlmICgoaW5mby0+ZmxhZ3Mg
JiBBU1lOQ19TUERfTUFTSykgPT0gQVNZTkNfU1BEX1ZISSkgeworCQkJYmF1ZCA9IDExNTIwMEw7
CisJCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0IxMTUyMDA7CisJCX0KKworI2lmZGVmIEFTWU5D
X1NQRF9TSEkKKwkJaWYgKChpbmZvLT5mbGFncyAmIEFTWU5DX1NQRF9NQVNLKSA9PSBBU1lOQ19T
UERfU0hJKSB7CisJCQliYXVkID0gMjMwNDAwTDsKKwkJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExf
QjIzMDQwMDsKKwkJfQorI2VuZGlmCisKKyNpZmRlZiBBU1lOQ19TUERfV0FSUAorCQlpZiAoKGlu
Zm8tPmZsYWdzICYgQVNZTkNfU1BEX01BU0spID09IEFTWU5DX1NQRF9XQVJQKSB7CisJCQliYXVk
ID0gNDYwODAwTDsKKwkJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjQ2MDgwMDsKKwkJfQorI2Vu
ZGlmCisJCWJyZWFrOworCisJY2FzZSBCMTkyMDA6CisJCWJhdWQgPSAxOTIwMEw7CisJCWJhdWRJ
bmRleCA9IEFTUFBfSU9DVExfQjE5MjAwOworCQlicmVhazsKKworCWNhc2UgQjk2MDA6CisJCWJh
dWQgPSA5NjAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9COTYwMDsKKwkJYnJlYWs7CisK
KwljYXNlIEI0ODAwOgorCQliYXVkID0gNDgwMEw7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExf
QjQ4MDA7CisJCWJyZWFrOworCisJY2FzZSBCMjQwMDoKKwkJYmF1ZCA9IDI0MDBMOworCQliYXVk
SW5kZXggPSBBU1BQX0lPQ1RMX0IyNDAwOworCQlicmVhazsKKworCWNhc2UgQjE4MDA6CisJCWJh
dWQgPSAxODAwTDsKKwkJYmF1ZEluZGV4ID0gMHhmZjsKKwkJYnJlYWs7CisKKwljYXNlIEIxMjAw
OgorCQliYXVkID0gMTIwMEw7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjEyMDA7CisJCWJy
ZWFrOworCisJY2FzZSBCNjAwOgorCQliYXVkID0gNjAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9J
T0NUTF9CNjAwOworCQlicmVhazsKKworCWNhc2UgQjMwMDoKKwkJYmF1ZCA9IDMwMEw7CisJCWJh
dWRJbmRleCA9IEFTUFBfSU9DVExfQjMwMDsKKwkJYnJlYWs7CisKKwljYXNlIEIyMDA6CisJCWJh
dWQgPSAyMDBMOworCQliYXVkSW5kZXggPSAweGZmOworCQlicmVhazsKKworCWNhc2UgQjE1MDoK
KwkJYmF1ZCA9IDE1MEw7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjE1MDsKKwkJYnJlYWs7
CisKKwljYXNlIEIxMzQ6CisJCWJhdWQgPSAxMzRMOworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RM
X0IxMzQ7CisJCWJyZWFrOworCisJY2FzZSBCMTEwOgorCQliYXVkID0gMTEwTDsKKwkJYmF1ZElu
ZGV4ID0gQVNQUF9JT0NUTF9CMTEwOworCQlicmVhazsKKworCWNhc2UgQjc1OgorCQliYXVkID0g
NzVMOworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0I3NTsKKwkJYnJlYWs7CisKKwljYXNlIEI1
MDoKKwkJYmF1ZCA9IDUwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CNTA7CisJCWJyZWFr
OworCisJZGVmYXVsdDoKKwkJYmF1ZCA9IHR0eV90ZXJtaW9zX2JhdWRfcmF0ZSh0ZXJtaW8pOwor
CQliYXVkSW5kZXggPSAweGZmOworCX0KKworI2lmZGVmIEFTWU5DX1NQRF9DVVNUCisJaWYgKChp
bmZvLT5mbGFncyAmIEFTWU5DX1NQRF9NQVNLKSA9PSBBU1lOQ19TUERfQ1VTVCkKKwkJYmF1ZElu
ZGV4ID0gMHhmZjsKKyNlbmRpZgorCisJaWYgKGJhdWQgPiA5MjE2MDBMKSB7CisJCXRlcm1pby0+
Y19jZmxhZyAmPSB+KENCQVVEIHwgQ0JBVURFWCk7CisJCXRlcm1pby0+Y19jZmxhZyB8PSBvbGRf
dGVybWlvcy0+Y19jZmxhZyAmIChDQkFVRCB8IENCQVVERVgpOworCX0KKworCSpiYXVkX3JldCA9
IGJhdWQ7CisJKmluZGV4X3JldCA9IGJhdWRJbmRleDsKK30KKworc3RhdGljIGludCBucHJlYWxf
cG9ydF9pbml0KHN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3Qga3Rlcm1pb3MgKm9s
ZF90ZXJtaW9zKQoreworCXN0cnVjdCBrdGVybWlvcyAqdGVybWlvOworCXN0cnVjdCBuZF9zdHJ1
Y3QgKm5kOworCWludCByc3BfbGVuZ3RoID0gUlNQX0JVRkZFUl9TSVpFOworCWludCBiYXVkSW5k
ZXgsIG1vZGVtX3N0YXR1czsKKwlpbnQgcmV0OworCWludDMyX3QgYmF1ZCwgbW9kZTsKKwljaGFy
IHJzcF9idWZmZXJbUlNQX0JVRkZFUl9TSVpFXTsKKworCW5kID0gaW5mby0+bmV0X25vZGU7CisJ
aWYgKCFpbmZvLT50dHkgfHwgIW5kKQorCQlyZXR1cm4gLUVJTzsKKworCXRlcm1pbyA9ICYoaW5m
by0+dHR5LT50ZXJtaW9zKTsKKwltb2RlID0gbnByZWFsX3BvcnRfaW5pdF9tb2RlKHRlcm1pbyk7
CisJbnByZWFsX3BvcnRfaW5pdF9iYXVkKGluZm8sIHRlcm1pbywgb2xkX3Rlcm1pb3MsICZiYXVk
LCAmYmF1ZEluZGV4KTsKKwlyZXQgPSBucHJlYWxfc2V0X3BvcnRfY29tbWFuZF9kb25lKGluZm8s
IG5kLCB0ZXJtaW8sIHJzcF9idWZmZXIsICZyc3BfbGVuZ3RoLCBtb2RlLCBiYXVkLAorCQkJCQkJ
YmF1ZEluZGV4KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCW1vZGVtX3N0YXR1
cyA9IDA7CisJaWYgKCgodW5zaWduZWQgY2hhcilyc3BfYnVmZmVyWzNdID09IDB4ZmYpICYmICgo
dW5zaWduZWQgY2hhcilyc3BfYnVmZmVyWzRdID09IDB4ZmYpICYmCisJCSgodW5zaWduZWQgY2hh
cilyc3BfYnVmZmVyWzVdID09IDB4ZmYpKSB7CisJCXRlcm1pby0+Y19jZmxhZyAmPSB+KENCQVVE
IHwgQ0JBVURFWCk7CisJCXRlcm1pby0+Y19jZmxhZyB8PSBvbGRfdGVybWlvcy0+Y19jZmxhZyAm
IChDQkFVRCB8IENCQVVERVgpOworCX0gZWxzZSB7CisJCWlmIChyc3BfYnVmZmVyWzNdKQorCQkJ
bW9kZW1fc3RhdHVzIHw9IFVBUlRfTVNSX0RTUjsKKwkJaWYgKHJzcF9idWZmZXJbNF0pCisJCQlt
b2RlbV9zdGF0dXMgfD0gVUFSVF9NU1JfQ1RTOworCQlpZiAocnNwX2J1ZmZlcls1XSkKKwkJCW1v
ZGVtX3N0YXR1cyB8PSBVQVJUX01TUl9EQ0Q7CisJfQorCisJbnByZWFsX2NoZWNrX21vZGVtX3N0
YXR1cyhpbmZvLCBtb2RlbV9zdGF0dXMpOworCisJaWYgKChiYXVkSW5kZXggPT0gMHhmZikgJiYg
KGJhdWQgIT0gMCkpIHsKKwkJcmV0ID0gbnByZWFsX3NldF9iYXVkX2NvbW1hbmRfZG9uZShpbmZv
LCBuZCwgcnNwX2J1ZmZlciwgJnJzcF9sZW5ndGgsIGJhdWQpOworCQlpZiAocmV0KQorCQkJcmV0
dXJuIHJldDsKKwl9CisKKwlpZiAodGVybWlvLT5jX2lmbGFnICYgKElYT04gfCBJWE9GRikpIHsK
KwkJcmV0ID0gbnByZWFsX3NldF94b254b2ZmX2NvbW1hbmRfZG9uZShpbmZvLCB0ZXJtaW8sIG5k
LCByc3BfYnVmZmVyLCAmcnNwX2xlbmd0aCk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0Owor
CX0KKworCWlmICh0ZXJtaW8tPmNfY2ZsYWcgJiBDTE9DQUwpCisJCWluZm8tPmZsYWdzICY9IH5B
U1lOQ19DSEVDS19DRDsKKwllbHNlCisJCWluZm8tPmZsYWdzIHw9IEFTWU5DX0NIRUNLX0NEOwor
CisJaWYgKCFpbmZvLT50dHkpCisJCXJldHVybiAtRUlPOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyB2b2lkIG5wcmVhbF9pbml0X25ldF9ub2RlKHN0cnVjdCBuZF9zdHJ1Y3QgKm5ldF9ub2Rl
LCBzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqdHR5X25vZGUsCisJCQkJCQkJCXN0cnVjdCBwcm9jX2Rp
cl9lbnRyeSAqZGUpCit7CisJbmV0X25vZGUtPnR0eV9ub2RlID0gdHR5X25vZGU7CisJbmV0X25v
ZGUtPm5vZGVfZW50cnkgPSBkZTsKKwluZXRfbm9kZS0+Y21kX3JzcF9mbGFnID0gMDsKKwluZXRf
bm9kZS0+ZmxhZyA9IDA7CisKKwlzZW1hX2luaXQoJm5ldF9ub2RlLT5jbWRfc2VtYXBob3JlLCAx
KTsKKwlzZW1hX2luaXQoJm5ldF9ub2RlLT5zZW1hcGhvcmUsIDEpOworCisJaW5pdF93YWl0cXVl
dWVfaGVhZCgmbmV0X25vZGUtPmluaXRpYWxpemVfd2FpdCk7CisJaW5pdF93YWl0cXVldWVfaGVh
ZCgmbmV0X25vZGUtPnNlbGVjdF9pbl93YWl0KTsKKwlpbml0X3dhaXRxdWV1ZV9oZWFkKCZuZXRf
bm9kZS0+c2VsZWN0X291dF93YWl0KTsKKwlpbml0X3dhaXRxdWV1ZV9oZWFkKCZuZXRfbm9kZS0+
c2VsZWN0X2V4X3dhaXQpOworCWluaXRfd2FpdHF1ZXVlX2hlYWQoJm5ldF9ub2RlLT5jbWRfcnNw
X3dhaXQpOworfQorCitzdGF0aWMgdm9pZCBucHJlYWxfaW5pdF90dHlfbm9kZShzdHJ1Y3QgbnBy
ZWFsX3N0cnVjdCAqdHR5X25vZGUsIHN0cnVjdCBuZF9zdHJ1Y3QgKm5ldF9ub2RlLCBpbnQgaSkK
K3sKKwl0dHlfbm9kZS0+bmV0X25vZGUgPSBuZXRfbm9kZTsKKwl0dHlfbm9kZS0+cG9ydCA9IGk7
CisJdHR5X25vZGUtPnR5cGUgPSBQT1JUXzE2NTUwQTsKKwl0dHlfbm9kZS0+ZmxhZ3MgPSAwOwor
CXR0eV9ub2RlLT54bWl0X2ZpZm9fc2l6ZSA9IDE2OworCXR0eV9ub2RlLT5iYXVkX2Jhc2UgPSA5
MjE2MDBMOworCXR0eV9ub2RlLT5jbG9zZV9kZWxheSA9IDUgKiBIWiAvIDEwOworCXR0eV9ub2Rl
LT5jbG9zaW5nX3dhaXQgPSAzMCAqIEhaOworCXR0eV9ub2RlLT5ub3JtYWxfdGVybWlvcyA9IG5w
dmFyX3Nkcml2ZXItPmluaXRfdGVybWlvczsKKworCW1lbXNldCgmdHR5X25vZGUtPmljb3VudCwg
MCwgc2l6ZW9mKHR0eV9ub2RlLT5pY291bnQpKTsKKwlJTklUX1dPUksoJnR0eV9ub2RlLT5wcm9j
ZXNzX2ZsaXBfdHF1ZXVlLCBucHJlYWxfZmx1c2hfdG9fbGRpc2MpOworCUlOSVRfV09SSygmdHR5
X25vZGUtPnRxdWV1ZSwgbnByZWFsX2RvX3NvZnRpbnQpOworCXNwaW5fbG9ja19pbml0KCZ0dHlf
bm9kZS0+dHhfbG9jayk7CisJc2VtYV9pbml0KCZ0dHlfbm9kZS0+cnhfc2VtYXBob3JlLCAxKTsK
KworCWluaXRfd2FpdHF1ZXVlX2hlYWQoJnR0eV9ub2RlLT5vcGVuX3dhaXQpOworCWluaXRfd2Fp
dHF1ZXVlX2hlYWQoJnR0eV9ub2RlLT5jbG9zZV93YWl0KTsKKwlpbml0X3dhaXRxdWV1ZV9oZWFk
KCZ0dHlfbm9kZS0+ZGVsdGFfbXNyX3dhaXQpOworfQorCitzdGF0aWMgaW50IG5wcmVhbF9pbml0
KHN0cnVjdCBucHJlYWxfc3RydWN0ICp0dHlfbm9kZSwgc3RydWN0IG5kX3N0cnVjdCAqbmV0X25v
ZGUpCit7CisJc3RydWN0IHByb2NfZGlyX2VudHJ5ICpkZTsKKwljaGFyIGJ1Zls0XTsKKwlpbnQg
aTsKKworCW5wdmFyX3Byb2Nfcm9vdCA9IHByb2NfbWtkaXIoIm5wcmVhbDIiLCBOVUxMKTsKKwlp
ZiAoIW5wdmFyX3Byb2Nfcm9vdCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwl0dHlfbm9kZSA9ICZu
cHZhcl90YWJsZVswXTsKKwluZXRfbm9kZSA9ICZucHZhcl9uZXRfbm9kZXNbMF07CisKKwlmb3Ig
KGkgPSAwOyBpIDwgTlBSRUFMX1BPUlRTOyBpKyssIHR0eV9ub2RlKyssIG5ldF9ub2RlKyspIHsK
KwkJc3ByaW50ZihidWYsICIlZCIsIGkpOworCQlkZSA9IHByb2NfY3JlYXRlX2RhdGEoYnVmLCAw
NjY2IHwgU19JRlJFRywgbnB2YXJfcHJvY19yb290LCAmbnByZWFsX25ldF9mb3BzLAorCQkJCQko
dm9pZCAqKW5ldF9ub2RlKTsKKwkJaWYgKCFkZSkKKwkJCXJldHVybiAtRU5PTUVNOworCisJCW5w
cmVhbF9pbml0X25ldF9ub2RlKG5ldF9ub2RlLCB0dHlfbm9kZSwgZGUpOworCQlucHJlYWxfaW5p
dF90dHlfbm9kZSh0dHlfbm9kZSwgbmV0X25vZGUsIGkpOworCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IG5wcmVhbF9jaGFyc19pbl9idWZmZXIoc3RydWN0IHR0eV9zdHJ1Y3QgKnR0
eSkKK3sKKwlzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVj
dCAqKXR0eS0+ZHJpdmVyX2RhdGE7CisKKwlpZiAoIWluZm8pCisJCXJldHVybiAtRUlPOworCisJ
cmV0dXJuIGluZm8tPnhtaXRfY250OworfQorCitzdGF0aWMgaW50IG5wcmVhbF9ibG9ja190aWxs
X3JlYWR5KHN0cnVjdCB0dHlfc3RydWN0ICp0dHksIHN0cnVjdCBmaWxlICpmaWxwLAorCQkJCQkJ
c3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8pCit7CisJREVDTEFSRV9XQUlUUVVFVUUod2FpdCwg
Y3VycmVudCk7CisJc3RydWN0IG5kX3N0cnVjdCAqbmQ7CisJaW50IGRvX2Nsb2NhbCA9IDA7CisJ
aW50IHJldHZhbCA9IDA7CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJCXJl
dHVybiAtRUlPOworCisJaWYgKChmaWxwLT5mX2ZsYWdzICYgT19OT05CTE9DSykgfHwgdGVzdF9i
aXQoVFRZX0lPX0VSUk9SLCAmdHR5LT5mbGFncykpIHsKKwkJaW5mby0+ZmxhZ3MgfD0gQVNZTkNf
Tk9STUFMX0FDVElWRTsKKwkJcmV0dXJuIDA7CisJfQorCisJaWYgKHR0eS0+dGVybWlvcy5jX2Nm
bGFnICYgQ0xPQ0FMKQorCQlkb19jbG9jYWwgPSAxOworCisJYWRkX3dhaXRfcXVldWUoJmluZm8t
Pm9wZW5fd2FpdCwgJndhaXQpOworCXdoaWxlICgxKSB7CisJCWlmICh0dHlfaHVuZ191cF9wKGZp
bHApKQorCQkJYnJlYWs7CisJCWVsc2UgaWYgKGluZm8tPmZsYWdzICYgQVNZTkNfQ0xPU0lORykg
eworCQkJaWYgKFNFUklBTF9ET19SRVNUQVJUICYmICEoaW5mby0+ZmxhZ3MgJiBBU1lOQ19IVVBf
Tk9USUZZKSkKKwkJCQlyZXR2YWwgPSAtRVJFU1RBUlRTWVM7CisJCQllbHNlCisJCQkJcmV0dmFs
ID0gLUVBR0FJTjsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYgKCEoaW5mby0+ZmxhZ3MgJiBBU1lO
Q19DTE9TSU5HKSAmJgorCQkJKGRvX2Nsb2NhbCB8fCAoaW5mby0+bW9kZW1fc3RhdHVzICYgVUFS
VF9NU1JfRENEKSkpCisJCQlicmVhazsKKworCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkp
IHsKKwkJCXJldHZhbCA9IC1FSU87CisJCQlicmVhazsKKwkJfQorCisJCWN1cnJlbnQtPnN0YXRl
ID0gVEFTS19JTlRFUlJVUFRJQkxFOworCQlzY2hlZHVsZSgpOworCX0KKworCXJlbW92ZV93YWl0
X3F1ZXVlKCZpbmZvLT5vcGVuX3dhaXQsICZ3YWl0KTsKKwlpZiAoIXJldHZhbCkKKwkJaW5mby0+
ZmxhZ3MgfD0gQVNZTkNfTk9STUFMX0FDVElWRTsKKworCXJldHVybiByZXR2YWw7Cit9CisKK3N0
YXRpYyB2b2lkIHNldF9jb21tb25feG1pdF9maWZvX3NpemUoc3RydWN0IG5wcmVhbF9zdHJ1Y3Qg
KmluZm8sIHN0cnVjdCBuZF9zdHJ1Y3QgKm5kKQoreworCWlmIChpbmZvLT50eXBlID09IFBPUlRf
MTY1NTBBKSB7CisJCWlmIChuZC0+c2VydmVyX3R5cGUgPT0gQ04yNTAwKQorCQkJaW5mby0+eG1p
dF9maWZvX3NpemUgPSA2NDsKKwkJZWxzZQorCQkJaW5mby0+eG1pdF9maWZvX3NpemUgPSAxNjsK
Kwl9IGVsc2UgeworCQlpbmZvLT54bWl0X2ZpZm9fc2l6ZSA9IDE7CisJfQorfQorCitzdGF0aWMg
aW50IG5wcmVhbF9wb3J0X3NodXRkb3duKHN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvKQorewor
CXN0cnVjdCBuZF9zdHJ1Y3QgKm5kOworCWNoYXIgcnNwX2J1ZmZlcltSU1BfQlVGRkVSX1NJWkVd
OworCWludCByc3BfbGVuZ3RoID0gUlNQX0JVRkZFUl9TSVpFOworCisJbmQgPSBpbmZvLT5uZXRf
bm9kZTsKKwlpZiAoIW5kKQorCQlyZXR1cm4gLUVJTzsKKworCW5wcmVhbF9kaXNjb25uZWN0KG5k
LCByc3BfYnVmZmVyLCAmcnNwX2xlbmd0aCk7CisJbmQtPmZsYWcgJj0gfk5QUkVBTF9ORVRfVFRZ
X0lOVVNFRDsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBucHJlYWxfZ2V0X3NlcmlhbF9p
bmZvKHN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3Qgc2VyaWFsX3N0cnVjdCAqcmV0
aW5mbykKK3sKKwlzdHJ1Y3Qgc2VyaWFsX3N0cnVjdCB0bXA7CisKKwlpZiAoIXJldGluZm8pCisJ
CXJldHVybiAtRUZBVUxUOworCisJbWVtc2V0KCZ0bXAsIDAsIHNpemVvZih0bXApKTsKKwl0bXAu
dHlwZSA9IGluZm8tPnR5cGU7CisJdG1wLmxpbmUgPSBpbmZvLT5wb3J0OworCXRtcC5mbGFncyA9
IGluZm8tPmZsYWdzOworCXRtcC5jbG9zZV9kZWxheSA9IGluZm8tPmNsb3NlX2RlbGF5OworCXRt
cC5jbG9zaW5nX3dhaXQgPSBpbmZvLT5jbG9zaW5nX3dhaXQ7CisJdG1wLmN1c3RvbV9kaXZpc29y
ID0gaW5mby0+Y3VzdG9tX2Rpdmlzb3I7CisJdG1wLmJhdWRfYmFzZSA9IGluZm8tPmJhdWRfYmFz
ZTsKKwl0bXAuaHViNiA9IDA7CisKKwlpZiAoY29weV90b191c2VyKHJldGluZm8sICZ0bXAsIHNp
emVvZigqcmV0aW5mbykpKQorCQlyZXR1cm4gLUVGQVVMVDsKKwllbHNlCisJCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IG5wcmVhbF9zZXRfc2VyaWFsX2luZm8oc3RydWN0IG5wcmVhbF9zdHJ1
Y3QgKmluZm8sIHN0cnVjdCBzZXJpYWxfc3RydWN0ICpuZXdfaW5mbykKK3sKKwlzdHJ1Y3Qgc2Vy
aWFsX3N0cnVjdCBuZXdfc2VyaWFsOworCWludCByc3BfbGVuZ3RoID0gUlNQX0JVRkZFUl9TSVpF
OworCWludCByZXR2YWwgPSAwOworCXVuc2lnbmVkIGludCBmbGFnczsKKwljaGFyIHJzcF9idWZm
ZXJbUlNQX0JVRkZFUl9TSVpFXTsKKworCisJaWYgKCghbmV3X2luZm8pIHx8IGNvcHlfZnJvbV91
c2VyKCZuZXdfc2VyaWFsLCBuZXdfaW5mbywgc2l6ZW9mKG5ld19zZXJpYWwpKSkKKwkJcmV0dXJu
IC1FRkFVTFQ7CisKKwlmbGFncyA9IGluZm8tPmZsYWdzICYgQVNZTkNfU1BEX01BU0s7CisKKwlp
ZiAoIWNhcGFibGUoQ0FQX1NZU19BRE1JTikpIHsKKwkJaWYgKChuZXdfc2VyaWFsLmNsb3NlX2Rl
bGF5ICE9IGluZm8tPmNsb3NlX2RlbGF5KSB8fAorCQkJKChuZXdfc2VyaWFsLmZsYWdzICYgfkFT
WU5DX1VTUl9NQVNLKSAhPSAoaW5mby0+ZmxhZ3MgJiB+QVNZTkNfVVNSX01BU0spKSkKKwkJCXJl
dHVybiAtRVBFUk07CisKKwkJaW5mby0+ZmxhZ3MgPSAoKGluZm8tPmZsYWdzICYgfkFTWU5DX1VT
Ul9NQVNLKSB8CisJCQkJKG5ld19zZXJpYWwuZmxhZ3MgJiBBU1lOQ19VU1JfTUFTSykpOworCX0g
ZWxzZSB7CisJCWluZm8tPmZsYWdzID0gKChpbmZvLT5mbGFncyAmIH5BU1lOQ19GTEFHUykgfCAo
bmV3X3NlcmlhbC5mbGFncyAmIEFTWU5DX0ZMQUdTKSk7CisJCWluZm8tPmNsb3NlX2RlbGF5ID0g
bmV3X3NlcmlhbC5jbG9zZV9kZWxheSAqIEhaIC8gMTAwOworCisJCWlmIChuZXdfc2VyaWFsLmNs
b3Npbmdfd2FpdCA9PSBBU1lOQ19DTE9TSU5HX1dBSVRfTk9ORSkKKwkJCWluZm8tPmNsb3Npbmdf
d2FpdCA9IEFTWU5DX0NMT1NJTkdfV0FJVF9OT05FOworCQllbHNlCisJCQlpbmZvLT5jbG9zaW5n
X3dhaXQgPSBuZXdfc2VyaWFsLmNsb3Npbmdfd2FpdCAqIEhaIC8gMTAwOworCX0KKworCWluZm8t
PnR5cGUgPSBuZXdfc2VyaWFsLnR5cGU7CisJc2V0X2NvbW1vbl94bWl0X2ZpZm9fc2l6ZShpbmZv
LCBpbmZvLT5uZXRfbm9kZSk7CisKKwlpZiAoaW5mby0+ZmxhZ3MgJiBBU1lOQ19JTklUSUFMSVpF
RCkgeworCQlpZiAoZmxhZ3MgIT0gKGluZm8tPmZsYWdzICYgQVNZTkNfU1BEX01BU0spKQorCQkJ
cmV0dmFsID0gbnByZWFsX3BvcnRfaW5pdChpbmZvLCAwKTsKKworCQlpZiAoaW5mby0+bmV0X25v
ZGUpCisJCQlucHJlYWxfc2V0X3R4X2ZpZm9fY29tbWFuZF9kb25lKGluZm8sIGluZm8tPm5ldF9u
b2RlLCByc3BfYnVmZmVyLAorCQkJCQkJCSZyc3BfbGVuZ3RoKTsKKworCX0KKworCWluZm8tPmN1
c3RvbV9kaXZpc29yID0gbmV3X3NlcmlhbC5jdXN0b21fZGl2aXNvcjsKKworCWlmIChpbmZvLT5j
dXN0b21fZGl2aXNvciA9PSAwKQorCQlpbmZvLT5iYXVkX2Jhc2UgPSA5MjE2MDBMOworCWVsc2UK
KwkJaW5mby0+YmF1ZF9iYXNlID0gbmV3X3NlcmlhbC5iYXVkX2Jhc2U7CisKKwlyZXR1cm4gcmV0
dmFsOworfQorCisvKioKKyAqIG5wcmVhbF9nZXRfbHNyX2luZm8oKSAtIGdldCBsaW5lIHN0YXR1
cyByZWdpc3RlciBpbmZvCisgKgorICogTGV0IHVzZXIgY2FsbCBpb2N0bCgpIHRvIGdldCBpbmZv
IHdoZW4gdGhlIFVBUlQgcGh5c2ljYWxseSBpcyBlbXB0aWVkLgorICogT24gYnVzIHR5cGVzIGxp
a2UgUlM0ODUsIHRoZSB0cmFuc21pdHRlciBtdXN0IHJlbGVhc2UgdGhlIGJ1cyBhZnRlcgorICog
dHJhbnNtaXR0aW5nLiBUaGlzIG11c3QgYmUgZG9uZSB3aGVuIHRoZSB0cmFuc21pdCBzaGlmdCBy
ZWdpc3RlciBpcworICogZW1wdHksIG5vdCBiZSBkb25lIHdoZW4gdGhlIHRyYW5zbWl0IGhvbGRp
bmcgcmVnaXN0ZXIgaXMgZW1wdHkuCisgKiBUaGlzIGZ1bmN0aW9uYWxpdHkgYWxsb3dzIGFuIFJT
NDg1IGRyaXZlciB0byBiZSB3cml0dGVuIGluIHVzZXIgc3BhY2UuCisgKgorICogQWx3YXlzIHJl
dHVybiAwIHdoZW4gZnVuY3Rpb24gaXMgZW5kZWQuCisgKi8KK3N0YXRpYyBpbnQgbnByZWFsX2dl
dF9sc3JfaW5mbyhzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywKKwkJCQl1bnNpZ25lZCBpbnQg
KnZhbHVlKQoreworCXVuc2lnbmVkIGludCByZXN1bHQgPSAwOworCisJaWYgKG5wcmVhbF93YWl0
X29xdWV1ZShpbmZvLCAwKSA9PSAwKQorCQlyZXN1bHQgPSBUSU9DU0VSX1RFTVQ7CisKKwlwdXRf
dXNlcihyZXN1bHQsIHZhbHVlKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IG5wcmVh
bF9zdGFydF9icmVhayhzdHJ1Y3QgbmRfc3RydWN0ICpuZCkKK3sKKwljaGFyIHJzcF9idWZmZXJb
UlNQX0JVRkZFUl9TSVpFXTsKKwlpbnQgcnNwX2xlbmd0aCA9IFJTUF9CVUZGRVJfU0laRTsKKwor
CW5wcmVhbF93YWl0X2FuZF9zZXRfY29tbWFuZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQs
IEFTUFBfQ01EX1NUQVJUX0JSRUFLKTsKKwluZC0+Y21kX2J1ZmZlclsyXSA9IDA7CisJbmQtPmNt
ZF9yZWFkeSA9IDE7CisJc21wX21iKCk7IC8qIHVzZSBzbXBfbWIoKSB3aXRoIHdhaXRxdWV1ZV9h
Y3RpdmUoKSAqLworCS8qIHVzZWQgd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIHNhZmUgYmVjYXVzZSBz
bXBfbWIoKSBpcyB1c2VkICovCisJaWYgKHdhaXRxdWV1ZV9hY3RpdmUoJm5kLT5zZWxlY3RfZXhf
d2FpdCkpCisJCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmbmQtPnNlbGVjdF9leF93YWl0KTsKKwor
CWlmIChucHJlYWxfd2FpdF9jb21tYW5kX2NvbXBsZXRlZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFO
RF9TRVQsIEFTUFBfQ01EX1NUQVJUX0JSRUFLLAorCQkJCQlOUFJFQUxfQ01EX1RJTUVPVVQsIHJz
cF9idWZmZXIsICZyc3BfbGVuZ3RoKSkKKwkJcmV0dXJuIC1FSU87CisKKwlpZiAoKHJzcF9sZW5n
dGggIT0gNCkgfHwgKHJzcF9idWZmZXJbMl0gIT0gJ08nKSB8fCAocnNwX2J1ZmZlclszXSAhPSAn
SycpKQorCQlyZXR1cm4gLUVJTzsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IG5wcmVh
bF9zdG9wX2JyZWFrKHN0cnVjdCBuZF9zdHJ1Y3QgKm5kKQoreworCWNoYXIgcnNwX2J1ZmZlcltS
U1BfQlVGRkVSX1NJWkVdOworCWludCByc3BfbGVuZ3RoID0gUlNQX0JVRkZFUl9TSVpFOworCisJ
bnByZWFsX3dhaXRfYW5kX3NldF9jb21tYW5kKG5kLCBOUFJFQUxfQVNQUF9DT01NQU5EX1NFVCwg
QVNQUF9DTURfU1RPUF9CUkVBSyk7CisJbmQtPmNtZF9idWZmZXJbMl0gPSAwOworCW5kLT5jbWRf
cmVhZHkgPSAxOworCXNtcF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVfYWN0
aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21w
X21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0X2V4X3dh
aXQpKQorCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJm5kLT5zZWxlY3RfZXhfd2FpdCk7CisKKwly
c3BfbGVuZ3RoID0gc2l6ZW9mKHJzcF9idWZmZXIpOworCWlmIChucHJlYWxfd2FpdF9jb21tYW5k
X2NvbXBsZXRlZChuZCwgTlBSRUFMX0FTUFBfQ09NTUFORF9TRVQsIEFTUFBfQ01EX1NUT1BfQlJF
QUssCisJCQkJCU5QUkVBTF9DTURfVElNRU9VVCwgcnNwX2J1ZmZlciwgJnJzcF9sZW5ndGgpKQor
CQlyZXR1cm4gLUVJTzsKKworCWlmIChyc3BfbGVuZ3RoICE9IDQgIHx8IChyc3BfYnVmZmVyWzJd
ICE9ICdPJykgfHwgKHJzcF9idWZmZXJbM10gIT0gJ0snKSkKKwkJcmV0dXJuIC1FSU87CisKKwly
ZXR1cm4gMDsKK30KKworLyoqCisgKiBucHJlYWxfc2VuZF9icmVhaygpIC0gU2VuZHMgYnJlYWsg
Y2hhcmFjdGVycyBvdXQgdGhlIHNlcmlhbCBwb3J0LgorICogQGluZm86IHBvaW50ZXIgZm9yIG5w
cmVhZF9zdHJ1Y3QKKyAqIEBkdXJhdGlvbjogdGhlIHRpbWUgZHVyaW5nIHNlbmRpbmcgYnJlYWsg
c2lnbmFscworICoKKyAqIFRoaXMgaXMgY2FsbGVkIGJ5IG5wcmVhbF9pb2N0bCgpIHdpdGggY2Fz
ZSBvZiBUQ1NCUksgb3IgVENTQlJLUAorICovCitzdGF0aWMgdm9pZCBucHJlYWxfc2VuZF9icmVh
ayhzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywgdW5zaWduZWQgaW50IGR1cmF0aW9uKQorewor
CXN0cnVjdCBuZF9zdHJ1Y3QgKm5kOworCisJbmQgPSBpbmZvLT5uZXRfbm9kZTsKKwlpZiAoIW5k
KQorCQlyZXR1cm47CisKKwlucHJlYWxfc3RhcnRfYnJlYWsobmQpOworCWN1cnJlbnQtPnN0YXRl
ID0gVEFTS19JTlRFUlJVUFRJQkxFOworCXNjaGVkdWxlX3RpbWVvdXQoZHVyYXRpb24pOworCW5w
cmVhbF9zdG9wX2JyZWFrKG5kKTsKK30KKworc3RhdGljIHZvaWQgbnByZWFsX3JlbW92ZV9wcm9j
X2VudHJ5KHN0cnVjdCBwcm9jX2Rpcl9lbnRyeSAqcGRlLCBpbnQgaWR4KQoreworCWNoYXIgdG1w
WzEwXTsKKworCWlmICghcGRlKQorCQlyZXR1cm47CisKKwlzcHJpbnRmKHRtcCwgIiVkIiwgaWR4
KTsKKworCWlmIChpZHggPT0gNDA0KQorCQlyZW1vdmVfcHJvY19lbnRyeSgibnByZWFsMiIsIE5V
TEwpOworCWVsc2UKKwkJcmVtb3ZlX3Byb2NfZW50cnkodG1wLCBucHZhcl9wcm9jX3Jvb3QpOwor
fQorCitzdGF0aWMgdm9pZCBucHJlYWxfcHJvY2Vzc19ub3RpZnkoc3RydWN0IG5kX3N0cnVjdCAq
bmQsIGNoYXIgKnJzcF9idWZmZXIsIGludCByc3BfbGVuZ3RoKQoreworCXN0cnVjdCBucHJlYWxf
c3RydWN0ICppbmZvID0gbmQtPnR0eV9ub2RlOworCWludCBzdGF0ZTsKKworCWlmICghaW5mbyB8
fCByc3BfbGVuZ3RoICE9IDUpCisJCXJldHVybjsKKworCWlmIChyc3BfYnVmZmVyWzJdICYgQVNQ
UF9OT1RJRllfTVNSX0NIRykgeworCQlzdGF0ZSA9IDA7CisKKwkJaWYgKHJzcF9idWZmZXJbM10g
JiAweDEwKQorCQkJc3RhdGUgfD0gVUFSVF9NU1JfQ1RTOworCQlpZiAocnNwX2J1ZmZlclszXSAm
IDB4MjApCisJCQlzdGF0ZSB8PSBVQVJUX01TUl9EU1I7CisJCWlmIChyc3BfYnVmZmVyWzNdICYg
MHg4MCkKKwkJCXN0YXRlIHw9IFVBUlRfTVNSX0RDRDsKKwkJbnByZWFsX2NoZWNrX21vZGVtX3N0
YXR1cyhpbmZvLCBzdGF0ZSk7CisJfQorCisJaWYgKHJzcF9idWZmZXJbMl0gJiBBU1BQX05PVElG
WV9CUkVBSykgeworCQlzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5OworCisJCWRvd24oJmluZm8tPnJ4
X3NlbWFwaG9yZSk7CisJCXR0eSA9IGluZm8tPnR0eTsKKwkJaWYgKCF0dHkgfHwgIWluZm8tPnR0
eVBvcnQubG93X2xhdGVuY3kpIHsKKwkJCXVwKCZpbmZvLT5yeF9zZW1hcGhvcmUpOworCQkJcmV0
dXJuOworCQl9CisKKwkJdHR5X2luc2VydF9mbGlwX2NoYXIoJmluZm8tPnR0eVBvcnQsIDAsIFRU
WV9CUkVBSyk7CisJCXVwKCZpbmZvLT5yeF9zZW1hcGhvcmUpOworCQlpbmZvLT5pY291bnQucngr
KzsKKwkJaW5mby0+aWNvdW50LmJyaysrOworCQlzY2hlZHVsZV93b3JrKCZpbmZvLT5wcm9jZXNz
X2ZsaXBfdHF1ZXVlKTsKKworCQlpZiAoaW5mby0+ZmxhZ3MgJiBBU1lOQ19TQUspCisJCQlkb19T
QUsoaW5mby0+dHR5KTsKKwl9CisKKwlpZiAocnNwX2J1ZmZlclsyXSAmIEFTUFBfTk9USUZZX1BB
UklUWSkKKwkJaW5mby0+aWNvdW50LnBhcml0eSsrOworCWlmIChyc3BfYnVmZmVyWzJdICYgQVNQ
UF9OT1RJRllfRlJBTUlORykKKwkJaW5mby0+aWNvdW50LmZyYW1lKys7CisJaWYgKChyc3BfYnVm
ZmVyWzJdICYgQVNQUF9OT1RJRllfU1dfT1ZFUlJVTikgfHwgKHJzcF9idWZmZXJbMl0gJiBBU1BQ
X05PVElGWV9IV19PVkVSUlVOKSkKKwkJaW5mby0+aWNvdW50Lm92ZXJydW4rKzsKK30KKworc3Rh
dGljIGludDMyX3QgbnByZWFsX2RvX3Nlc3Npb25fbW9kZShzdHJ1Y3Qga3Rlcm1pb3MgKnRlcm1p
bykKK3sKKwlpbnQzMl90IG1vZGU7CisKKwltb2RlID0gdGVybWlvLT5jX2NmbGFnICYgQ1NJWkU7
CisJc3dpdGNoIChtb2RlKSB7CisJY2FzZSBDUzU6CisJCW1vZGUgPSBBU1BQX0lPQ1RMX0JJVFM1
OworCQlicmVhazsKKworCWNhc2UgQ1M2OgorCQltb2RlID0gQVNQUF9JT0NUTF9CSVRTNjsKKwkJ
YnJlYWs7CisKKwljYXNlIENTNzoKKwkJbW9kZSA9IEFTUFBfSU9DVExfQklUUzc7CisJCWJyZWFr
OworCisJY2FzZSBDUzg6CisJCW1vZGUgPSBBU1BQX0lPQ1RMX0JJVFM4OworCQlicmVhazsKKwor
CX0KKworCWlmICh0ZXJtaW8tPmNfY2ZsYWcgJiBDU1RPUEIpCisJCW1vZGUgfD0gQVNQUF9JT0NU
TF9TVE9QMjsKKwllbHNlCisJCW1vZGUgfD0gQVNQUF9JT0NUTF9TVE9QMTsKKworCWlmICh0ZXJt
aW8tPmNfY2ZsYWcgJiBQQVJFTkIpIHsKKwkJaWYgKHRlcm1pby0+Y19jZmxhZyAmIFBBUk9ERCkK
KwkJCW1vZGUgfD0gQVNQUF9JT0NUTF9PREQ7CisJCWVsc2UKKwkJCW1vZGUgfD0gQVNQUF9JT0NU
TF9FVkVOOworCX0gZWxzZSB7CisJCW1vZGUgfD0gQVNQUF9JT0NUTF9OT05FOworCX0KKworCXJl
dHVybiBtb2RlOworfQorCitzdGF0aWMgdm9pZCBucHJlYWxfZG9fc2Vzc2lvbl9iYXVkKHN0cnVj
dCBucHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3Qga3Rlcm1pb3MgKnRlcm1pbywKKwkJCQkJCQlp
bnQzMl90ICpiYXVkX3JldCwgaW50ICpiYXVkX2luZF9yZXQpCit7CisJaW50MzJfdCBiYXVkOwor
CWludCBiYXVkSW5kZXg7CisKKwlzd2l0Y2ggKHRlcm1pby0+Y19jZmxhZyAmIChDQkFVRCB8IENC
QVVERVgpKSB7CisJY2FzZSBCOTIxNjAwOgorCQliYXVkID0gOTIxNjAwTDsKKwkJYmF1ZEluZGV4
ID0gQVNQUF9JT0NUTF9COTIxNjAwOworCQlicmVhazsKKworCWNhc2UgQjQ2MDgwMDoKKwkJYmF1
ZCA9IDQ2MDgwMDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CNDYwODAwOworCQlicmVhazsK
KworCWNhc2UgQjIzMDQwMDoKKwkJYmF1ZCA9IDIzMDQwMEw7CisJCWJhdWRJbmRleCA9IEFTUFBf
SU9DVExfQjIzMDQwMDsKKwkJYnJlYWs7CisKKwljYXNlIEIxMTUyMDA6CisJCWJhdWQgPSAxMTUy
MDBMOworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0IxMTUyMDA7CisJCWJyZWFrOworCisJY2Fz
ZSBCNTc2MDA6CisJCWJhdWQgPSA1NzYwMEw7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjU3
NjAwOworCQlicmVhazsKKworCWNhc2UgQjM4NDAwOgorCQliYXVkID0gMzg0MDBMOworCQliYXVk
SW5kZXggPSBBU1BQX0lPQ1RMX0IzODQwMDsKKwkJaWYgKChpbmZvLT5mbGFncyAmIEFTWU5DX1NQ
RF9NQVNLKSA9PSBBU1lOQ19TUERfSEkpIHsKKwkJCWJhdWQgPSA1NzYwMEw7CisJCQliYXVkSW5k
ZXggPSBBU1BQX0lPQ1RMX0I1NzYwMDsKKwkJfQorCisJCWlmICgoaW5mby0+ZmxhZ3MgJiBBU1lO
Q19TUERfTUFTSykgPT0gQVNZTkNfU1BEX1ZISSkgeworCQkJYmF1ZCA9IDExNTIwMEw7CisJCQli
YXVkSW5kZXggPSBBU1BQX0lPQ1RMX0IxMTUyMDA7CisJCX0KKyNpZmRlZiBBU1lOQ19TUERfU0hJ
CisJCWlmICgoaW5mby0+ZmxhZ3MgJiBBU1lOQ19TUERfTUFTSykgPT0gQVNZTkNfU1BEX1NISSkg
eworCQkJYmF1ZCA9IDIzMDQwMEw7CisJCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0IyMzA0MDA7
CisJCX0KKyNlbmRpZgorI2lmZGVmIEFTWU5DX1NQRF9XQVJQCisJCWlmICgoaW5mby0+ZmxhZ3Mg
JiBBU1lOQ19TUERfTUFTSykgPT0gQVNZTkNfU1BEX1dBUlApIHsKKwkJCWJhdWQgPSA0NjA4MDBM
OworCQkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CNDYwODAwOworCQl9CisjZW5kaWYKKwkJYnJl
YWs7CisKKwljYXNlIEIxOTIwMDoKKwkJYmF1ZCA9IDE5MjAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQ
UF9JT0NUTF9CMTkyMDA7CisJCWJyZWFrOworCisJY2FzZSBCOTYwMDoKKwkJYmF1ZCA9IDk2MDBM
OworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0I5NjAwOworCQlicmVhazsKKworCWNhc2UgQjQ4
MDA6CisJCWJhdWQgPSA0ODAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CNDgwMDsKKwkJ
YnJlYWs7CisKKwljYXNlIEIyNDAwOgorCQliYXVkID0gMjQwMEw7CisJCWJhdWRJbmRleCA9IEFT
UFBfSU9DVExfQjI0MDA7CisJCWJyZWFrOworCisJY2FzZSBCMTgwMDoKKwkJYmF1ZCA9IDE4MDBM
OworCQliYXVkSW5kZXggPSAweGZmOworCQlicmVhazsKKworCWNhc2UgQjEyMDA6CisJCWJhdWQg
PSAxMjAwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CMTIwMDsKKwkJYnJlYWs7CisKKwlj
YXNlIEI2MDA6CisJCWJhdWQgPSA2MDBMOworCQliYXVkSW5kZXggPSBBU1BQX0lPQ1RMX0I2MDA7
CisJCWJyZWFrOworCisJY2FzZSBCMzAwOgorCQliYXVkID0gMzAwTDsKKwkJYmF1ZEluZGV4ID0g
QVNQUF9JT0NUTF9CMzAwOworCQlicmVhazsKKworCWNhc2UgQjIwMDoKKwkJYmF1ZCA9IDIwMEw7
CisJCWJhdWRJbmRleCA9IDB4ZmY7CisJCWJyZWFrOworCisJY2FzZSBCMTUwOgorCQliYXVkID0g
MTUwTDsKKwkJYmF1ZEluZGV4ID0gQVNQUF9JT0NUTF9CMTUwOworCQlicmVhazsKKworCWNhc2Ug
QjEzNDoKKwkJYmF1ZCA9IDEzNEw7CisJCWJhdWRJbmRleCA9IEFTUFBfSU9DVExfQjEzNDsKKwkJ
YnJlYWs7CisKKwljYXNlIEIxMTA6CisJCWJhdWQgPSAxMTBMOworCQliYXVkSW5kZXggPSBBU1BQ
X0lPQ1RMX0IxMTA7CisJCWJyZWFrOworCisJY2FzZSBCNzU6CisJCWJhdWQgPSA3NUw7CisJCWJh
dWRJbmRleCA9IEFTUFBfSU9DVExfQjc1OworCQlicmVhazsKKworCWNhc2UgQjUwOgorCQliYXVk
ID0gNTBMOworCQliYXVkSW5kZXggPSAweGZmOworCQlicmVhazsKKworCWRlZmF1bHQ6CisJCWJh
dWQgPSAwOworCQliYXVkSW5kZXggPSAweGZmOworCX0KKyNpZmRlZiBBU1lOQ19TUERfQ1VTVAor
CWlmICgoaW5mby0+ZmxhZ3MgJiBBU1lOQ19TUERfTUFTSykgPT0gQVNZTkNfU1BEX0NVU1QpCisJ
CWJhdWRJbmRleCA9IDB4ZmY7CisjZW5kaWYKKwkqYmF1ZF9yZXQgPSBiYXVkOworCSpiYXVkX2lu
ZF9yZXQgPSBiYXVkSW5kZXg7Cit9CisKK3N0YXRpYyB2b2lkIG5wcmVhbF9kb19zZXNzaW9uX2J1
ZmZlcihzdHJ1Y3QgbmRfc3RydWN0ICpuZCwgc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8sCisJ
CQkJc3RydWN0IGt0ZXJtaW9zICp0ZXJtaW8sIGludCBiYXVkLCBpbnQgbW9kZSwgaW50IGJhdWRJ
bmRleCkKK3sKKwluZC0+Y21kX2J1ZmZlclswXSA9IE5QUkVBTF9BU1BQX0NPTU1BTkRfU0VUOwor
CW5kLT5jbWRfYnVmZmVyWzFdID0gQVNQUF9DTURfUE9SVF9JTklUOworCW5kLT5jbWRfYnVmZmVy
WzJdID0gODsKKwluZC0+Y21kX2J1ZmZlclszXSA9IGJhdWRJbmRleDsgICAvKiBiYXVkIHJhdGUg
Ki8KKwluZC0+Y21kX2J1ZmZlcls0XSA9IG1vZGU7ICAgICAgIC8qIG1vZGUgKi8KKworCS8qIGxp
bmUgY29udHJvbCAqLworCWlmIChpbmZvLT5tb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfRFRSKQor
CQluZC0+Y21kX2J1ZmZlcls1XSA9IDE7CisJZWxzZQorCQluZC0+Y21kX2J1ZmZlcls1XSA9IDA7
CisJaWYgKGluZm8tPm1vZGVtX2NvbnRyb2wgJiBVQVJUX01DUl9SVFMpCisJCW5kLT5jbWRfYnVm
ZmVyWzZdID0gMTsKKwllbHNlCisJCW5kLT5jbWRfYnVmZmVyWzZdID0gMDsKKworCS8qIGZsb3cg
Y29udHJvbCAqLworCWlmICgoaW5mby0+ZmxhZ3MgJiBBU1lOQ19JTklUSUFMSVpFRCkgJiYgKHRl
cm1pby0+Y19jZmxhZyAmIENSVFNDVFMpKSB7CisJCW5kLT5jbWRfYnVmZmVyWzddID0gMTsKKwkJ
bmQtPmNtZF9idWZmZXJbOF0gPSAxOworCX0gZWxzZSB7CisJCW5kLT5jbWRfYnVmZmVyWzddID0g
MDsKKwkJbmQtPmNtZF9idWZmZXJbOF0gPSAwOworCX0KKworCWlmICh0ZXJtaW8tPmNfaWZsYWcg
JiBJWE9OKQorCQluZC0+Y21kX2J1ZmZlcls5XSA9IDE7CisJZWxzZQorCQluZC0+Y21kX2J1ZmZl
cls5XSA9IDA7CisJaWYgKHRlcm1pby0+Y19pZmxhZyAmIElYT0ZGKQorCQluZC0+Y21kX2J1ZmZl
clsxMF0gPSAxOworCWVsc2UKKwkJbmQtPmNtZF9idWZmZXJbMTBdID0gMDsKKworCWlmICgoYmF1
ZEluZGV4ID09IDB4ZmYpICYmIChiYXVkICE9IDApKSB7CisJCW5kLT5jbWRfYnVmZmVyWzExXSA9
IEFTUFBfQ01EX1NFVEJBVUQ7CisJCW5kLT5jbWRfYnVmZmVyWzEyXSA9IDQ7CisKKwkJaWYgKCgo
aW5mby0+ZmxhZ3MgJiBBU1lOQ19TUERfTUFTSykgPT0gQVNZTkNfU1BEX0NVU1QpICYmIGluZm8t
PmN1c3RvbV9kaXZpc29yKQorCQkJYmF1ZCA9IGluZm8tPmJhdWRfYmFzZS9pbmZvLT5jdXN0b21f
ZGl2aXNvcjsKKworCQltZW1jcHkoJm5kLT5jbWRfYnVmZmVyWzEzXSwgJmJhdWQsIDQpOworCX0K
KworCWlmICh0ZXJtaW8tPmNfaWZsYWcgJiAoSVhPTiB8IElYT0ZGKSkgeworCQluZC0+Y21kX2J1
ZmZlclsxN10gPSBBU1BQX0NNRF9YT05YT0ZGOworCQluZC0+Y21kX2J1ZmZlclsxOF0gPSAyOwor
CQluZC0+Y21kX2J1ZmZlclsxOV0gPSB0ZXJtaW8tPmNfY2NbVlNUQVJUXTsKKwkJbmQtPmNtZF9i
dWZmZXJbMjBdID0gdGVybWlvLT5jX2NjW1ZTVE9QXTsKKwl9CisKKwluZC0+Y21kX2J1ZmZlclsy
MV0gPSBBU1BQX0NNRF9UWF9GSUZPOworCW5kLT5jbWRfYnVmZmVyWzIyXSA9IDE7CisJbmQtPmNt
ZF9idWZmZXJbMjNdID0gaW5mby0+eG1pdF9maWZvX3NpemU7CisJbmQtPmNtZF9idWZmZXJbMjRd
ID0gQVNQUF9DTURfTElORUNUUkw7CisJbmQtPmNtZF9idWZmZXJbMjVdID0gMjsKKworCWlmIChp
bmZvLT5tb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfRFRSKQorCQluZC0+Y21kX2J1ZmZlclsyNl0g
PSAxOworCWVsc2UKKwkJbmQtPmNtZF9idWZmZXJbMjZdID0gMDsKKwlpZiAoaW5mby0+bW9kZW1f
Y29udHJvbCAmIFVBUlRfTUNSX1JUUykKKwkJbmQtPmNtZF9idWZmZXJbMjddID0gMTsKKwllbHNl
CisJCW5kLT5jbWRfYnVmZmVyWzI3XSA9IDA7CisKKwluZC0+ZG9fc2Vzc2lvbl9yZWNvdmVyeV9s
ZW4gPSAyNyArIDE7Cit9CisKK3N0YXRpYyB2b2lkIG5wcmVhbF9kb19zZXNzaW9uX3JlY292ZXJ5
KHN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvKQoreworCXN0cnVjdCB0dHlfc3RydWN0ICp0dHk7
CisJc3RydWN0IG5kX3N0cnVjdCAqbmQ7CisJc3RydWN0IGt0ZXJtaW9zICp0ZXJtaW87CisJaW50
MzJfdCBiYXVkLCBtb2RlOworCWludCBiYXVkSW5kZXg7CisKKwl0dHkgPSBpbmZvLT50dHk7CisJ
bmQgPSBpbmZvLT5uZXRfbm9kZTsKKworCWlmICghdHR5IHx8ICFuZCkKKwkJcmV0dXJuOworCisJ
aWYgKCEobmQtPmZsYWcgJiBOUFJFQUxfTkVUX05PREVfT1BFTkVEKSB8fCAhKG5kLT5mbGFnICYg
TlBSRUFMX05FVF9OT0RFX0NPTk5FQ1RFRCkpCisJCXJldHVybjsKKworCWlmIChpbmZvLT5mbGFn
cyAmIEFTWU5DX0lOSVRJQUxJWkVEKSB7CisJCXRlcm1pbyA9ICYoaW5mby0+dHR5LT50ZXJtaW9z
KTsKKwl9IGVsc2UgeworCQl0ZXJtaW8gPSAmaW5mby0+bm9ybWFsX3Rlcm1pb3M7CisKKwkJaWYg
KCF0ZXJtaW8pCisJCQlyZXR1cm47CisJfQorCisJZG93bigmbmQtPmNtZF9zZW1hcGhvcmUpOwor
CW1vZGUgPSBucHJlYWxfZG9fc2Vzc2lvbl9tb2RlKHRlcm1pbyk7CisJbnByZWFsX2RvX3Nlc3Np
b25fYmF1ZChpbmZvLCB0ZXJtaW8sICZiYXVkLCAmYmF1ZEluZGV4KTsKKwlucHJlYWxfZG9fc2Vz
c2lvbl9idWZmZXIobmQsIGluZm8sIHRlcm1pbywgYmF1ZCwgbW9kZSwgYmF1ZEluZGV4KTsKKwlu
ZC0+ZmxhZyB8PSBOUFJFQUxfTkVUX0RPX1NFU1NJT05fUkVDT1ZFUlk7CisJbmQtPmNtZF9yZWFk
eSA9IDE7CisJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkvKiB3YWl0cXVldWVfYWN0aXZlKCkg
aXMgc2FmZSBiZWNhdXNlIG5kLT5jbWRfcmVhZHkgaXMgaW4gc2VtYXBob3JlLiovCisJaWYgKHdh
aXRxdWV1ZV9hY3RpdmUoJm5kLT5zZWxlY3RfZXhfd2FpdCkpCisJCXdha2VfdXBfaW50ZXJydXB0
aWJsZSgmbmQtPnNlbGVjdF9leF93YWl0KTsKK30KKworc3RhdGljIGludCBucHJlYWxfc3RhcnR1
cF9zZXJpYWxfcG9ydChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywgc3RydWN0IG5kX3N0cnVj
dCAqbmQpCit7CisJaW50IHJldDsKKworCW5kLT5mbGFnICY9IH5OUFJFQUxfTkVUX0RPX1NFU1NJ
T05fUkVDT1ZFUlk7CisJaW5mby0+bW9kZW1fc3RhdHVzID0gMDsKKwlpbmZvLT5tb2RlbV9jb250
cm9sID0gMDsKKworCWlmIChpbmZvLT50dHktPnRlcm1pb3MuY19jZmxhZyAmIENCQVVEKQorCQlp
bmZvLT5tb2RlbV9jb250cm9sID0gVUFSVF9NQ1JfRFRSIHwgVUFSVF9NQ1JfUlRTOworCisJcmV0
ID0gbnByZWFsX3BvcnRfaW5pdChpbmZvLCAwKTsKKwlpZiAocmV0ICE9IDApCisJCXJldHVybiBy
ZXQ7CisKKwlzZXRfY29tbW9uX3htaXRfZmlmb19zaXplKGluZm8sIG5kKTsKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBucHJlYWxfc3RhcnR1cF9pbml0KHN0cnVjdCBucHJlYWxfc3RydWN0
ICppbmZvLCBzdHJ1Y3QgbmRfc3RydWN0ICpuZCwKKwkJCQkJc3RydWN0IHR0eV9zdHJ1Y3QgKnR0
eSwgdW5zaWduZWQgbG9uZyAqcGFnZSkKK3sKKwlERUNMQVJFX1dBSVRRVUVVRSh3YWl0LCBjdXJy
ZW50KTsKKworCWlmICghbmQpCisJCXJldHVybiAtRUlPOworCisJYWRkX3dhaXRfcXVldWUoJm5k
LT5pbml0aWFsaXplX3dhaXQsICZ3YWl0KTsKKwl3aGlsZSAodGVzdF9hbmRfc2V0X2JpdChOUFJF
QUxfTkVUX0RPX0lOSVRJQUxJWkUsICZuZC0+ZmxhZykpIHsKKwkJaWYgKHNpZ25hbF9wZW5kaW5n
KGN1cnJlbnQpKQorCQkJYnJlYWs7CisKKwkJc2NoZWR1bGUoKTsKKwl9CisKKwlyZW1vdmVfd2Fp
dF9xdWV1ZSgmbmQtPmluaXRpYWxpemVfd2FpdCwgJndhaXQpOworCisJaW5mby0+dHR5ID0gdHR5
OworCisJaWYgKGluZm8tPmZsYWdzICYgQVNZTkNfSU5JVElBTElaRUQpIHsKKwkJY2xlYXJfYml0
KE5QUkVBTF9ORVRfRE9fSU5JVElBTElaRSwgJm5kLT5mbGFnKTsKKwkJc21wX21iKCk7IC8qIHVz
ZSBzbXBfbWIoKSB3aXRoIHdhaXRxdWV1ZV9hY3RpdmUoKSAqLworCQkvKiB1c2VkIHdhaXRxdWV1
ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21wX21iKCkgaXMgdXNlZCAqLworCQlpZiAod2Fp
dHF1ZXVlX2FjdGl2ZSgmbmQtPmluaXRpYWxpemVfd2FpdCkpCisJCQl3YWtlX3VwX2ludGVycnVw
dGlibGUoJm5kLT5pbml0aWFsaXplX3dhaXQpOworCisJCXJldHVybiAwOworCX0KKworCSpwYWdl
ID0gX19nZXRfZnJlZV9wYWdlKEdGUF9LRVJORUwpOworCWlmICghKCpwYWdlKSkgeworCQljbGVh
cl9iaXQoTlBSRUFMX05FVF9ET19JTklUSUFMSVpFLCAmbmQtPmZsYWcpOworCQlzbXBfbWIoKTsg
LyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICovCisJCS8qIHVzZWQgd2Fp
dHF1ZXVlX2FjdGl2ZSgpIGlzIHNhZmUgYmVjYXVzZSBzbXBfbWIoKSBpcyB1c2VkICovCisJCWlm
ICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+aW5pdGlhbGl6ZV93YWl0KSkKKwkJCXdha2VfdXBfaW50
ZXJydXB0aWJsZSgmbmQtPmluaXRpYWxpemVfd2FpdCk7CisKKwkJcmV0dXJuIC1FTk9NRU07CisJ
fQorCisJcmV0dXJuIDE7Cit9CisKK3N0YXRpYyBpbnQgbnByZWFsX3N0YXJ0dXBfdHR5X3VzYWdl
KHN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3QgbmRfc3RydWN0ICpuZCwKKwkJCQkJ
CQljaGFyICpyc3BfYnVmLCBpbnQgKnJzcF9sZW4pCit7CisJaW50IHJldDsKKworCXJldCA9IG5w
cmVhbF9zZXRfdXNlZF9jb21tYW5kX2RvbmUobmQsIHJzcF9idWYsIHJzcF9sZW4pOworCWlmIChy
ZXQgIT0gMCkgeworCQlucHJlYWxfc2V0X3VudXNlZF9jb21tYW5kX2RvbmUobmQsIHJzcF9idWYs
IHJzcF9sZW4pOworCQlyZXR1cm4gcmV0OworCX0gZWxzZSBpZiAoT0ZGTElORV9QT0xMSU5HKSB7
CisJCWlmICghcnNwX2J1ZlsyXSkgeworCQkJbnByZWFsX3NldF91bnVzZWRfY29tbWFuZF9kb25l
KG5kLCByc3BfYnVmLCByc3BfbGVuKTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwluZC0+
ZmxhZyB8PSBOUFJFQUxfTkVUX1RUWV9JTlVTRUQ7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgbnByZWFsX3N0YXJ0dXBfZGlzY29ubmVjdChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbywg
c3RydWN0IG5kX3N0cnVjdCAqbmQsCisJCQkJCQkJCWNoYXIgKnJzcF9idWYsIGludCAqcnNwX2xl
bikKK3sKKwlpbnQgcmV0OworCisJbmQtPmZsYWcgJj0gfk5QUkVBTF9ORVRfTk9ERV9ESVNDT05O
RUNURUQ7CisKKwlyZXQgPSBucHJlYWxfc2V0X3VudXNlZF9jb21tYW5kX2RvbmUobmQsIHJzcF9i
dWYsIHJzcF9sZW4pOworCWlmIChyZXQgIT0gMCkKKwkJbmQtPmZsYWcgfD0gTlBSRUFMX05FVF9O
T0RFX0RJU0NPTk5FQ1RFRDsKKwllbHNlCisJCW5kLT5mbGFnICY9IH5OUFJFQUxfTkVUX1RUWV9J
TlVTRUQ7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IG5wcmVhbF9zdGFydHVwKHN0
cnVjdCBucHJlYWxfc3RydWN0ICppbmZvLCBzdHJ1Y3QgZmlsZSAqZmlscCwKKwkJCXN0cnVjdCB0
dHlfc3RydWN0ICp0dHkpCit7CisJc3RydWN0IG5kX3N0cnVjdCAqbmQgPSBpbmZvLT5uZXRfbm9k
ZTsKKwl1bnNpZ25lZCBsb25nIHBhZ2U7CisJaW50IHJzcF9sZW5ndGggPSBSU1BfQlVGRkVSX1NJ
WkU7CisJaW50IGNudCA9IDAsIHJldDsKKwljaGFyIHJzcF9idWZmZXJbUlNQX0JVRkZFUl9TSVpF
XTsKKworCXJldCA9IG5wcmVhbF9zdGFydHVwX2luaXQoaW5mbywgbmQsIHR0eSwgJnBhZ2UpOwor
CWlmIChyZXQgPCAxKQorCQlyZXR1cm4gcmV0OworCisJaWYgKCEobmQtPmZsYWcgJiBOUFJFQUxf
TkVUX1RUWV9JTlVTRUQpKSB7CisJCXJldCA9IG5wcmVhbF9zdGFydHVwX3R0eV91c2FnZShpbmZv
LCBuZCwgcnNwX2J1ZmZlciwgJnJzcF9sZW5ndGgpOworCQlpZiAocmV0KQorCQkJZ290byBzdGFy
dHVwX2VycjsKKwl9IGVsc2UgeworCQlpZiAobmQtPmZsYWcgJiBOUFJFQUxfTkVUX05PREVfRElT
Q09OTkVDVEVEKSB7CisJCQlucHJlYWxfc3RhcnR1cF9kaXNjb25uZWN0KGluZm8sIG5kLCByc3Bf
YnVmZmVyLCAmcnNwX2xlbmd0aCk7CisJCQlnb3RvIHN0YXJ0dXBfZXJyOworCQl9CisKKwkJd2hp
bGUgKChuZC0+Y21kX3JlYWR5ID09IDEpICYmIChjbnQrKyA8IDEwKSkgeworCQkJY3VycmVudC0+
c3RhdGUgPSBUQVNLX0lOVEVSUlVQVElCTEU7CisJCQlzY2hlZHVsZV90aW1lb3V0KEhaIC8gMTAw
KTsKKwkJfQorCX0KKworCXJldCA9IG5wcmVhbF9zdGFydHVwX3NlcmlhbF9wb3J0KGluZm8sIG5k
KTsKKwlpZiAocmV0KQorCQlnb3RvIHN0YXJ0dXBfZXJyOworCisJcmV0ID0gbnByZWFsX3NldF90
eF9maWZvX2NvbW1hbmRfZG9uZShpbmZvLCBuZCwgcnNwX2J1ZmZlciwgJnJzcF9sZW5ndGgpOwor
CWlmIChyZXQpCisJCWdvdG8gc3RhcnR1cF9lcnI7CisKKwlpZiAoaW5mby0+eG1pdF9idWYpCisJ
CWZyZWVfcGFnZShwYWdlKTsKKwllbHNlCisJCWluZm8tPnhtaXRfYnVmID0gKHVuc2lnbmVkIGNo
YXIgKilwYWdlOworCisJaWYgKGluZm8tPnR0eSkKKwkJdGVzdF9hbmRfY2xlYXJfYml0KFRUWV9J
T19FUlJPUiwgJmluZm8tPnR0eS0+ZmxhZ3MpOworCisJaW5mby0+eG1pdF90YWlsID0gMDsKKwlp
bmZvLT54bWl0X2hlYWQgPSAwOworCWluZm8tPnhtaXRfY250ID0gMDsKKwlpbmZvLT5mbGFncyB8
PSBBU1lOQ19JTklUSUFMSVpFRDsKKwljbGVhcl9iaXQoTlBSRUFMX05FVF9ET19JTklUSUFMSVpF
LCAmbmQtPmZsYWcpOworCXNtcF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVf
YWN0aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ug
c21wX21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+aW5pdGlhbGl6
ZV93YWl0KSkKKwkJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZuZC0+aW5pdGlhbGl6ZV93YWl0KTsK
KworCXJldHVybiAwOworCitzdGFydHVwX2VycjoKKwlucHJlYWxfZGlzY29ubmVjdChuZCwgcnNw
X2J1ZmZlciwgJnJzcF9sZW5ndGgpOworCWZyZWVfcGFnZShwYWdlKTsKKwljbGVhcl9iaXQoTlBS
RUFMX05FVF9ET19JTklUSUFMSVpFLCAmbmQtPmZsYWcpOworCXNtcF9tYigpOyAvKiB1c2Ugc21w
X21iKCkgd2l0aCB3YWl0cXVldWVfYWN0aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3Rp
dmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21wX21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVf
YWN0aXZlKCZuZC0+aW5pdGlhbGl6ZV93YWl0KSkKKwkJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZu
ZC0+aW5pdGlhbGl6ZV93YWl0KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgbnBy
ZWFsX29wZW5fc3RhcnR1cChzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5LCBzdHJ1Y3QgbnByZWFsX3N0
cnVjdCAqaW5mbywKKwkJCQkJCQkJc3RydWN0IGZpbGUgKmZpbHApCit7CisJbG9uZyBqaWZmX3Ro
OworCWludCByZXQsIHJldHJ5OworCisJcmV0cnkgPSBOUFJFQUxfQ01EX1RSWSAtIDE7CisJd2hp
bGUgKHJldHJ5KSB7CisJCS8qIEZvciBzb21lIGNpcmN1bXN0YW5jZSwgZGV2aWNlIG1heSByZXNl
dCB0aGUgY29ubmVjdGlvbgorCQkgKiBkdXJpbmcgdGhlIHBvcnQgb3BlbmluZy4gVGhlc2UgY29k
ZSBpcyB0byByZW9wZW4gdGhlIHBvcnQKKwkJICogd2l0aG91dCB0ZWxsaW5nIGFwcGxpY2F0aW9u
LiBDb25zaWRlcmluZyBhIHJlYWwgc2l0dWF0aW9uCisJCSAqIG9mIGNvbm5lY3Rpb24gbG9zdCwg
d2UgdXNlIC1FVElNRSB0byBleGl0IHRoZSByZXRyeSBsb29wLgorCQkgKi8KKwkJcmV0ID0gbnBy
ZWFsX3N0YXJ0dXAoaW5mbywgZmlscCwgdHR5KTsKKwkJaWYgKHJldCA9PSAwKQorCQkJYnJlYWs7
CisJCWVsc2UgaWYgKHJldCA9PSAtRVRJTUUpIHsKKwkJCXByX2VycigibnByZWFsX3N0YXJ0dXAg
ZmFpbGVkKCVkKVxuIiwgcmV0KTsKKwkJCXJldHVybiAtRUlPOworCQl9CisKKwkJamlmZl90aCA9
IChOUFJFQUxfQ01EX1RSWS1yZXRyeSkqSFovMjsKKwkJc2NoZWR1bGVfdGltZW91dF91bmludGVy
cnVwdGlibGUoamlmZl90aCk7CisKKwkJcmV0cnktLTsKKwkJaWYgKHJldHJ5IDwgMCkgeworCQkJ
cHJfZXJyKCJucHJlYWxfc3RhcnR1cCBmYWlsZWRcbiIpOworCQkJcmV0dXJuIC1FSU87CisJCX0K
Kwl9CisJcmV0dXJuIDA7Cit9CisKKy8qKgorICogbnByZWFsX3Rocm90dGxlKCkgLSBOb3RpZnkg
dGhlIHR0eSBkcml2ZXIgaW5wdXQgYnVmZmVyIGlzIGZ1bGwKKyAqIEB0dHk6IHBvaW50ZXIgZm9y
IHN0cnVjdCB0dHlfc3RydWN0CisgKgorICogVGhpcyByb3V0aW5lIGlzIGNhbGxlZCBieSB0aGUg
dXBwZXItbGF5ZXIgdHR5IGxheWVyIHRvIHNpZ25hbCB0aGF0CisgKiBpbmNvbWluZyBjaGFyYWN0
ZXJzIHNob3VsZCBiZSB0aHJvdHRsZWQuICh0dHkgZHJpdmVyIGJ1ZmZlciBpcyBmdWxsKQorICoK
KyAqLworc3RhdGljIHZvaWQgbnByZWFsX3Rocm90dGxlKHN0cnVjdCB0dHlfc3RydWN0ICp0dHkp
Cit7CisJc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm8gPSAoc3RydWN0IG5wcmVhbF9zdHJ1Y3Qg
Kil0dHktPmRyaXZlcl9kYXRhOworCXN0cnVjdCBuZF9zdHJ1Y3QgKm5kOworCisJaWYgKCFpbmZv
KQorCQlyZXR1cm47CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJCXJldHVy
bjsKKworCW5kLT5yeF9yZWFkeSA9IDA7CisJc21wX21iKCk7IC8qIHVzZSBzbXBfbWIoKSB3aXRo
IHdhaXRxdWV1ZV9hY3RpdmUoKSAqLworCS8qIHVzZWQgd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIHNh
ZmUgYmVjYXVzZSBzbXBfbWIoKSBpcyB1c2VkICovCisJaWYgKHdhaXRxdWV1ZV9hY3RpdmUoJm5k
LT5zZWxlY3Rfb3V0X3dhaXQpKQorCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJm5kLT5zZWxlY3Rf
b3V0X3dhaXQpOworfQorCisvKioKKyAqIG5wcmVhbF91bnRocm90dGxlKCkgLSBjaGFyYWN0ZXJz
IGNhbiBub3cgYmUgc2VudCB0byB0aGUgdHR5CisgKiBAdHR5OiBwb2ludGVyIGZvciBzdHJ1Y3Qg
dHR5X3N0cnVjdAorICoKKyAqIE5vdGlmeSB0aGUgdHR5IGRyaXZlciB0aGF0IGNoYXJhY3RlcnMg
Y2FuIG5vdyBiZSBzZW50IHRvIHRoZSB0dHkgd2l0aG91dAorICogZmVhciBvZiBvdmVycnVubmlu
ZyB0aGUgaW5wdXQgYnVmZmVycyBvZiB0aGUgbGluZSBkaXNjaXBsaW5lcy4gdHR5CisgKiBkcml2
ZXIgYnVmZmVyIGhhdmUgc3BhY2UgdG8gcmVjZWl2ZXIgZGF0YSwgd2FrZSB1cCBuZXQKKyAqIHNl
bGVjdF9vdXRfd2FpdChuZXQpLgorICoKKyAqLworCitzdGF0aWMgdm9pZCBucHJlYWxfdW50aHJv
dHRsZShzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5KQoreworCXN0cnVjdCBucHJlYWxfc3RydWN0ICpp
bmZvID0gKHN0cnVjdCBucHJlYWxfc3RydWN0ICopdHR5LT5kcml2ZXJfZGF0YTsKKwlzdHJ1Y3Qg
bmRfc3RydWN0ICpuZDsKKworCWlmICghaW5mbykKKwkJcmV0dXJuOworCisJbmQgPSBpbmZvLT5u
ZXRfbm9kZTsKKwlpZiAoIW5kKQorCQlyZXR1cm47CisKKwluZC0+cnhfcmVhZHkgPSAxOworCXNt
cF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVfYWN0aXZlKCkgKi8KKwkvKiB1
c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21wX21iKCkgaXMgdXNlZCAq
LworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0X291dF93YWl0KSkKKwkJd2FrZV91
cF9pbnRlcnJ1cHRpYmxlKCZuZC0+c2VsZWN0X291dF93YWl0KTsKK30KKworLyoqCisgKiBucHJl
YWxfaGFuZ3VwKCkgLSBUaGlzIHJvdXRpbmUgd2lsbCBzaHV0ZG93biBhIHNlcmlhbCBwb3J0Cisg
KiBAdHR5OiBwb2ludGVyIGZvciB0dHlfc3RydWN0CisgKgorICogaW50ZXJydXB0cyBtYXliZSBk
aXNhYmxlZCwgYW5kIERUUiBpcyBkcm9wcGVkIGlmIHRoZSBoYW5ndXAgb24gY2xvc2UKKyAqIHRl
cm1pbyBmbGFnIGlzIG9uLgorICoKKyAqLworc3RhdGljIHZvaWQgbnByZWFsX3NodXRkb3duKHN0
cnVjdCBucHJlYWxfc3RydWN0ICppbmZvKQoreworCXN0cnVjdCBuZF9zdHJ1Y3QgKm5kID0gaW5m
by0+bmV0X25vZGU7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCXdoaWxlICh0ZXN0X2FuZF9z
ZXRfYml0KE5QUkVBTF9ORVRfRE9fSU5JVElBTElaRSwgJm5kLT5mbGFnKSkgeworCQlpZiAoc2ln
bmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQlicmVhazsKKwkJY3VycmVudC0+c3RhdGUgPSBUQVNL
X0lOVEVSUlVQVElCTEU7CisJCXNjaGVkdWxlX3RpbWVvdXQoSFogLyAxMDApOworCX0KKworCWlm
ICghKGluZm8tPmZsYWdzICYgQVNZTkNfSU5JVElBTElaRUQpKQorCQlnb3RvIGRvbmU7CisKKwlz
cGluX2xvY2tfaXJxc2F2ZSgmaW5mby0+dHhfbG9jaywgZmxhZ3MpOworCWlmIChpbmZvLT54bWl0
X2J1ZikgeworCQlmcmVlX3BhZ2UoKHVuc2lnbmVkIGxvbmcpaW5mby0+eG1pdF9idWYpOworCQlp
bmZvLT54bWl0X2J1ZiA9IDA7CisJfQorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmluZm8tPnR4
X2xvY2ssIGZsYWdzKTsKKworCWlmIChpbmZvLT50dHkpIHsKKwkJc2V0X2JpdChUVFlfSU9fRVJS
T1IsICZpbmZvLT50dHktPmZsYWdzKTsKKwkJbnByZWFsX3VudGhyb3R0bGUoaW5mby0+dHR5KTsK
Kwl9CisKKwlpZiAoIWluZm8tPnR0eSB8fCAoaW5mby0+dHR5LT50ZXJtaW9zLmNfY2ZsYWcgJiBI
VVBDTCkpCisJCWluZm8tPm1vZGVtX2NvbnRyb2wgJj0gfihVQVJUX01DUl9EVFIgfCBVQVJUX01D
Ul9SVFMpOworCitkb25lOgorCW5wcmVhbF9wb3J0X3NodXRkb3duKGluZm8pOworCWluZm8tPmZs
YWdzICY9IH4oQVNZTkNfTk9STUFMX0FDVElWRSB8CisJQVNZTkNfSU5JVElBTElaRUQgfCBBU1lO
Q19DTE9TSU5HKTsKKwlkb3duKCZpbmZvLT5yeF9zZW1hcGhvcmUpOworCWluZm8tPnR0eSA9IDA7
CisJdXAoJmluZm8tPnJ4X3NlbWFwaG9yZSk7CisJY2xlYXJfYml0KE5QUkVBTF9ORVRfRE9fSU5J
VElBTElaRSwgJm5kLT5mbGFnKTsKKwl3YWtlX3VwX2ludGVycnVwdGlibGUoJmluZm8tPm9wZW5f
d2FpdCk7CisJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZpbmZvLT5jbG9zZV93YWl0KTsKKwlzbXBf
bWIoKTsgLyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2ZSgpICovCisJLyogdXNl
ZCB3YWl0cXVldWVfYWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlzIHVzZWQgKi8K
KwlpZiAod2FpdHF1ZXVlX2FjdGl2ZSgmbmQtPmluaXRpYWxpemVfd2FpdCkpCisJCXdha2VfdXBf
aW50ZXJydXB0aWJsZSgmbmQtPmluaXRpYWxpemVfd2FpdCk7Cit9CisKKy8qKgorICogbnByZWFs
X29wZW4oKSAtIFRoaXMgcm91dGluZSBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBzZXJpYWwgcG9ydCBp
cyBvcGVuZWQuCisgKiBAdHR5OiBwb2ludGVyIGZvciBzdHJ1Y3QgdHR5X3N0cnVjdAorICogQGZp
bHA6IHBvaW50ZXIgZm9yIHN0cnVjdCBmaWxlCisgKgorICogTm90ZSB0aGF0IG9uIGZhaWx1cmUs
IHdlIGRvbid0IGRlY3JlbWVudCB0aGUgbW9kdWxlIHVzZSBjb3VudCAtIHRoZSB0dHkKKyAqIGRy
aXZlciBsYXRlciB3aWxsIGNhbGwgbnByZWFsX2Nsb3NlLCB3aGljaCB3aWxsIGRlY3JlbWVudCBp
dCBmb3IgdXMgYXMKKyAqIGxvbmcgYXMgdHR5LT5kcml2ZXJfZGF0YSBpcyBzZXQgbm9uLU5VTEwu
CisgKgorICogU2V0IHR0eS0+ZHJpdmVyX2RhdGEgYmVmb3JlIGVudGVyaW5nIG5wcmVhbF9zdGFy
dHVwKCksIHNvIHRoYXQgdGhlIHR0eQorICogZHJpdmVyIGNhbiBkZWNyZWFzZSByZWZjb3VudCBp
ZiBucHJlYWxfc3RhcnR1cCgpIGZhaWxlZCwgYnkgY2FsbGluZworICogbnByZWFsX2Nsb3NlKCku
CisgKgorICogRm9yIHNvbWUgY2lyY3Vtc3RhbmNlLCBkZXZpY2UgbWF5IHJlc2V0IHRoZSBjb25u
ZWN0aW9uIGR1cmluZyB0aGUKKyAqIHBvcnQgb3BlbmluZy4gVGhlc2UgY29kZSBpcyB0byByZW9w
ZW4gdGhlIHBvcnQgd2l0aG91dCB0ZWxsaW5nCisgKiBhcHBsaWNhdGlvbi4gQ29uc2lkZXJpbmcg
YSByZWFsIHNpdHVhdGlvbiBvZiBjb25uZWN0aW9uIGxvc3QsIHdlCisgKiB1c2UgLUVUSU1FIHRv
IGV4aXQgdGhlIHJldHJ5IGxvb3AuCisgKgorICogQSB6ZXJvIGlzIHJldHVybmVkIG9uIHN1Y2Nl
c3MgYW5kIGEgbmVnYXRpdmUgZXJybm8gY29kZSBmb3IgZmFpbHVyZS4KKyAqCisgKi8KK3N0YXRp
YyBpbnQgbnByZWFsX29wZW4oc3RydWN0IHR0eV9zdHJ1Y3QgKnR0eSwgc3RydWN0IGZpbGUgKmZp
bHApCit7CisJc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm87CisJc3RydWN0IG5kX3N0cnVjdCAq
bmQ7CisJaW50IHJldCwgbGluZTsKKworCXRyeV9tb2R1bGVfZ2V0KFRISVNfTU9EVUxFKTsKKwls
aW5lID0gdHR5LT5pbmRleDsKKworCWlmIChsaW5lIDwgMCB8fCBsaW5lID49IE5QUkVBTF9QT1JU
UykgeworCQltb2R1bGVfcHV0KFRISVNfTU9EVUxFKTsKKwkJcmV0dXJuICgtRU5PREVWKTsKKwl9
CisKKwlpbmZvID0gbnB2YXJfdGFibGUgKyBsaW5lOworCW5kID0gaW5mby0+bmV0X25vZGU7CisK
KwlpZiAoIW5kIHx8ICEobmQtPmZsYWcgJiBOUFJFQUxfTkVUX05PREVfT1BFTkVEKSkgeworCQlw
cl9lcnIoIm5ldCBkZXZpY2Ugbm90IHJlYWR5XG4iKTsKKwkJbW9kdWxlX3B1dChUSElTX01PRFVM
RSk7CisJCXJldHVybiAtRU5PREVWOworCX0KKworCXR0eS0+ZHJpdmVyX2RhdGEgPSBpbmZvOwor
CWluZm8tPmNvdW50Kys7CisKKwlyZXQgPSBucHJlYWxfb3Blbl9zdGFydHVwKHR0eSwgaW5mbywg
ZmlscCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IG5wcmVhbF9ibG9ja190
aWxsX3JlYWR5KHR0eSwgZmlscCwgaW5mbyk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwor
CWlmICgoaW5mby0+Y291bnQgPT0gMSkgJiYgKGluZm8tPmZsYWdzICYgQVNZTkNfU1BMSVRfVEVS
TUlPUykpIHsKKwkJaWYgKHR0eS0+ZHJpdmVyLT5zdWJ0eXBlID09IFNFUklBTF9UWVBFX05PUk1B
TCkKKwkJCXR0eS0+dGVybWlvcyA9IGluZm8tPm5vcm1hbF90ZXJtaW9zOworCisJCXJldCA9IG5w
cmVhbF9wb3J0X2luaXQoaW5mbywgMCk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0K
KworCWluZm8tPnNlc3Npb24gPSB0YXNrX3Nlc3Npb24oY3VycmVudCk7CisJaW5mby0+cGdycCA9
IHRhc2tfcGdycChjdXJyZW50KTsKKwlpbmZvLT50dHlQb3J0Lmxvd19sYXRlbmN5ID0gMTsKKwor
CXJldHVybiAwOworfQorCisvKioKKyAqIG5wcmVhbF9jbG9zZSgpIC0gVGhpcyByb3V0aW5lIGlz
IGNhbGxlZCB3aGVuIHRoZSBzZXJpYWwgcG9ydCBnZXRzIGNsb3NlZAorICogQHR0eTogcG9pbnRl
ciBmb3Igc3RydWN0IHR0eV9zdHJ1Y3QKKyAqIEBmaWxwOiBwb2ludGVyIGZvciBzdHJ1Y3QgZmls
ZQorICoKKyAqIFRoaXMgZnVuY3Rpb24gd2lsbCB3YWl0IGZvciB0aGUgbGFzdCByZW1haW5pbmcg
ZGF0YSB0byBiZSBzZW50IGFuZCBjaGVjaworICogdHR5IGNvdW50LCBhbmQgdGhlbiBzaHV0ZG93
biBOUG9ydCB0dHkgbGF0ZXIgb24uCisgKi8KK3N0YXRpYyB2b2lkIG5wcmVhbF9jbG9zZShzdHJ1
Y3QgdHR5X3N0cnVjdCAqdHR5LCBzdHJ1Y3QgZmlsZSAqZmlscCkKK3sKKwlzdHJ1Y3QgbnByZWFs
X3N0cnVjdCAqaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKXR0eS0+ZHJpdmVyX2RhdGE7
CisJbG9uZyB0aW1lb3V0LCBldCwgdmFsOworCWludCBjbnQ7CisKKwlpZiAoIWluZm8pCisJCXJl
dHVybjsKKworCWlmICh0dHlfaHVuZ191cF9wKGZpbHApKSB7CisJCWluZm8tPmNvdW50LS07CisJ
CW1vZHVsZV9wdXQoVEhJU19NT0RVTEUpOworCQlyZXR1cm47CisJfQorCisJaWYgKHR0eS0+Y291
bnQgPT0gMSAmJiAoaW5mby0+Y291bnQgIT0gMSkpIHsKKwkJcHJfd2FybigiWyVkXSBiYWQgc2Vy
aWFsIHBvcnQgY291bnQ7IHR0eS0+Y291bnQgaXMgMSwgaW5mby0+Y291bnQgaXMgJWRcbiIsCisJ
CQljdXJyZW50LT5waWQsIGluZm8tPmNvdW50KTsKKwkJaW5mby0+Y291bnQgPSAxOworCX0KKwor
CWlmICgtLWluZm8tPmNvdW50IDwgMCkgeworCQlwcl93YXJuKCIlczogYmFkIHNlcmlhbCBwb3J0
IGNvdW50IGZvciBwb3J0ICVkOiAlZFxuIiwgX19mdW5jX18sIGluZm8tPnBvcnQsCisJCQlpbmZv
LT5jb3VudCk7CisJCWluZm8tPmNvdW50ID0gMDsKKwl9CisKKwlpZiAoaW5mby0+Y291bnQpIHsK
KwkJbW9kdWxlX3B1dChUSElTX01PRFVMRSk7CisJCXJldHVybjsKKwl9CisKKwlpZiAoaW5mby0+
ZmxhZ3MgJiBBU1lOQ19DTE9TSU5HKQorCQlyZXR1cm47CisKKwlpbmZvLT5mbGFncyB8PSBBU1lO
Q19DTE9TSU5HOworCXR0eS0+Y2xvc2luZyA9IDE7CisKKwlpZiAoaW5mby0+ZmxhZ3MgJiBBU1lO
Q19OT1JNQUxfQUNUSVZFKQorCQlpbmZvLT5ub3JtYWxfdGVybWlvcyA9IHR0eS0+dGVybWlvczsK
KworCWlmICghKGZpbHAtPmZfZmxhZ3MgJiBPX05PTkJMT0NLKSAmJiBpbmZvLT5jbG9zaW5nX3dh
aXQgIT0gQVNZTkNfQ0xPU0lOR19XQUlUX05PTkUpIHsKKwkJZXQgPSBqaWZmaWVzICsgaW5mby0+
Y2xvc2luZ193YWl0OworCQl0dHlfd2FpdF91bnRpbF9zZW50KHR0eSwgaW5mby0+Y2xvc2luZ193
YWl0KTsKKwkJY250ID0gMDsKKworCQl3aGlsZSAoKHRpbWVvdXQgPSBldCAtIChsb25nKWppZmZp
ZXMpID4gMCkgeworCQkJdmFsID0gbnByZWFsX3dhaXRfb3F1ZXVlKGluZm8sIHRpbWVvdXQpOwor
CisJCQlpZiAodmFsIDwgMCB8fCAodmFsID09IDAgJiYgKCsrY250ID49IDMpKSkKKwkJCQlicmVh
azsKKwkJCWVsc2UgaWYgKHZhbCA+IDApCisJCQkJY250ID0gMDsKKworCQkJY3VycmVudC0+c3Rh
dGUgPSBUQVNLX0lOVEVSUlVQVElCTEU7CisJCQlzY2hlZHVsZV90aW1lb3V0KEhaIC8gMTAwKTsK
KwkJfQorCX0KKworCW5wcmVhbF9mbHVzaF9idWZmZXIodHR5KTsKKwlpZiAodHR5LT5sZGlzYy0+
b3BzLT5mbHVzaF9idWZmZXIpCisJCXR0eS0+bGRpc2MtPm9wcy0+Zmx1c2hfYnVmZmVyKHR0eSk7
CisKKwlucHJlYWxfc2h1dGRvd24oaW5mbyk7CisJdHR5LT5jbG9zaW5nID0gMDsKKwltb2R1bGVf
cHV0KFRISVNfTU9EVUxFKTsKK30KKworLyoqCisgKiBucHJlYWxfd3J0aWUoKSAtIENhbGxlZCB3
aGVuIHNvbWUgZGF0YSB3aWxsIGJlIHNlbnQgdG8gdHR5IGRldmljZQorICogQHR0eTogcG9pbnRl
ciBmb3Igc3RydWN0IHR0eV9zdHJ1Y3QKKyAqIEBidWY6IHBvaW50ZXIgZm9yIHN0cnVjdCBmaWxl
CisgKiBAY291bnQ6IG51bWJlciBvZiBkYXRhIHNob3VsZCBiZSBzZW50CisgKgorICogbnByZWFs
X3dyaXRlKCkgcmVwcmVzZW50cyBkYXRhIHNob3VsZCBiZSBzZW50IHRvIHR0eSBkZXZpY2UKKyAq
IChOUG9ydCBzZXJ2ZXIgZGV2aWNlKSBmcm9tIGhvc3QuIFRoaXMgZnVuY3Rpb24gd2lsbCBjb3B5
IGRhdGEgZnJvbSB1c2VyCisgKiBzcGFjZSB0byBrZXJuZWwgc3BhY2UsIGFuZCBzZXQgbmQtPnR4
X3JlYWR5ID0gMS4gV2hlbiBuZC0+dHhfcmVhZHkgPSAxLAorICogcG9sbGluZyBwYXJhbWV0ZXJz
IHdpbGwgY2hhbmdlZCBhbmQgd2FrZSB1cCBOUHJlYWwgZGFlbW9uIGluIHVzZXJzcGFjZQorICog
YnkgL3Byb2MvbnByZWFsMiwgYW5kIHRoZW4gTlByZWFsIGRhZW1vbiB3aWxsIHJlYWQgZGF0YSBs
YXRlci4KKyAqCisgKiBJZiByZXR1cm4gMCwgaXQgbWVhbnMgZmFpbDsgaWYgcmV0dXJuIHBvc2l0
aXZlIHZhbHVlLCBpdCBtZWFucyBieXRlcyBvZgorICogZGF0YSBzaG91bGQgYmUgc2VudC4KKyAq
CisgKi8KK3N0YXRpYyBpbnQgbnByZWFsX3dyaXRlKHN0cnVjdCB0dHlfc3RydWN0ICp0dHksIGNv
bnN0IHVuc2lnbmVkIGNoYXIgKmJ1ZiwgaW50IGNvdW50KQoreworCXN0cnVjdCBucHJlYWxfc3Ry
dWN0ICppbmZvID0gKHN0cnVjdCBucHJlYWxfc3RydWN0ICopdHR5LT5kcml2ZXJfZGF0YTsKKwlz
dHJ1Y3QgbmRfc3RydWN0ICpuZDsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCWludCBjLCB0b3Rh
bCA9IDA7CisKKwlpZiAoKCFpbmZvKSB8fCAhdHR5IHx8ICFpbmZvLT54bWl0X2J1ZikKKwkJcmV0
dXJuIDA7CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCisJaWYgKCFuZCkKKwkJcmV0dXJuIDA7
CisJd2hpbGUgKDEpIHsKKwkJYyA9IG1pbihjb3VudCwgbWluKChpbnQpKFNFUklBTF9YTUlUX1NJ
WkUgLSBpbmZvLT54bWl0X2NudCAtIDEpLAorCQkJCQkoaW50KShTRVJJQUxfWE1JVF9TSVpFIC0g
aW5mby0+eG1pdF9oZWFkKSkpOworCQlpZiAoYyA8PSAwKQorCQkJYnJlYWs7CisKKwkJc3Bpbl9s
b2NrX2lycXNhdmUoJmluZm8tPnR4X2xvY2ssIGZsYWdzKTsKKwkJbWVtY3B5KGluZm8tPnhtaXRf
YnVmICsgaW5mby0+eG1pdF9oZWFkLCBidWYsIGMpOworCQlpbmZvLT54bWl0X2hlYWQgPSAoaW5m
by0+eG1pdF9oZWFkICsgYykgJiAoU0VSSUFMX1hNSVRfU0laRSAtIDEpOworCQlpbmZvLT54bWl0
X2NudCArPSBjOworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpbmZvLT50eF9sb2NrLCBmbGFn
cyk7CisKKwkJYnVmICs9IGM7CisJCWNvdW50IC09IGM7CisJCXRvdGFsICs9IGM7CisJfQorCisJ
aWYgKGluZm8tPnhtaXRfY250KSB7CisJCW5kLT50eF9yZWFkeSA9IDE7CisJCXNtcF9tYigpOyAv
KiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVfYWN0aXZlKCkgKi8KKwkJLyogdXNlZCB3YWl0
cXVldWVfYWN0aXZlKCkgaXMgc2FmZSBiZWNhdXNlIHNtcF9tYigpIGlzIHVzZWQgKi8KKwkJaWYg
KHdhaXRxdWV1ZV9hY3RpdmUoJm5kLT5zZWxlY3RfaW5fd2FpdCkpCisJCQl3YWtlX3VwX2ludGVy
cnVwdGlibGUoJm5kLT5zZWxlY3RfaW5fd2FpdCk7CisJfQorCisJcmV0dXJuIHRvdGFsOworfQor
CitzdGF0aWMgaW50IG5wcmVhbF9wdXRfY2hhcihzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5LCB1bnNp
Z25lZCBjaGFyIGNoKQoreworCXN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvID0gKHN0cnVjdCBu
cHJlYWxfc3RydWN0ICopdHR5LT5kcml2ZXJfZGF0YTsKKwlzdHJ1Y3QgbmRfc3RydWN0ICpuZDsK
Kwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJaWYgKCF0dHkgfHwgIWluZm8pCisJCXJldHVybiAw
OworCisJaWYgKCFpbmZvLT54bWl0X2J1ZiB8fCAoaW5mby0+eG1pdF9jbnQgPj0gU0VSSUFMX1hN
SVRfU0laRSAtIDEpKQorCQlyZXR1cm4gMDsKKworCW5kID0gaW5mby0+bmV0X25vZGU7CisJaWYg
KCFuZCkKKwkJcmV0dXJuIDA7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaW5mby0+dHhfbG9jaywg
ZmxhZ3MpOworCWluZm8tPnhtaXRfYnVmW2luZm8tPnhtaXRfaGVhZCsrXSA9IGNoOworCWluZm8t
PnhtaXRfaGVhZCAmPSBTRVJJQUxfWE1JVF9TSVpFIC0gMTsKKwlpbmZvLT54bWl0X2NudCsrOwor
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmluZm8tPnR4X2xvY2ssIGZsYWdzKTsKKwluZC0+dHhf
cmVhZHkgPSAxOworCXNtcF9tYigpOyAvKiB1c2Ugc21wX21iKCkgd2l0aCB3YWl0cXVldWVfYWN0
aXZlKCkgKi8KKwkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZlIGJlY2F1c2Ugc21w
X21iKCkgaXMgdXNlZCAqLworCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0X2luX3dh
aXQpKQorCQl3YWtlX3VwX2ludGVycnVwdGlibGUoJm5kLT5zZWxlY3RfaW5fd2FpdCk7CisKKwly
ZXR1cm4gMTsKK30KKworc3RhdGljIGludCBucHJlYWxfd3JpdGVfcm9vbShzdHJ1Y3QgdHR5X3N0
cnVjdCAqdHR5KQoreworCXN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvID0gKHN0cnVjdCBucHJl
YWxfc3RydWN0ICopdHR5LT5kcml2ZXJfZGF0YTsKKwlpbnQgcmV0OworCisJaWYgKCFpbmZvKQor
CQlyZXR1cm4gMDsKKworCXJldCA9IFNFUklBTF9YTUlUX1NJWkUgLSBpbmZvLT54bWl0X2NudCAt
IDE7CisKKwlyZXR1cm4gcmV0IDwgMCA/IDAgOiByZXQ7Cit9CitzdGF0aWMgdm9pZCBucHJlYWxf
d2FpdF91bnRpbF9zZW50KHN0cnVjdCB0dHlfc3RydWN0ICp0dHksIGludCB0aW1lb3V0KQorewor
CXN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvOworCisJaW5mbyA9ICgoc3RydWN0IG5wcmVhbF9z
dHJ1Y3QgKil0dHktPmRyaXZlcl9kYXRhKTsKKwlpZiAoaW5mbykKKwkJbnByZWFsX3dhaXRfb3F1
ZXVlKGluZm8sIHRpbWVvdXQpOworfQorCitzdGF0aWMgaW50IG5wcmVhbF9icmVhayhzdHJ1Y3Qg
dHR5X3N0cnVjdCAqdHR5aW5mbywgaW50IGJyZWFrX3N0YXRlKQoreworCXN0cnVjdCBucHJlYWxf
c3RydWN0ICppbmZvOworCXN0cnVjdCBuZF9zdHJ1Y3QgKm5kOworCisJaW5mbyA9IChzdHJ1Y3Qg
bnByZWFsX3N0cnVjdCAqKXR0eWluZm8tPmRyaXZlcl9kYXRhOworCWlmICghaW5mbykKKwkJcmV0
dXJuIC1FRkFVTFQ7CisKKwluZCA9IGluZm8tPm5ldF9ub2RlOworCWlmICghbmQpCisJCXJldHVy
biAtRUZBVUxUOworCisJaWYgKGJyZWFrX3N0YXRlID09IC0xKQorCQlucHJlYWxfc3RhcnRfYnJl
YWsobmQpOworCWVsc2UKKwkJbnByZWFsX3N0b3BfYnJlYWsobmQpOworCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgbnByZWFsX2lvY3RsKHN0cnVjdCB0dHlfc3RydWN0ICp0dHksIHVuc2ln
bmVkIGludCBjbWQsCisJCQl1bnNpZ25lZCBsb25nIGFyZykKK3sKKwlzdHJ1Y3QgbnByZWFsX3N0
cnVjdCAqaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKXR0eS0+ZHJpdmVyX2RhdGE7CisJ
c3RydWN0IHNlcmlhbF9pY291bnRlcl9zdHJ1Y3QgKnBfY3VzZXI7IC8qIHVzZXIgc3BhY2UgKi8K
Kwl1bnNpZ25lZCBsb25nIHRlbXBsOworCWludCByZXQgPSAwOworCisJaWYgKCFpbmZvKQorCQly
ZXR1cm4gLUVOT0RFVjsKKworCWlmICgoY21kICE9IFRJT0NHU0VSSUFMKSAmJiAoY21kICE9IFRJ
T0NNSVdBSVQpICYmIChjbWQgIT0gVElPQ0dJQ09VTlQpICYmCisJCXRlc3RfYml0KFRUWV9JT19F
UlJPUiwgJnR0eS0+ZmxhZ3MpKQorCQlyZXR1cm4gLUVJTzsKKworCXN3aXRjaCAoY21kKSB7CisJ
Y2FzZSBUQ0ZMU0g6CisJCXJldCA9IHR0eV9jaGVja19jaGFuZ2UodHR5KTsKKwkJaWYgKCFyZXQp
IHsKKwkJCXN3aXRjaCAoYXJnKSB7CisJCQljYXNlIFRDSUZMVVNIOgorCQkJCWlmICh0dHktPmxk
aXNjLT5vcHMtPmZsdXNoX2J1ZmZlcikKKwkJCQkJdHR5LT5sZGlzYy0+b3BzLT5mbHVzaF9idWZm
ZXIodHR5KTsKKwkJCQlicmVhazsKKworCQkJY2FzZSBUQ0lPRkxVU0g6CisJCQkJaWYgKHR0eS0+
bGRpc2MtPm9wcy0+Zmx1c2hfYnVmZmVyKQorCQkJCQl0dHktPmxkaXNjLT5vcHMtPmZsdXNoX2J1
ZmZlcih0dHkpOworCQkJCW5wcmVhbF9mbHVzaF9idWZmZXIodHR5KTsKKwkJCQlicmVhazsKKwor
CQkJY2FzZSBUQ09GTFVTSDoKKwkJCQlucHJlYWxfZmx1c2hfYnVmZmVyKHR0eSk7CisJCQkJYnJl
YWs7CisKKwkJCWRlZmF1bHQ6CisJCQkJcmV0ID0gLUVJTlZBTDsKKwkJCX0KKwkJfQorCQlicmVh
azsKKworCWNhc2UgVENTQlJLOiAvKiBTVklEIHZlcnNpb246IG5vbi16ZXJvIGFyZyAtLT4gbm8g
YnJlYWsgKi8KKwkJcmV0ID0gdHR5X2NoZWNrX2NoYW5nZSh0dHkpOworCQlpZiAoIXJldCkgewor
CQkJdHR5X3dhaXRfdW50aWxfc2VudCh0dHksIDApOworCQkJaWYgKCFhcmcpCisJCQkJbnByZWFs
X3NlbmRfYnJlYWsoaW5mbywgSFogLyA0KTsKKwkJfQorCQlicmVhazsKKworCWNhc2UgVENTQlJL
UDogLyogc3VwcG9ydCBmb3IgUE9TSVggdGNzZW5kYnJlYWsoKSAqLworCQlyZXQgPSB0dHlfY2hl
Y2tfY2hhbmdlKHR0eSk7CisJCWlmICghcmV0KSB7CisJCQl0dHlfd2FpdF91bnRpbF9zZW50KHR0
eSwgMCk7CisJCQlucHJlYWxfc2VuZF9icmVhayhpbmZvLCBhcmcgPyBhcmcgKiAoSFogLyAxMCkg
OiBIWiAvIDQpOworCQl9CisJCWJyZWFrOworCisJY2FzZSBUSU9DR1NPRlRDQVI6CisJCXB1dF91
c2VyKENfQ0xPQ0FMKHR0eSkgPyAxIDogMCwgKHVuc2lnbmVkIGxvbmcgKilhcmcpOworCQlicmVh
azsKKworCWNhc2UgVElPQ1NTT0ZUQ0FSOgorCQlnZXRfdXNlcih0ZW1wbCwgKHVuc2lnbmVkIGxv
bmcgKilhcmcpOworCQl0dHktPnRlcm1pb3MuY19jZmxhZyA9ICgodHR5LT50ZXJtaW9zLmNfY2Zs
YWcgJiB+Q0xPQ0FMKSB8IChhcmcgPyBDTE9DQUwgOiAwKSk7CisJCWJyZWFrOworCisJY2FzZSBU
SU9DR1NFUklBTDoKKwkJcmV0ID0gKG5wcmVhbF9nZXRfc2VyaWFsX2luZm8oaW5mbywgKHN0cnVj
dCBzZXJpYWxfc3RydWN0ICopYXJnKSk7CisJCWJyZWFrOworCisJY2FzZSBUSU9DU1NFUklBTDoK
KwkJcmV0ID0gKG5wcmVhbF9zZXRfc2VyaWFsX2luZm8oaW5mbywgKHN0cnVjdCBzZXJpYWxfc3Ry
dWN0ICopYXJnKSk7CisJCWJyZWFrOworCisJY2FzZSBUSU9DU0VSR0VUTFNSOiAvKiBHZXQgbGlu
ZSBzdGF0dXMgcmVnaXN0ZXIgKi8KKwkJcmV0ID0gKG5wcmVhbF9nZXRfbHNyX2luZm8oaW5mbywg
KHVuc2lnbmVkIGludCAqKWFyZykpOworCQlicmVhazsKKworCWNhc2UgVElPQ01JV0FJVDogewor
CQlzdHJ1Y3QgYXN5bmNfaWNvdW50IGNwcmV2OworCQlERUNMQVJFX1dBSVRRVUVVRSh3YWl0LCBj
dXJyZW50KTsKKworCQljcHJldiA9IGluZm8tPmljb3VudDsKKwkJYWRkX3dhaXRfcXVldWUoJmlu
Zm8tPmRlbHRhX21zcl93YWl0LCAmd2FpdCk7CisJCXdoaWxlICgxKSB7CisJCQlzdHJ1Y3QgYXN5
bmNfaWNvdW50IGNub3c7CisKKwkJCWNub3cgPSBpbmZvLT5pY291bnQ7CisJCQlpZiAoKChhcmcg
JiBUSU9DTV9STkcpICYmIChjbm93LnJuZyAhPSBjcHJldi5ybmcpKSB8fAorCQkJCSgoYXJnICYg
VElPQ01fRFNSKSAmJiAoY25vdy5kc3IgIT0gY3ByZXYuZHNyKSkgfHwKKwkJCQkoKGFyZyAmIFRJ
T0NNX0NEKSAmJiAoY25vdy5kY2QgIT0gY3ByZXYuZGNkKSkgfHwKKwkJCQkoKGFyZyAmIFRJT0NN
X0NUUykgJiYgKGNub3cuY3RzICE9IGNwcmV2LmN0cykpKSB7CisJCQkJcmV0ID0gMDsKKwkJCQli
cmVhazsKKwkJCX0KKworCQkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKSB7CisJCQkJcmV0
ID0gLUVSRVNUQVJUU1lTOworCQkJCWJyZWFrOworCQkJfQorCisJCQljcHJldiA9IGNub3c7CisJ
CQljdXJyZW50LT5zdGF0ZSA9IFRBU0tfSU5URVJSVVBUSUJMRTsKKwkJCXNjaGVkdWxlKCk7CisJ
CX0KKworCQlyZW1vdmVfd2FpdF9xdWV1ZSgmaW5mby0+ZGVsdGFfbXNyX3dhaXQsICZ3YWl0KTsK
KwkJYnJlYWs7CisJfQorCisJY2FzZSBUSU9DR0lDT1VOVDp7CisJCXN0cnVjdCBhc3luY19pY291
bnQgY25vdzsKKworCQljbm93ID0gaW5mby0+aWNvdW50OworCQlwX2N1c2VyID0gKHN0cnVjdCBz
ZXJpYWxfaWNvdW50ZXJfc3RydWN0ICopYXJnOworCisJCWlmIChwdXRfdXNlcihjbm93LmZyYW1l
LCAmcF9jdXNlci0+ZnJhbWUpIHx8IHB1dF91c2VyKGNub3cuYnJrLCAmcF9jdXNlci0+YnJrKSB8
fAorCQkJcHV0X3VzZXIoY25vdy5vdmVycnVuLCAmcF9jdXNlci0+b3ZlcnJ1bikgfHwKKwkJCXB1
dF91c2VyKGNub3cuYnVmX292ZXJydW4sICZwX2N1c2VyLT5idWZfb3ZlcnJ1bikgfHwKKwkJCXB1
dF91c2VyKGNub3cucGFyaXR5LCAmcF9jdXNlci0+cGFyaXR5KSB8fAorCQkJcHV0X3VzZXIoY25v
dy5yeCwgJnBfY3VzZXItPnJ4KSB8fAorCQkJcHV0X3VzZXIoY25vdy50eCwgJnBfY3VzZXItPnR4
KSkgeworCQkJcmV0ID0gLUVGQVVMVDsKKwkJCWJyZWFrOworCQl9CisKKwkJcHV0X3VzZXIoY25v
dy5jdHMsICZwX2N1c2VyLT5jdHMpOworCQlwdXRfdXNlcihjbm93LmRzciwgJnBfY3VzZXItPmRz
cik7CisJCXB1dF91c2VyKGNub3cucm5nLCAmcF9jdXNlci0+cm5nKTsKKwkJcHV0X3VzZXIoY25v
dy5kY2QsICZwX2N1c2VyLT5kY2QpOworCQlicmVhazsKKwl9CisJY2FzZSBUQ1hPTkM6CisJCXJl
dCA9IHR0eV9jaGVja19jaGFuZ2UodHR5KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXN3aXRjaCAoYXJn
KSB7CisJCQljYXNlIFRDT09GRjoKKwkJCQlyZXQgPSBucHJlYWxfc2V0X2dlbmVyaWNfY29tbWFu
ZF9kb25lKGluZm8sIEFTUFBfQ01EX1NFVFhPRkYpOworCQkJCWJyZWFrOworCisJCQljYXNlIFRD
T09OOgorCQkJCXJldCA9IG5wcmVhbF9zZXRfZ2VuZXJpY19jb21tYW5kX2RvbmUoaW5mbywgQVNQ
UF9DTURfU0VUWE9OKTsKKwkJCQlicmVhazsKKworCQkJZGVmYXVsdDoKKwkJCQlyZXQgPSAtRUlO
VkFMOworCQkJfQorCQl9CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJcmV0ID0gLUVOT0lPQ1RM
Q01EOworCX0KKwlyZXR1cm4gcmV0OworfQorCisvKioKKyAqIG5wcmVhbF9zZXRfdGVybWlvcygp
IC0gQWxsb3dzIHR0eSBkcml2ZXIgbm90aWZpZWQgd2hlbiBkZXZpY2UncyB0ZXJtaW9zCisgKiBA
dHR5OiBwb2ludGVyIGZvciBzdHJ1Y3QgdHR5X3N0cnVjdAorICogQG9sZF90ZXJtaW9zOiBwb2lu
dGVyIGZvciBzdHJ1Y3Qga3Rlcm1pb3MKKyAqCisgKiBUaGlzIHJvdXRpbmUgYWxsb3dzIHRoZSB0
dHkgZHJpdmVyIHRvIGJlIG5vdGlmaWVkIHdoZW4gZGV2aWNlJ3MgdGVybWlvcworICogc2V0dGlu
Z3MgaGF2ZSBjaGFuZ2VkIGFuZCBzZXQgdHR5IHBvcnQgcGFyYW1ldGVycy4KKyAqCisgKiBBIHdl
bGwtZGVzaWduZWQgdHR5IGRyaXZlciBzaG91bGQgYmUgcHJlcGFyZWQgdG8gYWNjZXB0IHRoZSBj
YXNlCisgKiB3aGVyZSBvbGQgPT0gTlVMTCwgYW5kIHRyeSB0byBkbyBzb21ldGhpbmcgcmF0aW9u
YWwuCisgKi8KK3N0YXRpYyB2b2lkIG5wcmVhbF9zZXRfdGVybWlvcyhzdHJ1Y3QgdHR5X3N0cnVj
dCAqdHR5LAorCQkJCXN0cnVjdCBrdGVybWlvcyAqb2xkX3Rlcm1pb3MpCit7CisJc3RydWN0IG5w
cmVhbF9zdHJ1Y3QgKmluZm8gPSAoc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKil0dHktPmRyaXZlcl9k
YXRhOworCisJbnByZWFsX3BvcnRfaW5pdChpbmZvLCBvbGRfdGVybWlvcyk7Cit9CisKK3N0YXRp
YyB2b2lkIG5wcmVhbF9oYW5ndXAoc3RydWN0IHR0eV9zdHJ1Y3QgKnR0eSkKK3sKKwlzdHJ1Y3Qg
bnByZWFsX3N0cnVjdCAqaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKXR0eS0+ZHJpdmVy
X2RhdGE7CisKKwkvKiBQcmV2ZW50IHJhY2UgY29uZGl0aW9uIG9uIGNsb3NpbmcgKi8KKwlpZiAo
IWluZm8gfHwgKGluZm8tPmZsYWdzICYgQVNZTkNfQ0xPU0lORykpCisJCXJldHVybjsKKworCWlu
Zm8tPmZsYWdzIHw9IEFTWU5DX0NMT1NJTkc7CisJbnByZWFsX3NodXRkb3duKGluZm8pOworfQor
CitzdGF0aWMgaW50IG5wcmVhbF90aW9jbWdldChzdHJ1Y3QgdHR5X3N0cnVjdCAqdHR5KQorewor
CXN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvID0gKHN0cnVjdCBucHJlYWxfc3RydWN0ICopdHR5
LT5kcml2ZXJfZGF0YTsKKworCWlmICghaW5mbykKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKHR0
eS0+aW5kZXggPT0gTlBSRUFMX1BPUlRTKQorCQlyZXR1cm4gLUVOT0lPQ1RMQ01EOworCWlmICh0
dHktPmZsYWdzICYgKDEgPDwgVFRZX0lPX0VSUk9SKSkKKwkJcmV0dXJuIC1FSU87CisKKwlyZXR1
cm4gKChpbmZvLT5tb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfUlRTKSA/IFRJT0NNX1JUUyA6IDAp
IHwKKwkJKChpbmZvLT5tb2RlbV9jb250cm9sICYgVUFSVF9NQ1JfRFRSKSA/IFRJT0NNX0RUUiA6
IDApIHwKKwkJKChpbmZvLT5tb2RlbV9zdGF0dXMgJiBVQVJUX01TUl9EQ0QpID8gVElPQ01fQ0FS
IDogMCkgfAorCQkoKGluZm8tPm1vZGVtX3N0YXR1cyAmIFVBUlRfTVNSX1JJKSA/IFRJT0NNX1JO
RyA6IDApIHwKKwkJKChpbmZvLT5tb2RlbV9zdGF0dXMgJiBVQVJUX01TUl9EU1IpID8gVElPQ01f
RFNSIDogMCkgfAorCQkoKGluZm8tPm1vZGVtX3N0YXR1cyAmIFVBUlRfTVNSX0NUUykgPyBUSU9D
TV9DVFMgOiAwKTsKK30KKworc3RhdGljIGludCBucHJlYWxfdGlvY21zZXQoc3RydWN0IHR0eV9z
dHJ1Y3QgKnR0eSwgdW5zaWduZWQgaW50IHNldCwKKwkJCXVuc2lnbmVkIGludCBjbGVhcikKK3sK
KwlzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKXR0
eS0+ZHJpdmVyX2RhdGE7CisJc3RydWN0IG5kX3N0cnVjdCAqbmQ7CisKKwlpZiAoIWluZm8pCisJ
CXJldHVybiAtRUlOVkFMOworCisJbmQgPSBpbmZvLT5uZXRfbm9kZTsKKwlpZiAoIW5kKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCWlmICh0dHktPmluZGV4ID09IE5QUkVBTF9QT1JUUykKKwkJcmV0
dXJuIC1FTk9JT0NUTENNRDsKKwlpZiAodHR5LT5mbGFncyAmICgxIDw8IFRUWV9JT19FUlJPUikp
CisJCXJldHVybiAtRUlPOworCisJaWYgKHNldCAmIFRJT0NNX1JUUykKKwkJaW5mby0+bW9kZW1f
Y29udHJvbCB8PSBVQVJUX01DUl9SVFM7CisJaWYgKHNldCAmIFRJT0NNX0RUUikKKwkJaW5mby0+
bW9kZW1fY29udHJvbCB8PSBVQVJUX01DUl9EVFI7CisJaWYgKGNsZWFyICYgVElPQ01fUlRTKQor
CQlpbmZvLT5tb2RlbV9jb250cm9sICY9IH5VQVJUX01DUl9SVFM7CisJaWYgKGNsZWFyICYgVElP
Q01fRFRSKQorCQlpbmZvLT5tb2RlbV9jb250cm9sICY9IH5VQVJUX01DUl9EVFI7CisKKwlyZXR1
cm4gbnByZWFsX2xpbmVjdHJsKG5kLCBpbmZvLT5tb2RlbV9jb250cm9sKTsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCB0dHlfb3BlcmF0aW9ucyBtcHZhcl9vcHMgPSB7CisJLm9wZW4gICAgICAg
ICAgICAgICA9IG5wcmVhbF9vcGVuLAorCS5jbG9zZSAgICAgICAgICAgICAgPSBucHJlYWxfY2xv
c2UsCisJLndyaXRlICAgICAgICAgICAgICA9IG5wcmVhbF93cml0ZSwKKwkucHV0X2NoYXIgICAg
ICAgICAgID0gbnByZWFsX3B1dF9jaGFyLAorCS53cml0ZV9yb29tICAgICAgICAgPSBucHJlYWxf
d3JpdGVfcm9vbSwKKwkuY2hhcnNfaW5fYnVmZmVyICAgID0gbnByZWFsX2NoYXJzX2luX2J1ZmZl
ciwKKwkuZmx1c2hfYnVmZmVyICAgICAgID0gbnByZWFsX2ZsdXNoX2J1ZmZlciwKKwkud2FpdF91
bnRpbF9zZW50ICAgID0gbnByZWFsX3dhaXRfdW50aWxfc2VudCwKKwkuYnJlYWtfY3RsICAgICAg
ICAgID0gbnByZWFsX2JyZWFrLAorCS5pb2N0bCAgICAgICAgICAgICAgPSBucHJlYWxfaW9jdGws
CisJLnRocm90dGxlICAgICAgICAgICA9IG5wcmVhbF90aHJvdHRsZSwKKwkudW50aHJvdHRsZSAg
ICAgICAgID0gbnByZWFsX3VudGhyb3R0bGUsCisJLnNldF90ZXJtaW9zICAgICAgICA9IG5wcmVh
bF9zZXRfdGVybWlvcywKKwkuaGFuZ3VwICAgICAgICAgICAgID0gbnByZWFsX2hhbmd1cCwKKwku
dGlvY21nZXQgICAgICAgICAgID0gbnByZWFsX3Rpb2NtZ2V0LAorCS50aW9jbXNldCAgICAgICAg
ICAgPSBucHJlYWxfdGlvY21zZXQsCit9OworCitzdGF0aWMgaW50IG5wcmVhbF9uZXRfb3Blbihz
dHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlzdHJ1Y3QgbmRfc3Ry
dWN0ICpuZDsKKwlpbnQgcnRuID0gMDsKKworCXRyeV9tb2R1bGVfZ2V0KFRISVNfTU9EVUxFKTsK
KwlpZiAoIWNhcGFibGUoQ0FQX1NZU19BRE1JTikpIHsKKwkJcnRuID0gLUVQRVJNOworCQlnb3Rv
IGRvbmU7CisJfQorCisJaWYgKGZpbGUtPnByaXZhdGVfZGF0YSkgeworCQlydG4gPSAtRUlOVkFM
OworCQlnb3RvIGRvbmU7CisJfQorCisJbmQgPSAoc3RydWN0IG5kX3N0cnVjdCAqKVBERV9EQVRB
KGlub2RlKTsKKwlpZiAoIW5kKSB7CisJCXJ0biA9IC1FTlhJTzsKKwkJZ290byBkb25lOworCX0K
KworCWRvd24oJm5kLT5zZW1hcGhvcmUpOworCisJaWYgKG5kLT5mbGFnICYgTlBSRUFMX05FVF9O
T0RFX09QRU5FRCkgeworCQlydG4gPSAtRUJVU1k7CisJCWdvdG8gdW5sb2NrOworCX0KKworCW5k
LT5mbGFnIHw9IE5QUkVBTF9ORVRfTk9ERV9PUEVORUQ7CisJbmQtPnR4X3JlYWR5ID0gMDsKKwlu
ZC0+cnhfcmVhZHkgPSAxOworCW5kLT5jbWRfcmVhZHkgPSAwOworCXR0eV9yZWdpc3Rlcl9kZXZp
Y2UobnB2YXJfc2RyaXZlciwgbmQtPnR0eV9ub2RlLT5wb3J0LCBOVUxMKTsKKwordW5sb2NrOgor
CXVwKCZuZC0+c2VtYXBob3JlKTsKKwlmaWxlLT5wcml2YXRlX2RhdGEgPSAodm9pZCAqKW5kOwor
ZG9uZToKKwlpZiAocnRuKQorCQltb2R1bGVfcHV0KFRISVNfTU9EVUxFKTsKKworCXJldHVybiBy
dG47Cit9CisKK3N0YXRpYyBpbnQgbnByZWFsX25ldF9jbG9zZShzdHJ1Y3QgaW5vZGUgKmlub2Rl
LCBzdHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlzdHJ1Y3QgbmRfc3RydWN0ICpuZDsKKworCW5kID0g
KHN0cnVjdCBuZF9zdHJ1Y3QgKikoZmlsZS0+cHJpdmF0ZV9kYXRhKTsKKwlpZiAoIW5kKQorCQln
b3RvIGRvbmU7CisKKwkvKiBUaGlzIGZsYWcgd2lsbCBiZSBjaGVja2VkIHdoZW4gbnByZWFsX25l
dF9vcGVuKCkgaXMgY2FsbGVkIGFnYWluLiAqLworCW5kLT5mbGFnICY9IH5OUFJFQUxfTkVUX05P
REVfT1BFTkVEOworCXR0eV91bnJlZ2lzdGVyX2RldmljZShucHZhcl9zZHJpdmVyLCBuZC0+dHR5
X25vZGUtPnBvcnQpOworCitkb25lOgorCWZpbGUtPnByaXZhdGVfZGF0YSA9IE5VTEw7CisJbW9k
dWxlX3B1dChUSElTX01PRFVMRSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBp
bnQgbnByZWFsX25ldF9zZWxlY3Qoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCBwb2xsX3RhYmxl
X3N0cnVjdCAqdGFibGUpCit7CisJc3RydWN0IG5kX3N0cnVjdCAqbmQgPSBmaWxlLT5wcml2YXRl
X2RhdGE7CisJdW5zaWduZWQgaW50IHJldHZhbCA9IDA7CisKKwlpZiAoIW5kKQorCQlyZXR1cm4g
cmV0dmFsOworCisJcG9sbF93YWl0KGZpbGUsICZuZC0+c2VsZWN0X2luX3dhaXQsIHRhYmxlKTsK
Kwlwb2xsX3dhaXQoZmlsZSwgJm5kLT5zZWxlY3Rfb3V0X3dhaXQsIHRhYmxlKTsKKwlwb2xsX3dh
aXQoZmlsZSwgJm5kLT5zZWxlY3RfZXhfd2FpdCwgdGFibGUpOworCisJaWYgKG5kLT50eF9yZWFk
eSkKKwkJcmV0dmFsIHw9IFBPTExJTiB8IFBPTExSRE5PUk07CisJaWYgKG5kLT5yeF9yZWFkeSkK
KwkJcmV0dmFsIHw9IFBPTExPVVQgfCBQT0xMV1JOT1JNOworCWlmIChuZC0+Y21kX3JlYWR5KQor
CQlyZXR2YWwgfD0gUE9MTFBSSTsKKworCXJldHVybiByZXR2YWw7Cit9CisKK3N0YXRpYyBsb25n
IG5wcmVhbF9uZXRfaW9jdGwoc3RydWN0IGZpbGUgKmZpbGUsIHVuc2lnbmVkIGludCBjbWQsIHVu
c2lnbmVkIGxvbmcgYXJnKQoreworCXN0cnVjdCBuZF9zdHJ1Y3QgKm5kID0gZmlsZS0+cHJpdmF0
ZV9kYXRhOworCWludCByZXQgPSAwOworCWludCBzaXplLCBsZW47CisKKwlpZiAoIW5kKSB7CisJ
CXJldCA9IC1FTlhJTzsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlzaXplID0gX0lPQ19TSVpFKGNt
ZCk7CisKKwlzd2l0Y2ggKF9JT0NfTlIoY21kKSkgeworCWNhc2UgTlBSRUFMX05FVF9DTURfUkVU
UklFVkU6CisJCWlmICghbmQtPmNtZF9yZWFkeSkgeworCQkJcHJfZXJyKCIoUCUwMmQpIE5FVF9D
TURfUkVUUklFVkUgRXJyb3IgQCAlZFxuIiwgbmQtPnR0eV9ub2RlLT5wb3J0LAorCQkJCV9fTElO
RV9fKTsKKwkJCXJldCA9IC1FTlhJTzsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYgKG5kLT5mbGFn
ICYgTlBSRUFMX05FVF9ET19TRVNTSU9OX1JFQ09WRVJZKQorCQkJbGVuID0gbmQtPmRvX3Nlc3Np
b25fcmVjb3ZlcnlfbGVuOworCQllbHNlCisJCQlsZW4gPSAoaW50KW5kLT5jbWRfYnVmZmVyWzJd
ICsgMzsKKworCQlpZiAoY29weV90b191c2VyKCh2b2lkICopYXJnLCAodm9pZCAqKW5kLT5jbWRf
YnVmZmVyLCBsZW4pKSB7CisJCQlwcl9lcnIoIihQJTAyZCkgTkVUX0NNRF9SRVRSSUVWRSBFcnJv
ciBAICVkXG4iLCBuZC0+dHR5X25vZGUtPnBvcnQsCisJCQkJX19MSU5FX18pOworCQkJcmV0ID0g
LUVGQVVMVDsKKwkJCWJyZWFrOworCQl9CisKKwkJbmQtPmNtZF9idWZmZXJbMF0gPSAwOworCQly
ZXQgPSBsZW47CisJCW5kLT5jbWRfcmVhZHkgPSAwOworCQlicmVhazsKKworCWNhc2UgTlBSRUFM
X05FVF9DTURfUkVTUE9OU0U6IHsKKwkJdW5zaWduZWQgY2hhciByc3BfYnVmZmVyWzg0XTsKKwor
CQlpZiAoc2l6ZSA8IDIpCisJCQlicmVhazsKKworCQlpZiAoc2l6ZSA+IDg0KQorCQkJc2l6ZSA9
IDg0OworCisJCWlmIChjb3B5X2Zyb21fdXNlcigodm9pZCAqKXJzcF9idWZmZXIsICh2b2lkICop
YXJnLCBzaXplKSkgeworCQkJcmV0ID0gLUVGQVVMVDsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYg
KHJzcF9idWZmZXJbMF0gPT0gTlBSRUFMX0xPQ0FMX0NPTU1BTkRfU0VUKSB7CisJCQlkb3duKCZu
ZC0+Y21kX3NlbWFwaG9yZSk7CisJCQltZW1jcHkobmQtPnJzcF9idWZmZXIsIHJzcF9idWZmZXIs
IHNpemUpOworCQkJbmQtPnJzcF9sZW5ndGggPSBzaXplOworCQkJbmQtPmNtZF9yc3BfZmxhZyA9
IDE7CisJCQl1cCgmbmQtPmNtZF9zZW1hcGhvcmUpOworCQkJLyogdXNlZCB3YWl0cXVldWVfYWN0
aXZlKCkgaXMgc2FmZSBiZWNhdXNlCisJCQkgKiB3YWl0cXVldWVfYWN0aXZlKCkgaXMgZXhlY3V0
ZWQgYmVmb3JlCisJCQkgKiBzZXR0aW5nIG5kLT5jbWRfcnNwX2ZsYWcKKwkJCSAqLworCQkJaWYg
KHdhaXRxdWV1ZV9hY3RpdmUoJm5kLT5jbWRfcnNwX3dhaXQpKQorCQkJCXdha2VfdXBfaW50ZXJy
dXB0aWJsZSgmbmQtPmNtZF9yc3Bfd2FpdCk7CisKKwkJCWJyZWFrOworCQl9CisKKwkJZG93bigm
bmQtPmNtZF9zZW1hcGhvcmUpOworCQlpZiAobmQtPmZsYWcgJiBOUFJFQUxfTkVUX0RPX1NFU1NJ
T05fUkVDT1ZFUlkpIHsKKwkJCWlmIChyc3BfYnVmZmVyWzFdID09IEFTUFBfQ01EX0xJTkVDVFJM
KSB7CisJCQkJbmQtPmZsYWcgJj0gfk5QUkVBTF9ORVRfRE9fU0VTU0lPTl9SRUNPVkVSWTsKKwkJ
CQl1cCgmbmQtPmNtZF9zZW1hcGhvcmUpOworCQkJCWJyZWFrOworCisJCQl9IGVsc2UgaWYgKHJz
cF9idWZmZXJbMV0gPT0gQVNQUF9DTURfUE9SVF9JTklUKSB7CisJCQkJaW50IHN0YXRlID0gMDsK
KwkJCQlzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5mbzsKKworCQkJCXVwKCZuZC0+Y21kX3NlbWFw
aG9yZSk7CisJCQkJaW5mbyA9IG5kLT50dHlfbm9kZTsKKwkJCQlpZiAoIWluZm8gfHwgc2l6ZSAh
PSA2IHx8IHJzcF9idWZmZXJbMl0gIT0gMykKKwkJCQkJYnJlYWs7CisKKwkJCQlpZiAocnNwX2J1
ZmZlclszXSkKKwkJCQkJc3RhdGUgfD0gVUFSVF9NU1JfRFNSOworCQkJCWlmIChyc3BfYnVmZmVy
WzRdKQorCQkJCQlzdGF0ZSB8PSBVQVJUX01TUl9DVFM7CisJCQkJaWYgKHJzcF9idWZmZXJbNV0p
CisJCQkJCXN0YXRlIHw9IFVBUlRfTVNSX0RDRDsKKwkJCQlucHJlYWxfY2hlY2tfbW9kZW1fc3Rh
dHVzKGluZm8sIHN0YXRlKTsKKwkJCX0gZWxzZSB7CisJCQkJdXAoJm5kLT5jbWRfc2VtYXBob3Jl
KTsKKwkJCQlicmVhazsKKwkJCX0KKworCQl9IGVsc2UgeworCQkJdXAoJm5kLT5jbWRfc2VtYXBo
b3JlKTsKKwkJfQorCisJCWlmIChyc3BfYnVmZmVyWzFdID09IEFTUFBfTk9USUZZKSB7CisJCQlu
cHJlYWxfcHJvY2Vzc19ub3RpZnkobmQsIHJzcF9idWZmZXIsIHNpemUpOworCQl9IGVsc2UgaWYg
KHJzcF9idWZmZXJbMV0gPT0gQVNQUF9DTURfV0FJVF9PUVVFVUUpIHsKKwkJCWlmIChzaXplID09
IDUpIHsKKwkJCQltZW1jcHkobmQtPnJzcF9idWZmZXIsIHJzcF9idWZmZXIsIHNpemUpOworCQkJ
CW5kLT5vcXVldWUgPSByc3BfYnVmZmVyWzRdICogMTYgKyByc3BfYnVmZmVyWzNdOworCQkJCW5k
LT5yc3BfbGVuZ3RoID0gc2l6ZTsKKwkJCQluZC0+d2FpdF9vcXVldWVfcmVzcG9uc2VkID0gMTsK
KwkJCQlkb3duKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJCQkJbmQtPmNtZF9yc3BfZmxhZyA9IDE7
CisJCQkJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJCQkvKiB1c2VkIHdhaXRxdWV1ZV9hY3Rp
dmUoKSBpcyBzYWZlIGJlY2F1c2UKKwkJCQkgKiB3YWl0cXVldWVfYWN0aXZlKCkgaXMgZXhlY3V0
ZWQgYmVmb3JlCisJCQkJICogc2V0dGluZyBuZC0+Y21kX3JzcF9mbGFnCisJCQkJICovCisJCQkJ
aWYgKHdhaXRxdWV1ZV9hY3RpdmUoJm5kLT5jbWRfcnNwX3dhaXQpKQorCQkJCQl3YWtlX3VwX2lu
dGVycnVwdGlibGUoJm5kLT5jbWRfcnNwX3dhaXQpOworCQkJfQorCQl9IGVsc2UgeworCQkJZG93
bigmbmQtPmNtZF9zZW1hcGhvcmUpOworCQkJbWVtY3B5KG5kLT5yc3BfYnVmZmVyLCByc3BfYnVm
ZmVyLCBzaXplKTsKKwkJCW5kLT5yc3BfbGVuZ3RoID0gc2l6ZTsKKwkJCW5kLT5jbWRfcnNwX2Zs
YWcgPSAxOworCQkJdXAoJm5kLT5jbWRfc2VtYXBob3JlKTsKKwkJCS8qIHVzZWQgd2FpdHF1ZXVl
X2FjdGl2ZSgpIGlzIHNhZmUgYmVjYXVzZQorCQkJICogd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIGV4
ZWN1dGVkIGJlZm9yZQorCQkJICogc2V0dGluZyBuZC0+Y21kX3JzcF9mbGFnCisJCQkgKi8KKwkJ
CWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+Y21kX3JzcF93YWl0KSkKKwkJCQl3YWtlX3VwX2lu
dGVycnVwdGlibGUoJm5kLT5jbWRfcnNwX3dhaXQpOworCQl9CisKKwkJYnJlYWs7CisJfQorCisJ
Y2FzZSBOUFJFQUxfTkVUX0NPTk5FQ1RFRDogeworCQlzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqaW5m
bzsKKworCQlpbmZvID0gbmQtPnR0eV9ub2RlOworCQlpZiAoIWluZm8pCisJCQlicmVhazsKKwor
CQlpZiAobmQtPmZsYWcgJiBOUFJFQUxfTkVUX05PREVfRElTQ09OTkVDVEVEKSB7CisJCQluZC0+
ZmxhZyAmPSB+TlBSRUFMX05FVF9OT0RFX0RJU0NPTk5FQ1RFRDsKKwkJCW5kLT5mbGFnIHw9IE5Q
UkVBTF9ORVRfTk9ERV9DT05ORUNURUQ7CisJCQlucHJlYWxfZG9fc2Vzc2lvbl9yZWNvdmVyeShp
bmZvKTsKKwkJfQorCisJCWJyZWFrOworCX0KKworCWNhc2UgTlBSRUFMX05FVF9ESVNDT05ORUNU
RUQ6IHsKKwkJbmQtPmZsYWcgJj0gfk5QUkVBTF9ORVRfTk9ERV9DT05ORUNURUQ7CisJCW5kLT5m
bGFnIHw9IE5QUkVBTF9ORVRfTk9ERV9ESVNDT05ORUNURUQ7CisJCW5kLT5mbGFnICY9IH5OUFJF
QUxfTkVUX1RUWV9JTlVTRUQ7CisJCW5kLT53YWl0X29xdWV1ZV9yZXNwb25zZWQgPSAxOworCQlk
b3duKCZuZC0+Y21kX3NlbWFwaG9yZSk7CisJCW5kLT5jbWRfcnNwX2ZsYWcgPSAxOworCQl1cCgm
bmQtPmNtZF9zZW1hcGhvcmUpOworCQkvKiB1c2VkIHdhaXRxdWV1ZV9hY3RpdmUoKSBpcyBzYWZl
IGJlY2F1c2UKKwkJICogd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIGV4ZWN1dGVkIGJlZm9yZQorCQkg
KiBzZXR0aW5nIG5kLT5jbWRfcnNwX2ZsYWcKKwkJICovCisJCWlmICh3YWl0cXVldWVfYWN0aXZl
KCZuZC0+Y21kX3JzcF93YWl0KSkKKwkJCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmbmQtPmNtZF9y
c3Bfd2FpdCk7CisJCWJyZWFrOworCisJfQorCisJY2FzZSBOUFJFQUxfTkVUX0dFVF9UVFlfU1RB
VFVTOiB7CisJCWludCBzdGF0dXM7CisKKwkJaWYgKHNpemUgIT0gc2l6ZW9mKHN0YXR1cykpCisJ
CQlicmVhazsKKworCQlzdGF0dXMgPSAobmQtPmZsYWcgJiBOUFJFQUxfTkVUX1RUWV9JTlVTRUQp
ID8gMSA6IDA7CisJCWlmIChjb3B5X3RvX3VzZXIoKHZvaWQgKilhcmcsICh2b2lkICopJnN0YXR1
cywgc2l6ZSkpCisJCQlyZXQgPSAtRUZBVUxUOworCisJCWJyZWFrOworCX0KKworCWNhc2UgTlBS
RUFMX05FVF9TRVRUSU5HOiB7CisJCXN0cnVjdCBzZXJ2ZXJfc2V0dGluZ19zdHJ1Y3Qgc2V0dGlu
Z3M7CisJCXN0cnVjdCBucHJlYWxfc3RydWN0ICppbmZvOworCisJCWluZm8gPSBuZC0+dHR5X25v
ZGU7CisJCWlmICghaW5mbyB8fCBzaXplICE9IHNpemVvZihzdHJ1Y3Qgc2VydmVyX3NldHRpbmdf
c3RydWN0KSkKKwkJCWJyZWFrOworCisJCWlmIChjb3B5X2Zyb21fdXNlcigodm9pZCAqKSZzZXR0
aW5ncywgKHZvaWQgKilhcmcsIHNpemUpKSB7CisJCQlyZXQgPSAtRUZBVUxUOworCQkJYnJlYWs7
CisKKwkJfQorCisJCWlmICgoc2V0dGluZ3Muc2VydmVyX3R5cGUgPT0gREUzMTEpIHx8IChzZXR0
aW5ncy5zZXJ2ZXJfdHlwZSA9PSBERTMwMSkgfHwKKwkJKHNldHRpbmdzLnNlcnZlcl90eXBlID09
IERFMzAyKSB8fCAoc2V0dGluZ3Muc2VydmVyX3R5cGUgPT0gREUzMDQpIHx8CisJCShzZXR0aW5n
cy5zZXJ2ZXJfdHlwZSA9PSBERTMzMSkgfHwgKHNldHRpbmdzLnNlcnZlcl90eXBlID09IERFMzMy
KSB8fAorCQkoc2V0dGluZ3Muc2VydmVyX3R5cGUgPT0gREUzMzQpIHx8IChzZXR0aW5ncy5zZXJ2
ZXJfdHlwZSA9PSBERTMwMykgfHwKKwkJKHNldHRpbmdzLnNlcnZlcl90eXBlID09IERFMzA4KSB8
fCAoc2V0dGluZ3Muc2VydmVyX3R5cGUgPT0gREUzMDkpIHx8CisJCShzZXR0aW5ncy5zZXJ2ZXJf
dHlwZSA9PSBDTjIxMDApIHx8IChzZXR0aW5ncy5zZXJ2ZXJfdHlwZSA9PSBDTjI1MDApKQorCQkJ
bmQtPnNlcnZlcl90eXBlID0gc2V0dGluZ3Muc2VydmVyX3R5cGU7CisKKwkJaWYgKHNldHRpbmdz
LmRpc2FibGVfZmlmbykKKwkJCWluZm8tPnR5cGUgPSBQT1JUXzE2NDUwOworCQllbHNlCisJCQlp
bmZvLT50eXBlID0gUE9SVF8xNjU1MEE7CisKKwkJc2V0X2NvbW1vbl94bWl0X2ZpZm9fc2l6ZShp
bmZvLCBuZCk7CisKKwkJYnJlYWs7CisJfQorCisJZGVmYXVsdDoKKwkJYnJlYWs7CisJfQorCisJ
cmV0dXJuIHJldDsKK30KKworLyoqCisgKiBucHJlYWxfbmV0X3JlYWQoKSAtIFRoaXMgcm91dGlu
ZSBpcyBjYWxsZWQgd2hlbiBOUHJlYWwgZGFlbW9uIGNhbGxzIHJlYWQKKyAqIEBmaWxlOiBwb2lu
dGVyIGZvciBzdHJ1Y3QgZmlsZQorICogQGJ1ZjogYnVmZmVyIG9mIHVzZXIgc3BhY2UKKyAqIEBj
b3VudDogbnVtYmVyIG9mIGRhdGEgaW4gYnVmCisgKiBAcHBvczogbG9uZyBvZmZzZXQgZm9yIHN0
YXJ0IHBvc2l0aW9uIHRoZSBmaWxlCisgKgorICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hl
biBob3N0IHdhbnRzIHRvIHdyaXRlIGRhdGEgdG8gdHR5IGRldmljZQorICogKE5QcmVhbCBzZXJ2
ZXIgZGV2aWNlKSBieSAvcHJvYy9ucHJlYWwyLCBhbmQgcHV0IGRhdGEgdG8gdXNlcnBhY2UgZnJv
bQorICoga2VybmVsIHNwYWNlLgorICoKKyAqICh0dHktPmxkaXNjLT5vcHMtPndyaXRlX3dha2V1
cCkodHR5KSBzaG91bGQgYmUgZXhlY3V0ZWQgd2l0aG91dCBzb2Z0CisgKiBpcnEuCisgKgorICog
cG9zaXRpdmUgdmFsIGlzIHJldHVybiBpZiBob3N0IHdyaXRlIG51bWJlciBvZiBkYXRhIHN1Y2Nl
c3NmdWxseS4KKyAqIE90aGVyaXdzZSwgaXQncyBmYWlsZWQuCisgKgorICovCitzdGF0aWMgc3Np
emVfdCBucHJlYWxfbmV0X3JlYWQoc3RydWN0IGZpbGUgKmZpbGUsIGNoYXIgKmJ1Ziwgc2l6ZV90
IGNvdW50LCBsb2ZmX3QgKnBwb3MpCit7CisJc3RydWN0IG5kX3N0cnVjdCAqbmQgPSBmaWxlLT5w
cml2YXRlX2RhdGE7CisJc3RydWN0IG5wcmVhbF9zdHJ1Y3QgKmluZm87CisJc3RydWN0IHR0eV9z
dHJ1Y3QgKnR0eTsKKwlzc2l6ZV90IHJ0biA9IDA7CisJaW50IG1pbl92YWw7CisJdW5zaWduZWQg
bG9uZyBmbGFnczsKKworCisJaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKW5kLT50dHlf
bm9kZTsKKwl0dHkgPSBpbmZvLT50dHk7CisKKwlpZiAoIW5kIHx8ICFpbmZvIHx8ICF0dHkpIHsK
KwkJcnRuID0gLUVOWElPOworCQlyZXR1cm4gcnRuOworCX0KKworCWlmIChpbmZvLT54X2NoYXIp
IHsKKwkJcnRuID0gMTsKKwkJaWYgKGNvcHlfdG9fdXNlcihidWYsICZpbmZvLT54X2NoYXIsIHJ0
bikpIHsKKwkJCXJ0biA9IC1FRkFVTFQ7CisJCQlyZXR1cm4gcnRuOworCQl9CisKKwkJaW5mby0+
eF9jaGFyID0gMDsKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmluZm8tPnR4X2xvY2ssIGZsYWdzKTsK
KwkJaW5mby0+aWNvdW50LnR4Kys7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmluZm8tPnR4
X2xvY2ssIGZsYWdzKTsKKwkJcmV0dXJuIHJ0bjsKKwl9CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgm
aW5mby0+dHhfbG9jaywgZmxhZ3MpOworCWlmICghaW5mby0+eG1pdF9idWYgfHwgaW5mby0+eG1p
dF9jbnQgPD0gMCkgeworCQlydG4gPSAwOworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpbmZv
LT50eF9sb2NrLCBmbGFncyk7CisJCXJldHVybiBydG47CisJfQorCisJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmaW5mby0+dHhfbG9jaywgZmxhZ3MpOworCisJd2hpbGUgKGNvdW50KSB7CisJCW1p
bl92YWwgPSBtaW5fdChpbnQsIChpbnQpY291bnQsIG1pbihpbmZvLT54bWl0X2NudCwKKwkJCShp
bnQpKFNFUklBTF9YTUlUX1NJWkUgLSBpbmZvLT54bWl0X3RhaWwpKSk7CisKKwkJaWYgKG1pbl92
YWwgPD0gMCkKKwkJCWJyZWFrOworCisJCWlmIChjb3B5X3RvX3VzZXIoYnVmICsgcnRuLCBpbmZv
LT54bWl0X2J1ZiArIGluZm8tPnhtaXRfdGFpbCwgbWluX3ZhbCkpIHsKKwkJCXJ0biA9IC1FRkFV
TFQ7CisJCQlyZXR1cm4gcnRuOworCQl9CisKKwkJcnRuICs9IG1pbl92YWw7CisJCWNvdW50IC09
IG1pbl92YWw7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmluZm8tPnR4X2xvY2ssIGZsYWdzKTsK
KwkJaW5mby0+eG1pdF9jbnQgLT0gbWluX3ZhbDsKKwkJaW5mby0+eG1pdF90YWlsICs9IG1pbl92
YWw7CisJCWluZm8tPnhtaXRfdGFpbCA9IGluZm8tPnhtaXRfdGFpbCAmIChTRVJJQUxfWE1JVF9T
SVpFIC0gMSk7CisJCWluZm8tPmljb3VudC50eCArPSBtaW5fdmFsOworCQlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZpbmZvLT50eF9sb2NrLCBmbGFncyk7CisJfQorCisJaWYgKGluZm8tPnhtaXRf
Y250IDw9IDApIHsKKwkJbmQtPnR4X3JlYWR5ID0gMDsKKwl9IGVsc2UgeworCQluZC0+dHhfcmVh
ZHkgPSAxOworCQlzbXBfbWIoKTsgLyogdXNlIHNtcF9tYigpIHdpdGggd2FpdHF1ZXVlX2FjdGl2
ZSgpICovCisJCS8qIHVzZWQgd2FpdHF1ZXVlX2FjdGl2ZSgpIGlzIHNhZmUgYmVjYXVzZSBzbXBf
bWIoKSBpcyB1c2VkICovCisJCWlmICh3YWl0cXVldWVfYWN0aXZlKCZuZC0+c2VsZWN0X2luX3dh
aXQpKQorCQkJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZuZC0+c2VsZWN0X2luX3dhaXQpOworCX0K
KworCWlmICgodHR5LT5mbGFncyAmICgxIDw8IFRUWV9ET19XUklURV9XQUtFVVApKSAmJiB0dHkt
PmxkaXNjLT5vcHMtPndyaXRlX3dha2V1cCkKKwkJKHR0eS0+bGRpc2MtPm9wcy0+d3JpdGVfd2Fr
ZXVwKSh0dHkpOworCisJd2FrZV91cF9pbnRlcnJ1cHRpYmxlKCZ0dHktPndyaXRlX3dhaXQpOwor
CisJcmV0dXJuIHJ0bjsKK30KKworLyoqCisgKiBucHJlYWxfbmV0X3dyaXRlKCkgLSBDYWxsZWQg
d2hlbiBOUHJlYWwgZGFlbW9uIGNhbGxzIHdyaXRlCisgKiBAZmlsZTogcG9pbnRlciBmb3Igc3Ry
dWN0IGZpbGUKKyAqIEBidWY6IGJ1ZmZlciBvZiB1c2VyIHNwYWNlCisgKiBAY291bnQ6IG51bWJl
ciBvZiBkYXRhIGluIGJ1ZgorICogQHBwb3M6IGxvbmcgb2Zmc2V0IGZvciBzdGFydCBwb3NpdGlv
biB0aGUgZmlsZQorICoKKyAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gaG9zdCByZWFk
cyBkYXRhIGZyb20gdHR5IGRldmljZQorICogKE5QcmVhbCBzZXJ2ZXIgZGV2aWNlKSBieSAvcHJv
Yy9ucHJlYWwyLCBhbmQgcHV0IGRhdGEgcHV0IGludG8ga2VybmVsCisgKiBzcGFjZS4gVGhlIHJl
Y2VpdmUgYnVmZmVyIHdpbGwgb3ZlcnJ1bixhcyB0aGUgVFRZX1RIUkVTSE9MRF9USFJPVFRMRSBp
cworICogMTI4LgorICoKKyAqIEEgemVybyBpcyByZXR1cm5lZCBpZiBmYWlsdXJlOyBwb3NpdGl2
ZSB2YWwgaXMgcmV0dXJuIGlmIGhvc3QgcmVhZHMgZGF0YQorICogZnJvbSB0dHkgZGV2aWNlLgor
ICoKKyAqLworCitzdGF0aWMgc3NpemVfdCBucHJlYWxfbmV0X3dyaXRlKHN0cnVjdCBmaWxlICpm
aWxlLCBjb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCwgbG9mZl90ICpwcG9zKQoreworCXN0
cnVjdCBuZF9zdHJ1Y3QgKm5kID0gZmlsZS0+cHJpdmF0ZV9kYXRhOworCXN0cnVjdCBucHJlYWxf
c3RydWN0ICppbmZvOworCXN0cnVjdCB0dHlfc3RydWN0ICp0dHk7CisJdW5zaWduZWQgY2hhciAq
a19idWYgPSBOVUxMOworCXNzaXplX3QgcnRuID0gMDsKKwlpbnQgY250OworCXVuc2lnbmVkIGxv
bmcgdG1wOworCisJaWYgKCFidWYpIHsKKwkJcnRuID0gY291bnQ7CisJCWdvdG8gZG9uZTsKKwl9
CisKKwlrX2J1ZiA9IGttYWxsb2NfYXJyYXkoY291bnQsIHNpemVvZih1bnNpZ25lZCBjaGFyKSwg
R0ZQX0tFUk5FTCk7CisJaW5mbyA9IChzdHJ1Y3QgbnByZWFsX3N0cnVjdCAqKW5kLT50dHlfbm9k
ZTsKKwl0bXAgPSAgY29weV9mcm9tX3VzZXIoa19idWYsIGJ1ZiwgY291bnQpOworCWlmICgoa19i
dWYgPT0gTlVMTCB8fCB0bXApIHx8ICghbmQgfHwgIWluZm8pIHx8IChpbmZvLT5mbGFncyAmIEFT
WU5DX0NMT1NJTkcpKSB7CisJCXJ0biA9IGNvdW50OworCQlnb3RvIGRvbmU7CisJfQorCisKKwlk
b3duKCZpbmZvLT5yeF9zZW1hcGhvcmUpOworCXR0eSA9IGluZm8tPnR0eTsKKwlpZiAoIXR0eSB8
fCAhaW5mby0+dHR5UG9ydC5sb3dfbGF0ZW5jeSB8fCB0ZXN0X2JpdChUVFlfSU9fRVJST1IsICZ0
dHktPmZsYWdzKSkgeworCQlydG4gPSBjb3VudDsKKwkJdXAoJmluZm8tPnJ4X3NlbWFwaG9yZSk7
CisJCWdvdG8gZG9uZTsKKwl9CisKKwlpZiAoIW5kLT5yeF9yZWFkeSkgeworCQl1cCgmaW5mby0+
cnhfc2VtYXBob3JlKTsKKwkJZ290byBkb25lOworCX0KKworCWNudCA9IHR0eV9idWZmZXJfcmVx
dWVzdF9yb29tKCZpbmZvLT50dHlQb3J0LCBjb3VudCk7CisJaWYgKGNudCA8PSAwKSB7CisJLyog
RG9pbmcgdGhyb3R0bGUgaGVyZSxiZWNhdXNlIHRoYXQgaXQgd2lsbCBzcGVudCB0aW1lcworCSAq
IGZvciB1cHBlciBsYXllciBkcml2ZXIgdG8gdGhyb3R0bGUgYW5kIHRoZSBhcHBsaWNhdGlvbgor
CSAqIG1heSBjYWxsIHdyaXRlIHNvIG1hbnkgdGltZXMgYnV0IGp1c3QgY2FuIG5vdCB3cml0ZS4K
KwkgKiBJZiB3ZSBhcmUgZG9pbmcgaW5wdXQgY2Fub25pY2FsaXphdGlvbiwgYW5kIHRoZXJlIGFy
ZSBubworCSAqIHBlbmRpbmcgbmV3bGluZXMsIGxldCBjaGFyYWN0ZXJzIHRocm91Z2ggd2l0aG91
dCBsaW1pdCwgc28KKwkgKiB0aGF0IGVyYXNlIGNoYXJhY3RlcnMgd2lsbCBiZSBoYW5kbGVkLiAg
T3RoZXIgZXhjZXNzCisJICogY2hhcmFjdGVycyB3aWxsIGJlIGJlZXBlZC4KKwkgKi8KKwkJdXAo
JmluZm8tPnJ4X3NlbWFwaG9yZSk7CisJCWdvdG8gZG9uZTsKKwl9CisKKwljb3VudCA9IHR0eV9p
bnNlcnRfZmxpcF9zdHJpbmcoJmluZm8tPnR0eVBvcnQsICh1bnNpZ25lZCBjaGFyICopa19idWYs
IGNudCk7CisJaWYgKGNvdW50KSB7CisJCXR0eV9mbGlwX2J1ZmZlcl9wdXNoKCZpbmZvLT50dHlQ
b3J0KTsKKwkJcnRuID0gY291bnQ7CisJCXVwKCZpbmZvLT5yeF9zZW1hcGhvcmUpOworCQlnb3Rv
IGRvbmU7CisJfQorCisJdXAoJmluZm8tPnJ4X3NlbWFwaG9yZSk7CisJc2NoZWR1bGVfd29yaygm
aW5mby0+cHJvY2Vzc19mbGlwX3RxdWV1ZSk7Citkb25lOgorCWtmcmVlKGtfYnVmKTsKKwlyZXR1
cm4gcnRuOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IHByb2Nfb3BzIG5wcmVhbF9uZXRfZm9w
cyA9IHsKKwkucHJvY19vcGVuID0gbnByZWFsX25ldF9vcGVuLAorCS5wcm9jX3JlYWQgPSBucHJl
YWxfbmV0X3JlYWQsCisJLnByb2Nfd3JpdGUgPSBucHJlYWxfbmV0X3dyaXRlLAorCS5wcm9jX2lv
Y3RsID0gbnByZWFsX25ldF9pb2N0bCwKKwkucHJvY19yZWxlYXNlID0gbnByZWFsX25ldF9jbG9z
ZSwKKwkucHJvY19wb2xsID0gbnByZWFsX25ldF9zZWxlY3QsCit9OworCitzdGF0aWMgaW50IF9f
aW5pdCBucHJlYWwyX21vZHVsZV9pbml0KHZvaWQpCit7CisJaW50IGksIHJldHZhbDsKKworCW5w
dmFyX3Nkcml2ZXIgPSBhbGxvY190dHlfZHJpdmVyKE5QUkVBTF9QT1JUUyk7CisJaWYgKCFucHZh
cl9zZHJpdmVyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCW5wdmFyX3Nkcml2ZXItPm5hbWUgPSAi
dHR5ciI7CisJbnB2YXJfc2RyaXZlci0+bWFqb3IgPSB0dHltYWpvcjsKKwlucHZhcl9zZHJpdmVy
LT5taW5vcl9zdGFydCA9IDA7CisJbnB2YXJfc2RyaXZlci0+dHlwZSA9IFRUWV9EUklWRVJfVFlQ
RV9TRVJJQUw7CisJbnB2YXJfc2RyaXZlci0+c3VidHlwZSA9IFNFUklBTF9UWVBFX05PUk1BTDsK
KwlucHZhcl9zZHJpdmVyLT5pbml0X3Rlcm1pb3MgPSB0dHlfc3RkX3Rlcm1pb3M7CisJbnB2YXJf
c2RyaXZlci0+aW5pdF90ZXJtaW9zLmNfY2ZsYWcgPSBCOTYwMCB8IENTOCB8IENSRUFEIHwgSFVQ
Q0wgfCBDTE9DQUw7CisJbnB2YXJfc2RyaXZlci0+ZmxhZ3MgPSBUVFlfRFJJVkVSX1JFQUxfUkFX
IHwgVFRZX0RSSVZFUl9EWU5BTUlDX0RFVjsKKworCW5wdmFyX3RhYmxlID0ga21hbGxvY19hcnJh
eShOUFJFQUxfUE9SVFMsIHNpemVvZihzdHJ1Y3QgbnByZWFsX3N0cnVjdCksIEdGUF9LRVJORUwp
OworCWlmIChucHZhcl90YWJsZSA9PSBOVUxMKQorCQlyZXR1cm4gLTE7CisKKwlucHZhcl9uZXRf
bm9kZXMgPSBrbWFsbG9jX2FycmF5KE5QUkVBTF9QT1JUUywgc2l6ZW9mKHN0cnVjdCBuZF9zdHJ1
Y3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAobnB2YXJfbmV0X25vZGVzID09IE5VTEwpIHsKKwkJa2Zy
ZWUobnB2YXJfdGFibGUpOworCQlyZXR1cm4gLTE7CisJfQorCisJdHR5X3NldF9vcGVyYXRpb25z
KG5wdmFyX3Nkcml2ZXIsICZtcHZhcl9vcHMpOworCW1lbXNldChucHZhcl90YWJsZSwgMCwgTlBS
RUFMX1BPUlRTICogc2l6ZW9mKHN0cnVjdCBucHJlYWxfc3RydWN0KSk7CisKKwlmb3IgKGkgPSAw
OyBpIDwgTlBSRUFMX1BPUlRTOyBpKyspIHsKKwkJdHR5X3BvcnRfaW5pdCgmbnB2YXJfdGFibGVb
aV0udHR5UG9ydCk7CisJCXR0eV9wb3J0X2xpbmtfZGV2aWNlKCZucHZhcl90YWJsZVtpXS50dHlQ
b3J0LCBucHZhcl9zZHJpdmVyLCBpKTsKKwl9CisKKwlyZXR2YWwgPSB0dHlfcmVnaXN0ZXJfZHJp
dmVyKG5wdmFyX3Nkcml2ZXIpOworCWlmIChyZXR2YWwpIHsKKwkJcHJfZXJyKCJDb3VsZG4ndCBp
bnN0YWxsIE1PWEEgQXN5bmMvTlBvcnQgc2VydmVyIGZhbWlseSBkcml2ZXIgIVxuIik7CisJCXB1
dF90dHlfZHJpdmVyKG5wdmFyX3Nkcml2ZXIpOworCQlyZXR1cm4gLTE7CisJfQorCisJcmV0dmFs
ID0gbnByZWFsX2luaXQobnB2YXJfdGFibGUsIG5wdmFyX25ldF9ub2Rlcyk7CisJaWYgKHJldHZh
bCkgeworCQl0dHlfdW5yZWdpc3Rlcl9kcml2ZXIobnB2YXJfc2RyaXZlcik7CisJCXByX2Vycigi
Q291bGRuJ3QgaW5zdGFsbCBNT1hBIEFzeW5jL05Qb3J0IHNlcnZlciBmYW1pbHkgUmVhbCBUVFkg
ZHJpdmVyICFcbiIpOworCQlyZXR1cm4gLTE7CisJfQorCisJcHJfaW5mbygiTU9YQSBOcG9ydCBk
cml2ZXIgdmVyc2lvbiAlc1xuIiwgTlBSRUFMX1ZFUlNJT04pOworCXJldHVybiAwOworfQorCitz
dGF0aWMgdm9pZCBfX2V4aXQgbnByZWFsMl9tb2R1bGVfZXhpdCh2b2lkKQoreworCXN0cnVjdCBu
cHJlYWxfc3RydWN0ICppbmZvOworCXN0cnVjdCBwcm9jX2Rpcl9lbnRyeSAqZGU7CisJaW50IGk7
CisKKwlpbmZvID0gJm5wdmFyX3RhYmxlWzBdOworCWZvciAoaSA9IDA7IGkgPCBOUFJFQUxfUE9S
VFMgJiYgKGluZm8tPm5ldF9ub2RlICE9IE5VTEwpOyBpKyssIGluZm8rKykgeworCQlpZiAoaW5m
by0+bmV0X25vZGUtPmZsYWcgJiBOUFJFQUxfTkVUX05PREVfT1BFTkVEKQorCQkJdHR5X3VucmVn
aXN0ZXJfZGV2aWNlKG5wdmFyX3Nkcml2ZXIsIGkpOworCisJCWRlID0gaW5mby0+bmV0X25vZGUt
Pm5vZGVfZW50cnk7CisJCWlmIChkZSkKKwkJCW5wcmVhbF9yZW1vdmVfcHJvY19lbnRyeShkZSwg
aSk7CisKKwkJaW5mby0+bmV0X25vZGUtPm5vZGVfZW50cnkgPSBOVUxMOworCX0KKworCWlmIChu
cHZhcl9wcm9jX3Jvb3QpIHsKKwkJbnByZWFsX3JlbW92ZV9wcm9jX2VudHJ5KG5wdmFyX3Byb2Nf
cm9vdCwgNDA0KTsKKwkJbnB2YXJfcHJvY19yb290ID0gTlVMTDsKKwl9CisKKwlpZiAodHR5X3Vu
cmVnaXN0ZXJfZHJpdmVyKG5wdmFyX3Nkcml2ZXIpKQorCQlwcl9lcnIoIkNvdWxkbid0IHVucmVn
aXN0ZXIgTU9YQSBBc3luYy9OUG9ydCBzZXJ2ZXIgZmFtaWx5IFJlYWwgVFRZIGRyaXZlclxuIik7
CisKKwlwdXRfdHR5X2RyaXZlcihucHZhcl9zZHJpdmVyKTsKKwlrZnJlZShucHZhcl90YWJsZSk7
CisJa2ZyZWUobnB2YXJfbmV0X25vZGVzKTsKK30KKworbW9kdWxlX2luaXQobnByZWFsMl9tb2R1
bGVfaW5pdCk7Cittb2R1bGVfZXhpdChucHJlYWwyX21vZHVsZV9leGl0KTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvdHR5L25wcmVhbDIuaCBiL2RyaXZlcnMvdHR5L25wcmVhbDIuaApuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjUyM2JjZDUzNDFmZgotLS0gL2Rldi9udWxs
CisrKyBiL2RyaXZlcnMvdHR5L25wcmVhbDIuaApAQCAtMCwwICsxLDE0MCBAQAorLyogU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjArICovCisjaWZuZGVmIF9OUFJFQUwyX0gKKyNkZWZp
bmUgX05QUkVBTDJfSAorCisjZGVmaW5lIE5QUkVBTF9WRVJTSU9OCQkJInY1LjAiCisjZGVmaW5l
IFZFUlNJT05fQ09ERSh2ZXIsIHJlbCwgc2VxKQkoKHZlciA8PCAxNikgfCAocmVsIDw8IDgpIHwg
c2VxKQorCisjZGVmaW5lIFNFUklBTF9ET19SRVNUQVJUCQkxCisjZGVmaW5lIE9GRkxJTkVfUE9M
TElORwkJCTAKKyNkZWZpbmUgTlBSRUFMX0VWRU5UX1RYTE9XCQkxCisjZGVmaW5lIE5QUkVBTF9F
VkVOVF9IQU5HVVAJCTIKKyNkZWZpbmUgU0VSSUFMX1RZUEVfTk9STUFMCQkxCisjZGVmaW5lIFNF
UklBTF9UWVBFX0NBTExPVVQJCTIKKyNkZWZpbmUgV0FLRVVQX0NIQVJTCQkJMjU2CisjaWZuZGVm
IE1BWF9TQ0hFRFVMRV9USU1FT1VUCisjZGVmaW5lCU1BWF9TQ0hFRFVMRV9USU1FT1VUCSAgICAg
ICAgKChsb25nKSh+MFVMPj4xKSkKKyNlbmRpZgorLyogZHluYW1pYyBhbGxvY2F0aW9uIG9mIHRo
ZSBtYWpvciBkZXZpY2UgbnVtYmVyICovCisjZGVmaW5lIE5QUkVBTE1BSk9SCQkJMAorI2RlZmlu
ZSBOUFJFQUxfUE9SVFMJCQkyNTYKKworI2RlZmluZSBERTIxMQkJCQkyMTEKKyNkZWZpbmUgREUz
MDEJCQkJMzAxCisjZGVmaW5lIERFMzAyCQkJCTMwMgorI2RlZmluZSBERTMwMwkJCQkzMDMKKyNk
ZWZpbmUgREUzMDQJCQkJMzA0CisjZGVmaW5lIERFMzA4CQkJCTMwOAorI2RlZmluZSBERTMwOQkJ
CQkzMDkKKyNkZWZpbmUgREUzMTEJCQkJMzExCisjZGVmaW5lIERFMzMxCQkJCTMzMQorI2RlZmlu
ZSBERTMzMgkJCQkzMzIKKyNkZWZpbmUgREUzMzQJCQkJMzM0CisjZGVmaW5lIENOMjEwMAkJCQky
MTAwCisjZGVmaW5lIENOMjUwMAkJCQkyNTAwCisKKyNpZm5kZWYgQjkyMTYwMAorI2RlZmluZSBC
OTIxNjAwCQkJCShCNDYwODAwICsgMSkKKyNlbmRpZgorCisjZGVmaW5lIE5QUkVBTF9BU1BQX0NP
TU1BTkRfU0VUCQkxCisjZGVmaW5lIE5QUkVBTF9MT0NBTF9DT01NQU5EX1NFVAkyCisKKy8qIGxv
Y2FsIGNvbW1hbmQgc2V0ICovCisjZGVmaW5lIExPQ0FMX0NNRF9UVFlfVVNFRAkJMQorI2RlZmlu
ZSBMT0NBTF9DTURfVFRZX1VOVVNFRAkJMgorI2RlZmluZSBOUFJFQUxfTkVUX0NPTk5FQ1RFRAkJ
MworI2RlZmluZSBOUFJFQUxfTkVUX0RJU0NPTk5FQ1RFRAkJNAorI2RlZmluZSBOUFJFQUxfTkVU
X1NFVFRJTkcJCTUKKyNkZWZpbmUgTlBSRUFMX05FVF9HRVRfVFRZX1NUQVRVUwk2CisKKyNkZWZp
bmUgTlBSRUFMX0NNRF9USU1FT1VUCQkoMTAqSFopCisjZGVmaW5lIE5QUkVBTF9DTURfVFJZCQkJ
MTAKKworI2RlZmluZSBOUFJFQUxfTkVUX0NNRF9SRVRSSUVWRQkJMQorI2RlZmluZSBOUFJFQUxf
TkVUX0NNRF9SRVNQT05TRQkJMgorCisvKiBwcm9jIG5vZGUgaXMgb3BlbmVkICovCisjZGVmaW5l
IE5QUkVBTF9ORVRfTk9ERV9PUEVORUQJCTB4MDEKKyNkZWZpbmUgTlBSRUFMX05FVF9OT0RFX0NP
Tk5FQ1RFRAkweDAyCisjZGVmaW5lIE5QUkVBTF9ORVRfTk9ERV9ESVNDT05ORUNURUQJMHgwNAor
I2RlZmluZSBOUFJFQUxfTkVUX0RPX1NFU1NJT05fUkVDT1ZFUlkJMHgwOAorI2RlZmluZSBOUFJF
QUxfTkVUX0RPX0lOSVRJQUxJWkUJMHgxMAorLyogdHR5IHBvcnQgaXMgb3BlbmVkICovCisjZGVm
aW5lIE5QUkVBTF9ORVRfVFRZX0lOVVNFRAkJMHgyMAorCisvKiBBU1BQIGNvbW1hbmQgc2V0ICov
CisjZGVmaW5lIEFTUFBfTk9USUZZCQkJMHgyNgorI2RlZmluZSBBU1BQX05PVElGWV9QQVJJVFkJ
CTB4MDEKKyNkZWZpbmUgQVNQUF9OT1RJRllfRlJBTUlORwkJMHgwMgorI2RlZmluZSBBU1BQX05P
VElGWV9IV19PVkVSUlVOCQkweDA0CisjZGVmaW5lIEFTUFBfTk9USUZZX1NXX09WRVJSVU4JCTB4
MDgKKyNkZWZpbmUgQVNQUF9OT1RJRllfQlJFQUsJCTB4MTAKKyNkZWZpbmUgQVNQUF9OT1RJRllf
TVNSX0NIRwkJMHgyMAorCisjZGVmaW5lIEFTUFBfQ01EX0lPQ1RMCQkJMTYKKyNkZWZpbmUgQVNQ
UF9DTURfRkxPV0NUUkwJCTE3CisjZGVmaW5lIEFTUFBfQ01EX0xJTkVDVFJMCQkxOAorI2RlZmlu
ZSBBU1BQX0NNRF9MU1RBVFVTCQkxOQorI2RlZmluZSBBU1BQX0NNRF9GTFVTSAkJCTIwCisjZGVm
aW5lIEFTUFBfQ01EX0lRVUVVRQkJCTIxCisjZGVmaW5lIEFTUFBfQ01EX09RVUVVRQkJCTIyCisj
ZGVmaW5lIEFTUFBfQ01EX1NFVEJBVUQJCTIzCisjZGVmaW5lIEFTUFBfQ01EX1hPTlhPRkYJCTI0
CisjZGVmaW5lIEFTUFBfQ01EX1BPUlRfUkVTRVQJCTMyCisjZGVmaW5lIEFTUFBfQ01EX1NUQVJU
X0JSRUFLCQkzMworI2RlZmluZSBBU1BQX0NNRF9TVE9QX0JSRUFLCQkzNAorI2RlZmluZSBBU1BQ
X0NNRF9TVEFSVF9OT1RJRlkJCTM2CisjZGVmaW5lIEFTUFBfQ01EX1NUT1BfTk9USUZZCQkzNwor
I2RlZmluZSBBU1BQX0NNRF9IT1NUCQkJNDMKKyNkZWZpbmUgQVNQUF9DTURfUE9SVF9JTklUCQk0
NAorI2RlZmluZSBBU1BQX0NNRF9SRVNFTlRfVElNRQkJNDYKKyNkZWZpbmUgQVNQUF9DTURfV0FJ
VF9PUVVFVUUJCTQ3CisjZGVmaW5lIEFTUFBfQ01EX1RYX0ZJRk8JCTQ4CisjZGVmaW5lIEFTUFBf
Q01EX1NFVFhPTgkJCTUxCisjZGVmaW5lIEFTUFBfQ01EX1NFVFhPRkYJCTUyCisKKyNkZWZpbmUg
QVNQUF9GTFVTSF9SWF9CVUZGRVIJCTAKKyNkZWZpbmUgQVNQUF9GTFVTSF9UWF9CVUZGRVIJCTEK
KyNkZWZpbmUgQVNQUF9GTFVTSF9BTExfQlVGRkVSCQkyCisKKyNkZWZpbmUgQVNQUF9JT0NUTF9C
MzAwCQkJMAorI2RlZmluZSBBU1BQX0lPQ1RMX0I2MDAJCQkxCisjZGVmaW5lIEFTUFBfSU9DVExf
QjEyMDAJCTIKKyNkZWZpbmUgQVNQUF9JT0NUTF9CMjQwMAkJMworI2RlZmluZSBBU1BQX0lPQ1RM
X0I0ODAwCQk0CisjZGVmaW5lIEFTUFBfSU9DVExfQjcyMDAJCTUKKyNkZWZpbmUgQVNQUF9JT0NU
TF9COTYwMAkJNgorI2RlZmluZSBBU1BQX0lPQ1RMX0IxOTIwMAkJNworI2RlZmluZSBBU1BQX0lP
Q1RMX0IzODQwMAkJOAorI2RlZmluZSBBU1BQX0lPQ1RMX0I1NzYwMAkJOQorI2RlZmluZSBBU1BQ
X0lPQ1RMX0IxMTUyMDAJCTEwCisjZGVmaW5lIEFTUFBfSU9DVExfQjIzMDQwMAkJMTEKKyNkZWZp
bmUgQVNQUF9JT0NUTF9CNDYwODAwCQkxMgorI2RlZmluZSBBU1BQX0lPQ1RMX0I5MjE2MDAJCTEz
CisjZGVmaW5lIEFTUFBfSU9DVExfQjE1MAkJCTE0CisjZGVmaW5lIEFTUFBfSU9DVExfQjEzNAkJ
CTE1CisjZGVmaW5lIEFTUFBfSU9DVExfQjExMAkJCTE2CisjZGVmaW5lIEFTUFBfSU9DVExfQjc1
CQkJMTcKKyNkZWZpbmUgQVNQUF9JT0NUTF9CNTAJCQkxOAorCisjZGVmaW5lIEFTUFBfSU9DVExf
QklUUzUJCTAKKyNkZWZpbmUgQVNQUF9JT0NUTF9CSVRTNgkJMQorI2RlZmluZSBBU1BQX0lPQ1RM
X0JJVFM3CQkyCisjZGVmaW5lIEFTUFBfSU9DVExfQklUUzgJCTMKKworI2RlZmluZSBBU1BQX0lP
Q1RMX1NUT1AxCQkwCisjZGVmaW5lIEFTUFBfSU9DVExfU1RPUDIJCTQKKworI2RlZmluZSBBU1BQ
X0lPQ1RMX05PTkUJCQkwCisjZGVmaW5lIEFTUFBfSU9DVExfRVZFTgkJCTgKKyNkZWZpbmUgQVNQ
UF9JT0NUTF9PREQJCQkxNgorI2RlZmluZSBBU1BQX0lPQ1RMX01BUksJCQkyNAorI2RlZmluZSBB
U1BQX0lPQ1RMX1NQQUNFCQkzMgorCisjZGVmaW5lIFJTUF9CVUZGRVJfU0laRQkJCTgKKyNpZm5k
ZWYgQVNZTkNfQ0FMTE9VVF9BQ1RJVkUKKyNkZWZpbmUgQVNZTkNfQ0FMTE9VVF9BQ1RJVkUJCTAK
KyNlbmRpZgorCisjZW5kaWYKLS0gCjIuMjAuMQo=
