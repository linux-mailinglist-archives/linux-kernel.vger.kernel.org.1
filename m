Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 1DCAE1F883D
	for <lists+linux-kernel@lfdr.de>; Sun, 14 Jun 2020 11:54:25 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726982AbgFNJyU (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 14 Jun 2020 05:54:20 -0400
Received: from mx2.suse.de ([195.135.220.15]:52152 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725265AbgFNJyU (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 14 Jun 2020 05:54:20 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx2.suse.de (Postfix) with ESMTP id C8C2EAB8F;
        Sun, 14 Jun 2020 09:54:22 +0000 (UTC)
Date:   Sun, 14 Jun 2020 11:54:18 +0200
Message-ID: <s5hv9ju9dmd.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     "Alex Xu (Hello71)" <alex_y_xu@yahoo.ca>
Cc:     alsa-devel@alsa-project.org, bp@alien8.de, hch@infradead.org,
        Christoph Hellwig <hch@lst.de>, hpa@zytor.com,
        linux-kernel@vger.kernel.org, mingo@redhat.com,
        Pavel Machek <pavel@ucw.cz>, perex@perex.cz,
        rientjes@google.com, tglx@linutronix.de, tiwai@suse.com,
        x86@kernel.org
Subject: Re: next-0519 on thinkpad x60: sound related? window manager crash
In-Reply-To: <1592065395.r5zwoblr15.none@localhost>
References: <20200520111136.GA3802@amd>
        <1591545088.74ii116nf2.none@localhost>
        <20200608061950.GA17476@lst.de>
        <1591624340.z01ejtod28.none@localhost>
        <20200609114733.GA1621@lst.de>
        <s5hr1uogtna.wl-tiwai@suse.de>
        <s5h8sgtede5.wl-tiwai@suse.de>
        <1592065395.r5zwoblr15.none@localhost>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Sat, 13 Jun 2020 18:25:22 +0200,
Alex Xu (Hello71) wrote:
> 
> Excerpts from Takashi Iwai's message of June 11, 2020 1:11 pm:
> > Thanks, so something still missing in the mmap handling, I guess.
> > 
> > I've worked on two different branches for potential fixes of your
> > problems.  Could you test topic/dma-fix and topic/dma-fix2 branches?
> >   git://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound.git
> > Just pull one of them onto Linus' git HEAD.
> > 
> > I guess we'll go with David's new patch, but still it's interesting
> > whether my changes do anything good actually.
> > 
> > 
> > Takashi
> > 
> 
> On torvalds 623f6dc593, topic/dma-fix causes sound to be output as 
> alternating half-second bursts of noise and a few seconds of silence. 
> topic/dma-fix2 appears to work properly.

OK, thanks for the feedback!  Just to make sure, you're using
PulseAudio, right?
If so, it was still something wrong about mmap, and the secondary
method (the fallback to the continuous page) looks like a safer
approach in the end.

I suppose that David's fix will be merged sooner or later.  Meanwhile
I'll work on the change in the sound driver side to make things a bit
more robust.  They don't conflict and both good applicable.


thanks,

Takashi
