Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 674C821330A
	for <lists+linux-kernel@lfdr.de>; Fri,  3 Jul 2020 06:43:43 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726361AbgGCEnF (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 3 Jul 2020 00:43:05 -0400
Received: from mailgw02.mediatek.com ([210.61.82.184]:2203 "EHLO
        mailgw02.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1726311AbgGCEnB (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 3 Jul 2020 00:43:01 -0400
X-UUID: bc2912a0b14840208848f6751fa86ad0-20200703
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=7xgdrx+JEJiGeWM1hd4ETDEgkB7FURHYAoYOjyNzefc=;
        b=kBssw0oHqyX1b9dws084/KkfY5Z3S/rcHMqlNFr20FHzrC5e+1MK41Yv1GolVNBMDxr9Aje9rRXyAR/GttKRO3ZkU0b3rpGvZIkm6wAW73SGVpMHQJTQS131AXal1xznJ1hmH6v5kSy1Mz/6hCfUuJDJD5w1HkbCvnKE+DRR9zk=;
X-UUID: bc2912a0b14840208848f6751fa86ad0-20200703
Received: from mtkcas10.mediatek.inc [(172.21.101.39)] by mailgw02.mediatek.com
        (envelope-from <chao.hao@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
        with ESMTP id 351006648; Fri, 03 Jul 2020 12:42:56 +0800
Received: from mtkcas07.mediatek.inc (172.21.101.84) by
 mtkmbs01n2.mediatek.inc (172.21.101.79) with Microsoft SMTP Server (TLS) id
 15.0.1497.2; Fri, 3 Jul 2020 12:42:48 +0800
Received: from localhost.localdomain (10.15.20.246) by mtkcas07.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1497.2 via Frontend
 Transport; Fri, 3 Jul 2020 12:42:43 +0800
From:   Chao Hao <chao.hao@mediatek.com>
To:     Joerg Roedel <joro@8bytes.org>, Rob Herring <robh+dt@kernel.org>,
        "Matthias Brugger" <matthias.bgg@gmail.com>
CC:     <iommu@lists.linux-foundation.org>, <devicetree@vger.kernel.org>,
        <linux-kernel@vger.kernel.org>,
        <linux-arm-kernel@lists.infradead.org>,
        <linux-mediatek@lists.infradead.org>, <wsd_upstream@mediatek.com>,
        Chao Hao <chao.hao@mediatek.com>,
        FY Yang <fy.yang@mediatek.com>, Yong Wu <yong.wu@mediatek.com>,
        TH Yang <th.yang@mediatek.com>
Subject: [PATCH v6 06/10] iommu/mediatek: Add sub_comm id in translation fault
Date:   Fri, 3 Jul 2020 12:41:23 +0800
Message-ID: <20200703044127.27438-7-chao.hao@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20200703044127.27438-1-chao.hao@mediatek.com>
References: <20200703044127.27438-1-chao.hao@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-TM-SNTS-SMTP: 666672718C089DB23071EA990091CB312E71F1BE98E3763CACF562D9D970DCB42000:8
X-MTK:  N
Content-Transfer-Encoding: base64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

VGhlIG1heCBsYXJiIG51bWJlciB0aGF0IGEgaW9tbXUgSFcgc3VwcG9ydCBpcyA4KGxhcmIwfmxh
cmI3IGluIHRoZSBiZWxvdw0KZGlhZ3JhbSkuDQpJZiB0aGUgbGFyYidzIG51bWJlciBpcyBvdmVy
IDgsIHdlIHVzZSBhIHN1Yl9jb21tb24gZm9yIG1lcmdpbmcNCnNldmVyYWwgbGFyYnMgaW50byBv
bmUgbGFyYi4gQXQgdGhpcyBjYXNlLCB3ZSB3aWxsIGV4dGVuZCBsYXJiX2lkOg0KYml0WzExOjld
IG1lYW5zIGNvbW1vbi1pZDsNCmJpdFs4OjddIG1lYW5zIHN1YmNvbW1vbi1pZDsNCkZyb20gdGhl
c2UgdHdvIHZhcmlhYmxlcywgd2UgY291bGQgZ2V0IHRoZSByZWFsIGxhcmIgbnVtYmVyIHdoZW4N
CnRyYW5zbGF0aW9uIGZhdWx0IGhhcHBlbi4NClRoZSBkaWFncmFtIGlzIGFzIGJlbG93Og0KCQkg
RU1JDQoJCSAgfA0KCQlJT01NVQ0KCQkgIHwNCiAgICAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0N
CgkgICB8ICAgICAgICAgICAgICAgfA0KCWNvbW1vbjEgICAJY29tbW9uMA0KCSAgIHwJCSAgIHwN
CgkgICAtLS0tLS0tLS0tLS0tLS0tLQ0KCQkgIHwNCiAgICAgICAgICAgICBzbWkgY29tbW9uDQoJ
CSAgfA0KICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgfCAgICAgICB8
ICAgICAgIHwgICAgICAgfCAgICAgfCAgICB8DQogMydkMCAgICAzJ2QxICAgIDMnZDIgICAgMydk
MyAgLi4uICAzJ2Q3ICAgPC1jb21tb25faWQobWF4IGlzIDgpDQogIHwgICAgICAgfCAgICAgICB8
ICAgICAgIHwgICAgIHwgICAgfA0KTGFyYjAgICBMYXJiMSAgICAgfCAgICAgTGFyYjMgIC4uLiBM
YXJiNw0KCQkgIHwNCgkgICAgc21pIHN1YiBjb21tb24NCgkJICB8DQogICAgIC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tDQogICAgIHwgICAgICAgIHwgICAgICAgfCAgICAgICB8DQogICAgMidk
MCAgICAgMidkMSAgICAyJ2QyICAgIDInZDMgICA8LXN1Yl9jb21tb25faWQobWF4IGlzIDQpDQog
ICAgIHwgICAgICAgIHwgICAgICAgfCAgICAgICB8DQogICBMYXJiOCAgICBMYXJiOSAgIExhcmIx
MCAgTGFyYjExDQoNCkluIHRoaXMgcGF0Y2ggd2UgZXh0ZW5kIGxhcmJfcmVtYXBbXSB0byBsYXJi
X3JlbWFwWzhdWzRdIGZvciB0aGlzLg0KbGFyYl9yZW1hcFt4XVt5XTogeCBtZWFucyBjb21tb24t
aWQgYWJvdmUsIHkgbWVhbnMgc3ViY29tbW9uX2lkIGFib3ZlLg0KDQpXZSBjYW4gYWxzbyBkaXN0
aW5ndWlzaCBpZiB0aGUgTTRVIEhXIGhhcyBzdWJfY29tbW9uIGJ5IEhBU19TVUJfQ09NTQ0KbWFj
cm8uDQoNCkNjOiBNYXR0aGlhcyBCcnVnZ2VyIDxtYXR0aGlhcy5iZ2dAZ21haWwuY29tPg0KU2ln
bmVkLW9mZi1ieTogQ2hhbyBIYW8gPGNoYW8uaGFvQG1lZGlhdGVrLmNvbT4NClJldmlld2VkLWJ5
OiBZb25nIFd1IDx5b25nLnd1QG1lZGlhdGVrLmNvbT4NCi0tLQ0KIGRyaXZlcnMvaW9tbXUvbXRr
X2lvbW11LmMgfCAyMSArKysrKysrKysrKysrKy0tLS0tLS0NCiBkcml2ZXJzL2lvbW11L210a19p
b21tdS5oIHwgIDUgKysrKy0NCiAyIGZpbGVzIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDgg
ZGVsZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2lvbW11L210a19pb21tdS5jIGIv
ZHJpdmVycy9pb21tdS9tdGtfaW9tbXUuYw0KaW5kZXggNTMzYjhmNzZmNTkyLi4wZDk2ZGNkODYx
MmIgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2lvbW11L210a19pb21tdS5jDQorKysgYi9kcml2ZXJz
L2lvbW11L210a19pb21tdS5jDQpAQCAtOTEsNiArOTEsOCBAQA0KICNkZWZpbmUgUkVHX01NVTFf
SU5WTERfUEEJCQkweDE0OA0KICNkZWZpbmUgUkVHX01NVTBfSU5UX0lECQkJCTB4MTUwDQogI2Rl
ZmluZSBSRUdfTU1VMV9JTlRfSUQJCQkJMHgxNTQNCisjZGVmaW5lIEZfTU1VX0lOVF9JRF9DT01N
X0lEKGEpCQkJKCgoYSkgPj4gOSkgJiAweDcpDQorI2RlZmluZSBGX01NVV9JTlRfSURfU1VCX0NP
TU1fSUQoYSkJCSgoKGEpID4+IDcpICYgMHgzKQ0KICNkZWZpbmUgRl9NTVVfSU5UX0lEX0xBUkJf
SUQoYSkJCQkoKChhKSA+PiA3KSAmIDB4NykNCiAjZGVmaW5lIEZfTU1VX0lOVF9JRF9QT1JUX0lE
KGEpCQkJKCgoYSkgPj4gMikgJiAweDFmKQ0KIA0KQEAgLTEwOSw2ICsxMTEsNyBAQA0KICNkZWZp
bmUgSEFTX1ZMRF9QQV9STkcJCQlCSVQoMikNCiAjZGVmaW5lIFJFU0VUX0FYSQkJCUJJVCgzKQ0K
ICNkZWZpbmUgT1VUX09SREVSX1dSX0VOCQkJQklUKDQpDQorI2RlZmluZSBIQVNfU1VCX0NPTU0J
CQlCSVQoNSkNCiANCiAjZGVmaW5lIE1US19JT01NVV9IQVNfRkxBRyhwZGF0YSwgX3gpIFwNCiAJ
CSgoKChwZGF0YSktPmZsYWdzKSAmIChfeCkpID09IChfeCkpDQpAQCAtMjM5LDcgKzI0Miw3IEBA
IHN0YXRpYyBpcnFyZXR1cm5fdCBtdGtfaW9tbXVfaXNyKGludCBpcnEsIHZvaWQgKmRldl9pZCkN
CiAJc3RydWN0IG10a19pb21tdV9kYXRhICpkYXRhID0gZGV2X2lkOw0KIAlzdHJ1Y3QgbXRrX2lv
bW11X2RvbWFpbiAqZG9tID0gZGF0YS0+bTR1X2RvbTsNCiAJdTMyIGludF9zdGF0ZSwgcmVndmFs
LCBmYXVsdF9pb3ZhLCBmYXVsdF9wYTsNCi0JdW5zaWduZWQgaW50IGZhdWx0X2xhcmIsIGZhdWx0
X3BvcnQ7DQorCXVuc2lnbmVkIGludCBmYXVsdF9sYXJiLCBmYXVsdF9wb3J0LCBzdWJfY29tbSA9
IDA7DQogCWJvb2wgbGF5ZXIsIHdyaXRlOw0KIA0KIAkvKiBSZWFkIGVycm9yIGluZm8gZnJvbSBy
ZWdpc3RlcnMgKi8NCkBAIC0yNTUsMTAgKzI1OCwxNCBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgbXRr
X2lvbW11X2lzcihpbnQgaXJxLCB2b2lkICpkZXZfaWQpDQogCX0NCiAJbGF5ZXIgPSBmYXVsdF9p
b3ZhICYgRl9NTVVfRkFVTFRfVkFfTEFZRVJfQklUOw0KIAl3cml0ZSA9IGZhdWx0X2lvdmEgJiBG
X01NVV9GQVVMVF9WQV9XUklURV9CSVQ7DQotCWZhdWx0X2xhcmIgPSBGX01NVV9JTlRfSURfTEFS
Ql9JRChyZWd2YWwpOw0KIAlmYXVsdF9wb3J0ID0gRl9NTVVfSU5UX0lEX1BPUlRfSUQocmVndmFs
KTsNCi0NCi0JZmF1bHRfbGFyYiA9IGRhdGEtPnBsYXRfZGF0YS0+bGFyYmlkX3JlbWFwW2ZhdWx0
X2xhcmJdOw0KKwlpZiAoTVRLX0lPTU1VX0hBU19GTEFHKGRhdGEtPnBsYXRfZGF0YSwgSEFTX1NV
Ql9DT01NKSkgew0KKwkJZmF1bHRfbGFyYiA9IEZfTU1VX0lOVF9JRF9DT01NX0lEKHJlZ3ZhbCk7
DQorCQlzdWJfY29tbSA9IEZfTU1VX0lOVF9JRF9TVUJfQ09NTV9JRChyZWd2YWwpOw0KKwl9IGVs
c2Ugew0KKwkJZmF1bHRfbGFyYiA9IEZfTU1VX0lOVF9JRF9MQVJCX0lEKHJlZ3ZhbCk7DQorCX0N
CisJZmF1bHRfbGFyYiA9IGRhdGEtPnBsYXRfZGF0YS0+bGFyYmlkX3JlbWFwW2ZhdWx0X2xhcmJd
W3N1Yl9jb21tXTsNCiANCiAJaWYgKHJlcG9ydF9pb21tdV9mYXVsdCgmZG9tLT5kb21haW4sIGRh
dGEtPmRldiwgZmF1bHRfaW92YSwNCiAJCQkgICAgICAgd3JpdGUgPyBJT01NVV9GQVVMVF9XUklU
RSA6IElPTU1VX0ZBVUxUX1JFQUQpKSB7DQpAQCAtNzg1LDIxICs3OTIsMjEgQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCBtdGtfaW9tbXVfcGxhdF9kYXRhIG10MjcxMl9kYXRhID0gew0KIAkubTR1X3Bs
YXQgICAgID0gTTRVX01UMjcxMiwNCiAJLmZsYWdzICAgICAgICA9IEhBU180R0JfTU9ERSB8IEhB
U19CQ0xLIHwgSEFTX1ZMRF9QQV9STkcsDQogCS5pbnZfc2VsX3JlZyAgPSBSRUdfTU1VX0lOVl9T
RUxfR0VOMSwNCi0JLmxhcmJpZF9yZW1hcCA9IHswLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5
fSwNCisJLmxhcmJpZF9yZW1hcCA9IHt7MH0sIHsxfSwgezJ9LCB7M30sIHs0fSwgezV9LCB7Nn0s
IHs3fX0sDQogfTsNCiANCiBzdGF0aWMgY29uc3Qgc3RydWN0IG10a19pb21tdV9wbGF0X2RhdGEg
bXQ4MTczX2RhdGEgPSB7DQogCS5tNHVfcGxhdCAgICAgPSBNNFVfTVQ4MTczLA0KIAkuZmxhZ3MJ
ICAgICAgPSBIQVNfNEdCX01PREUgfCBIQVNfQkNMSyB8IFJFU0VUX0FYSSwNCiAJLmludl9zZWxf
cmVnICA9IFJFR19NTVVfSU5WX1NFTF9HRU4xLA0KLQkubGFyYmlkX3JlbWFwID0gezAsIDEsIDIs
IDMsIDQsIDV9LCAvKiBMaW5lYXIgbWFwcGluZy4gKi8NCisJLmxhcmJpZF9yZW1hcCA9IHt7MH0s
IHsxfSwgezJ9LCB7M30sIHs0fSwgezV9fSwgLyogTGluZWFyIG1hcHBpbmcuICovDQogfTsNCiAN
CiBzdGF0aWMgY29uc3Qgc3RydWN0IG10a19pb21tdV9wbGF0X2RhdGEgbXQ4MTgzX2RhdGEgPSB7
DQogCS5tNHVfcGxhdCAgICAgPSBNNFVfTVQ4MTgzLA0KIAkuZmxhZ3MgICAgICAgID0gUkVTRVRf
QVhJLA0KIAkuaW52X3NlbF9yZWcgID0gUkVHX01NVV9JTlZfU0VMX0dFTjEsDQotCS5sYXJiaWRf
cmVtYXAgPSB7MCwgNCwgNSwgNiwgNywgMiwgMywgMX0sDQorCS5sYXJiaWRfcmVtYXAgPSB7ezB9
LCB7NH0sIHs1fSwgezZ9LCB7N30sIHsyfSwgezN9LCB7MX19LA0KIH07DQogDQogc3RhdGljIGNv
bnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgbXRrX2lvbW11X29mX2lkc1tdID0gew0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvaW9tbXUvbXRrX2lvbW11LmggYi9kcml2ZXJzL2lvbW11L210a19pb21tdS5o
DQppbmRleCBjZjUzZjVlODBkMjIuLjQ2ZDBkNDdiMjJlMSAxMDA2NDQNCi0tLSBhL2RyaXZlcnMv
aW9tbXUvbXRrX2lvbW11LmgNCisrKyBiL2RyaXZlcnMvaW9tbXUvbXRrX2lvbW11LmgNCkBAIC0x
Nyw2ICsxNyw5IEBADQogI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+DQogI2luY2x1ZGUgPHNv
Yy9tZWRpYXRlay9zbWkuaD4NCiANCisjZGVmaW5lIE1US19MQVJCX0NPTV9NQVgJOA0KKyNkZWZp
bmUgTVRLX0xBUkJfU1VCQ09NX01BWAk0DQorDQogc3RydWN0IG10a19pb21tdV9zdXNwZW5kX3Jl
ZyB7DQogCXVuaW9uIHsNCiAJCXUzMgkJCXN0YW5kYXJkX2F4aV9tb2RlOy8qIHYxICovDQpAQCAt
NDEsNyArNDQsNyBAQCBzdHJ1Y3QgbXRrX2lvbW11X3BsYXRfZGF0YSB7DQogCWVudW0gbXRrX2lv
bW11X3BsYXQgbTR1X3BsYXQ7DQogCXUzMiAgICAgICAgICAgICAgICAgZmxhZ3M7DQogCXUzMiAg
ICAgICAgICAgICAgICAgaW52X3NlbF9yZWc7DQotCXVuc2lnbmVkIGNoYXIgICAgICAgbGFyYmlk
X3JlbWFwW01US19MQVJCX05SX01BWF07DQorCXVuc2lnbmVkIGNoYXIgICAgICAgbGFyYmlkX3Jl
bWFwW01US19MQVJCX0NPTV9NQVhdW01US19MQVJCX1NVQkNPTV9NQVhdOw0KIH07DQogDQogc3Ry
dWN0IG10a19pb21tdV9kb21haW47DQotLSANCjIuMTguMA0K

